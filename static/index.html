<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïò§ÌîàÎã§Ìä∏ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù ÏÑúÎπÑÏä§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .search-input-container {
            position: relative;
            flex: 1;
        }
        
        .search-input-container::after {
            content: 'üîç';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        

        
        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }
        
        .results-container {
            margin-top: 20px;
        }
        
        .result-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .result-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .corp-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .corp-name:hover {
            color: #667eea;
        }
        
        .corp-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .corp-code {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .stock-code {
            background: #f3e5f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 500;
        }
        
        .loading::before {
            content: '‚è≥';
            margin-right: 8px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .more-results {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* ÏóêÎü¨ ÌåùÏóÖ Ïä§ÌÉÄÏùº */
        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 400px;
            text-align: center;
            animation: popupFadeIn 0.3s ease-out;
        }
        
        .error-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            animation: overlayFadeIn 0.3s ease-out;
        }
        
        .error-popup-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .error-popup-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #c62828;
            margin-bottom: 15px;
        }
        
        .error-popup-message {
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .error-popup-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        
        .error-popup-button:hover {
            transform: translateY(-2px);
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @keyframes overlayFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .feature-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        /* Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ïä§ÌÉÄÏùº */
        .financial-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            display: none;
        }
        
        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .financial-title {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }
        
        .financial-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .financial-controls select,
        .financial-controls button {
            padding: 8px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .financial-controls button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .financial-controls button:hover {
            transform: translateY(-1px);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%) !important;
            color: white !important;
            font-weight: 600;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #ff5722 0%, #e68900 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .reset-btn:active {
            transform: translateY(0px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }
        
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .summary-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: #ff5252;
        }
        
        /* ÌÉ≠ Ïä§ÌÉÄÏùº */
        .analysis-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            gap: 5px;
        }
        
        .analysis-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .analysis-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .analysis-tab:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Î∂ÑÏÑù Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analysis-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .metric-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        
        .metric-value.positive {
            color: #28a745;
        }
        
        .metric-value.negative {
            color: #dc3545;
        }
        
        .metric-value.neutral {
            color: #6c757d;
        }
        
        /* ÎπÑÍµê Ï∞®Ìä∏ Ïä§ÌÉÄÏùº */
        .comparison-chart {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-chart h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart-small {
            height: 300px;
        }
        
        /* Ïû¨Î¨¥Íµ¨Ï°∞ Ïä§ÌÉÄÏùº */
        .balance-equation-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .balance-equation {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .equation-values {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .equation-item {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }
        
        .equation-item h4 {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .equation-item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .equation-balance {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .equation-balance.balanced {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid rgba(40, 167, 69, 0.5);
        }
        
        .equation-balance.unbalanced {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
        }
        
        .balance-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Ïû¨Î¨¥Íµ¨Ï°∞ Ï¢åÏö∞ Î†àÏù¥ÏïÑÏõÉ */
        .balance-structure-layout {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .balance-left {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #28a745;
        }
        
        .balance-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .balance-right-top {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #dc3545;
        }
        
        .balance-right-bottom {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #007bff;
        }
        
        .balance-section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        
        .balance-section-title.assets {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .balance-section-title.liabilities {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .balance-section-title.equity {
            background: linear-gradient(135deg, #007bff, #6610f2);
        }
        
        /* Îß§Ï∂ú Ï¶ùÍ∞ê Ï†ïÎ≥¥ Ïä§ÌÉÄÏùº */
        .revenue-change-info {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .revenue-change-item {
            display: inline-block;
            margin: 0 20px;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .revenue-change-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .revenue-change-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .revenue-change-value.positive {
            color: #28a745;
        }
        
        .revenue-change-value.negative {
            color: #dc3545;
        }
        
        .revenue-change-value.neutral {
            color: #6c757d;
        }
        
        /* Ï∞®Ìä∏ Í∞í ÌëúÏãú Ïä§ÌÉÄÏùº */
        .chart-values-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
        }
        
        .chart-value-item {
            text-align: center;
            padding: 8px 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 120px;
        }
        
        .chart-value-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .chart-value-amount {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-value-amount.previous {
            color: #764ba2;
        }
        
        .chart-value-amount.current {
            color: #667eea;
        }
        
        .component-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .component-card.assets {
            border-left-color: #28a745;
        }
        
        .component-card.liabilities {
            border-left-color: #dc3545;
        }
        
        .component-card.equity {
            border-left-color: #007bff;
        }
        
        .component-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .component-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .component-item:last-child {
            border-bottom: none;
        }
        
        .component-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .component-value {
            font-weight: bold;
            color: #333;
        }
        
        /* AI Î∂ÑÏÑù Ïä§ÌÉÄÏùº */
        .ai-summary-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .ai-summary-container::before {
            content: "ü§ñ";
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            opacity: 0.7;
        }
        
        .ai-summary-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .ai-summary-text {
            font-size: 1em;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .ai-analysis-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .ai-analysis-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.4em;
        }
        
        .ai-analysis-text {
            font-size: 1em;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
        }
        
        .ai-analysis-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .ai-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .ai-loading .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
        }
        
        .ai-disclaimer {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }
        
        /* ÏàòÏùµÏÑ± Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº */
        .profitability-charts-container {
            margin-top: 20px;
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .chart-box h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
            text-align: center;
            font-weight: 600;
        }
        
        .chart-box .chart-wrapper {
            height: 250px;
        }
        
        @media (max-width: 1024px) {
            .chart-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* Î¶¨ÏÖã Î©îÏãúÏßÄ Ïä§ÌÉÄÏùº */
        .reset-message {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            margin: 20px 0;
            animation: fadeInScale 0.5s ease-out;
        }
        
        .reset-icon {
            font-size: 3em;
            margin-right: 20px;
            animation: rotate 2s linear infinite;
        }
        
        .reset-text h3 {
            margin: 0 0 10px 0;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .reset-text p {
            margin: 0;
            font-size: 1em;
            opacity: 0.9;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
            
            .corp-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Ïò§ÌîàÎã§Ìä∏ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù</h1>
            <p>Í∏∞ÏóÖ Ï†ïÎ≥¥Î•º Îπ†Î•¥Í≥† Ï†ïÌôïÌïòÍ≤å Í≤ÄÏÉâÌïòÏÑ∏Ïöî</p>
        </div>
        
        <div class="search-container">
            <div class="search-form">
                <div class="search-input-container">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="ÌöåÏÇ¨Î™Ö, ÏòÅÎ¨∏ÌöåÏÇ¨Î™Ö ÎòêÎäî Ï£ºÏãùÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: ÏÇºÏÑ±Ï†ÑÏûê, Samsung, 005930)">
                </div>
                <button onclick="searchCorporations()" class="search-btn">üîç Í≤ÄÏÉâ</button>
            </div>
            
            <div id="stats" class="stats"></div>
            <div id="results" class="results-container"></div>
        </div>
        
        <!-- Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú ÏòÅÏó≠ -->
        <div id="financialContainer" class="financial-container">
            <button class="close-btn" onclick="closeFinancialData()">√ó</button>
            
            <div class="financial-header">
                <h2 id="financialTitle" class="financial-title">Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞</h2>
                <div class="financial-controls">
                    <select id="yearSelect">
                        <option value="2024">2024ÎÖÑ</option>
                        <option value="2023">2023ÎÖÑ</option>
                        <option value="2022">2022ÎÖÑ</option>
                        <option value="2021">2021ÎÖÑ</option>
                        <option value="2020">2020ÎÖÑ</option>
                        <option value="2019">2019ÎÖÑ</option>
                    </select>
                    <select id="reportSelect">
                        <option value="11011">ÏÇ¨ÏóÖÎ≥¥Í≥†ÏÑú</option>
                        <option value="11012">Î∞òÍ∏∞Î≥¥Í≥†ÏÑú</option>
                        <option value="11013">1Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú</option>
                        <option value="11014">3Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú</option>
                    </select>
                    <button onclick="refreshFinancialData()">üìä Ïû¨Î¨¥Ï°∞Ìöå</button>
                    <button class="reset-btn" onclick="completeReset()" title="Î™®Îì† Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî">üîÑ Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
                </div>
            </div>
            
            <!-- Î∂ÑÏÑù ÌÉ≠ -->
            <div class="analysis-tabs">
                <button class="analysis-tab active" onclick="switchTab('overview')">üìä Í∞úÏöî</button>
                <button class="analysis-tab" onclick="switchTab('ai')">ü§ñ AIÎ∂ÑÏÑù</button>
                <button class="analysis-tab" onclick="switchTab('balance')">üèóÔ∏è Ïû¨Î¨¥Íµ¨Ï°∞</button>
                <button class="analysis-tab" onclick="switchTab('revenue')">üí∞ Îß§Ï∂úÎ∂ÑÏÑù</button>
                <button class="analysis-tab" onclick="switchTab('profitability')">üìà ÏàòÏùµÏÑ±</button>
                <button class="analysis-tab" onclick="switchTab('ratios')">‚öñÔ∏è Ïû¨Î¨¥ÎπÑÏú®</button>
                <button class="analysis-tab" onclick="switchTab('performance')">üéØ ÏÑ±Í≥ºÏßÄÌëú</button>
            </div>
            
            <!-- Í∞úÏöî ÌÉ≠ -->
            <div id="overviewTab" class="tab-content active">
                <div id="financialSummary" class="financial-summary"></div>
                <div class="chart-container">
                    <div id="financialChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- AI Î∂ÑÏÑù ÌÉ≠ -->
            <div id="aiTab" class="tab-content">
                <div id="aiSummary" class="ai-summary-container"></div>
                <div id="aiAnalysis" class="ai-analysis-container"></div>
            </div>
            
            <!-- Ïû¨Î¨¥Íµ¨Ï°∞ ÌÉ≠ -->
            <div id="balanceTab" class="tab-content">
                <div id="balanceEquation" class="balance-equation-container"></div>
                <div id="balanceStructureAnalysis" class="balance-structure-layout"></div>
                <div class="comparison-chart">
                    <h4>üèóÔ∏è Ïû¨Î¨¥Íµ¨Ï°∞ ÏãúÍ∞ÅÌôî</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="balanceStructureChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Îß§Ï∂ú Î∂ÑÏÑù ÌÉ≠ -->
            <div id="revenueTab" class="tab-content">
                <div id="revenueAnalysis"></div>
                <div class="comparison-chart">
                    <h4>üìä Îß§Ï∂ú Ï∂îÏù¥ Î∂ÑÏÑù</h4>
                    <div id="revenueChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper chart-small">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div id="revenueChangeInfo" class="revenue-change-info"></div>
                </div>
            </div>
            
            <!-- ÏàòÏùµÏÑ± ÌÉ≠ -->
            <div id="profitabilityTab" class="tab-content">
                <div id="profitabilityAnalysis"></div>
                <div class="profitability-charts-container">
                    <div class="chart-row">
                        <div class="chart-box">
                            <h4>üí∞ Ïù¥ÏùµÎ•† ÏßÄÌëú</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="marginChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>‚≠ê ROE (ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†)</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="roeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="chart-box">
                            <h4>üéØ ROA (Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†)</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="roaChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>üìä ROE vs ROA ÎπÑÍµê</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ïû¨Î¨¥ÎπÑÏú® ÌÉ≠ -->
            <div id="ratiosTab" class="tab-content">
                <div id="ratiosAnalysis"></div>
                <div class="comparison-chart">
                    <h4>‚öñÔ∏è Ïû¨Î¨¥ ÏïàÏ†ïÏÑ±</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="ratiosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ÏÑ±Í≥ºÏßÄÌëú ÌÉ≠ -->
            <div id="performanceTab" class="tab-content">
                <div id="performanceAnalysis"></div>
                <div class="comparison-chart">
                    <h4>üéØ ÏÑ±Ïû•ÏÑ± ÏßÄÌëú</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h3>üìä Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ</h3>
                <p>Ïò§ÌîàÎã§Ìä∏Ïóê Îì±Î°ùÎêú Î™®Îì† Í∏∞ÏóÖÏùò Ï†ïÎ≥¥Î•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í≤ÄÏÉâÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üè∑Ô∏è Îã§ÏñëÌïú Í≤ÄÏÉâ ÏòµÏÖò</h3>
                <p>ÌöåÏÇ¨Î™Ö, ÏòÅÎ¨∏ÌöåÏÇ¨Î™Ö, Ï£ºÏãùÏΩîÎìú Îì± Îã§ÏñëÌïú Î∞©Î≤ïÏúºÎ°ú Í≤ÄÏÉâÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üíº Ï†ïÌôïÌïú Í∏∞ÏóÖ Ï†ïÎ≥¥</h3>
                <p>Í∏∞ÏóÖÏΩîÎìú, Ï£ºÏãùÏΩîÎìú Îì± Ï†ïÌôïÌïú Í∏∞ÏóÖ ÏãùÎ≥Ñ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üìà Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÏãúÍ∞ÅÌôî</h3>
                <p>Í∏∞ÏóÖÎ™ÖÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Ïò§ÌîàÎã§Ìä∏ APIÎ•º ÌÜµÌï¥ Ïã§Ï†ú Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÍ≥† Ï∞®Ìä∏Î°ú ÏãúÍ∞ÅÌôîÌï©ÎãàÎã§.</p>
            </div>
        </div>
    </div>

    <script>
        // Chart.js DataLabels ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
        Chart.register(ChartDataLabels);
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChart = null;
        let currentCorpCode = null;
        let currentCompanyName = null;
        let analysisCharts = {
            revenue: null,
            profitability: null,
            margin: null,
            roe: null,
            roa: null,
            ratios: null,
            performance: null,
            balanceStructure: null
        };
        let currentAnalysisData = null;
        let currentBalanceData = null;
        let currentDetailedData = null;
        let currentAiData = null;
        
        // ÎîîÎ∞îÏö¥Ïã±ÏùÑ ÏúÑÌïú ÌÉÄÏù¥Î®∏ Î≥ÄÏàò
        let searchTimer = null;
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï†ÑÏ≤¥ Í∏∞ÏóÖ Ïàò Ï°∞Ìöå
        window.onload = function() {
            loadTotalCount();
            
            // Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            const searchInput = document.getElementById('searchInput');
            
            // ÏûÖÎ†• Ïù¥Î≤§Ìä∏ (Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ)
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                // Ïù¥Ï†Ñ ÌÉÄÏù¥Î®∏ Ï∑®ÏÜå
                if (searchTimer) {
                    clearTimeout(searchTimer);
                }
                
                // Í≤ÄÏÉâÏñ¥Í∞Ä ÏóÜÏúºÎ©¥ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
                if (!query) {
                    document.getElementById('results').innerHTML = '<div class="no-results">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
                    return;
                }
                
                // 300ms ÌõÑÏóê Í≤ÄÏÉâ Ïã§Ìñâ (ÎîîÎ∞îÏö¥Ïã±)
                searchTimer = setTimeout(() => {
                    searchCorporations();
                }, 300);
            });
            
            // Enter ÌÇ§ Ïù¥Î≤§Ìä∏ (Ï¶âÏãú Í≤ÄÏÉâ)
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // ÌÉÄÏù¥Î®∏ Ï∑®ÏÜåÌïòÍ≥† Ï¶âÏãú Í≤ÄÏÉâ
                    if (searchTimer) {
                        clearTimeout(searchTimer);
                    }
                    searchCorporations();
                }
            });
        };
        
        // Ï†ÑÏ≤¥ Í∏∞ÏóÖ Ïàò Ï°∞Ìöå
        async function loadTotalCount() {
            try {
                const response = await fetch('/api/corporations/count');
                const count = await response.json();
                document.getElementById('stats').innerHTML = 
                    `üìà ÌòÑÏû¨ <strong>${count.toLocaleString()}</strong>Í∞ú Í∏∞ÏóÖÏù¥ Îì±Î°ùÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`;
            } catch (error) {
                console.error('Error loading total count:', error);
                document.getElementById('stats').innerHTML = 
                    'üìà Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ïó∞Í≤∞ Ï§ëÏûÖÎãàÎã§...';
            }
        }
        
        // Í∏∞ÏóÖ Í≤ÄÏÉâ
        async function searchCorporations() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
                return;
            }
            
            // Î°úÎî© ÌëúÏãú (Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâÏö© Í∞ÑÎã®Ìïú Î°úÎî©)
            resultsDiv.innerHTML = '<div class="loading">üîç Í≤ÄÏÉâ Ï§ë...</div>';
            
            try {
                const response = await fetch(`/api/corporations/search?q=${encodeURIComponent(query)}`);
                const corporations = await response.json();
                
                if (corporations.length === 0) {
                    resultsDiv.innerHTML = '<div class="no-results">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Í≤ÄÏÉâÏñ¥Î•º ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
                    return;
                }
                
                // Í≤∞Í≥º ÌëúÏãú (ÏµúÎåÄ 20Í∞úÎ°ú Ï†úÌïú)
                const maxResults = 20;
                const displayCorporations = corporations.slice(0, maxResults);
                const totalCount = corporations.length;
                
                let html = `<h3>Í≤ÄÏÉâ Í≤∞Í≥º (${totalCount}Í∞ú${totalCount > maxResults ? `, ÏÉÅÏúÑ ${maxResults}Í∞ú ÌëúÏãú` : ''})</h3>`;
                displayCorporations.forEach(corp => {
                    html += `
                        <div class="result-item">
                            <div class="corp-name" onclick="showFinancialData('${corp.corp_code}', '${corp.corp_name.replace(/'/g, "&apos;")}')">${corp.corp_name} üìà</div>
                            <div class="corp-details">
                                <div><strong>Í∏∞ÏóÖÏΩîÎìú:</strong> <span class="corp-code">${corp.corp_code}</span></div>
                                <div><strong>Ï£ºÏãùÏΩîÎìú:</strong> <span class="stock-code">${corp.stock_code || 'N/A'}</span></div>
                                <div><strong>ÏòÅÎ¨∏Î™Ö:</strong> ${corp.corp_eng_name || 'N/A'}</div>
                                <div><strong>ÏàòÏ†ïÏùº:</strong> ${formatDate(corp.modify_date)}</div>
                            </div>
                        </div>
                    `;
                });
                
                // Îçî ÎßéÏùÄ Í≤∞Í≥ºÍ∞Ä ÏûàÏùÑ Îïå ÏïàÎÇ¥ Î©îÏãúÏßÄ
                if (totalCount > maxResults) {
                    html += `<div class="more-results">üí° Îçî Ï†ïÌôïÌïú Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏãúÎ©¥ Îçî ÎßéÏùÄ Í≤∞Í≥ºÎ•º Î≥º Ïàò ÏûàÏäµÎãàÎã§.</div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error searching corporations:', error);
                resultsDiv.innerHTML = '<div class="error">Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</div>';
            }
        }
        
        // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
        function formatDate(dateStr) {
            if (!dateStr || dateStr.length !== 8) return dateStr;
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            return `${year}-${month}-${day}`;
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        async function showFinancialData(corpCode, corpName) {
            currentCorpCode = corpCode;
            currentCompanyName = corpName;
            
            // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('financialTitle').textContent = `${corpName} Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞`;
            
            // ÎÖÑÎèÑ ÎìúÎ°≠Îã§Ïö¥ ÎèôÏ†Å ÏÉùÏÑ±
            updateYearDropdown();
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('financialContainer').style.display = 'block';
            
            // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            await loadFinancialData();
            
            // Ïä§ÌÅ¨Î°§
            document.getElementById('financialContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        // ÎÖÑÎèÑ ÎìúÎ°≠Îã§Ïö¥ ÎèôÏ†Å ÏÉùÏÑ±
        function updateYearDropdown() {
            const yearSelect = document.getElementById('yearSelect');
            const currentYear = new Date().getFullYear();
            
            // Í∏∞Ï°¥ ÏòµÏÖò Ï†úÍ±∞
            yearSelect.innerHTML = '';
            
            // ÏµúÍ∑º 10ÎÖÑÍ∞ÑÏùò ÎÖÑÎèÑ ÏÉùÏÑ± (ÌòÑÏû¨ ÎÖÑÎèÑÎ∂ÄÌÑ∞ Ïó≠Ïàú)
            for (let year = currentYear; year >= currentYear - 9; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ÎÖÑ`;
                
                // 2024ÎÖÑÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                if (year === 2024) {
                    option.selected = true;
                }
                
                yearSelect.appendChild(option);
            }
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadFinancialData() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // Î°úÎî© ÌëúÏãú
                document.getElementById('financialSummary').innerHTML = '<div class="loading">üìä Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>';
                
                // Í∏∞Î≥∏ ÏöîÏïΩ Îç∞Ïù¥ÌÑ∞, ÏÉÅÏÑ∏ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞, Ïû¨Î¨¥Íµ¨Ï°∞ Îç∞Ïù¥ÌÑ∞Î•º Î≥ëÎ†¨Î°ú Î°úÎìú
                const [summaryResponse, analysisResponse, balanceResponse, detailedResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/analysis?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/balance-structure?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/detailed-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok && analysisResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    const analysisData = await analysisResponse.json();
                    const balanceData = balanceResponse.ok ? await balanceResponse.json() : null;
                    const detailedData = detailedResponse.ok ? await detailedResponse.json() : null;
                    
                    currentAnalysisData = analysisData;
                    currentBalanceData = balanceData;
                    currentDetailedData = detailedData;
                    
                    displayFinancialSummary(summaryData);
                    createFinancialChart(summaryData);
                    
                    // Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
                    if (balanceData) {
                        displayBalanceStructure(balanceData);
                    }
                    displayRevenueAnalysis(analysisData);
                    displayProfitabilityAnalysis(analysisData);
                    displayRatiosAnalysis(analysisData);
                    displayPerformanceAnalysis(analysisData);
                    
                    // ÏàòÏùµÏÑ± Ï∞®Ìä∏ Ï¶âÏãú ÏÉùÏÑ± (Ï≤´ Î°úÎìú Ïãú)
                    createProfitabilityCharts(analysisData);
                    
                } else {
                    // ÏóêÎü¨ ÏùëÎãµ ÌôïÏù∏
                    let errorMessage = '';
                    let isYearDataError = false;
                    
                    if (!summaryResponse.ok) {
                        try {
                            const errorData = await summaryResponse.json();
                            if (errorData.error && errorData.error.includes('Ï°∞ÌöåÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§')) {
                                const year = document.getElementById('yearSelect').value;
                                const report = document.getElementById('reportSelect').value;
                                const reportName = getReportName(report);
                                errorMessage = `${currentCompanyName}Ïùò ${year}ÎÖÑ ${reportName} Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.`;
                                isYearDataError = true;
                            } else {
                                errorMessage = errorData.error || 'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.';
                            }
                        } catch (e) {
                            errorMessage = 'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.';
                        }
                    }
                    
                    if (isYearDataError) {
                        // ÎÖÑÎèÑÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú
                        showErrorPopup(
                            'üìä Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">üìã Ìï¥Îãπ ÎÖÑÎèÑÏùò Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                    } else if (errorMessage) {
                        // ÏùºÎ∞ò ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú
                        showErrorPopup(
                            '‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">üìã Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                    }
                    
                    // Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ÎèÑ ÌôïÏù∏
                    if (!analysisResponse.ok) {
                        console.warn('Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                }
                
            } catch (error) {
                console.error('Error loading financial data:', error);
                showErrorPopup(
                    '‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù',
                    'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n\nÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÍ±∞ÎÇò Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'
                );
                document.getElementById('financialSummary').innerHTML = 
                    '<div class="error">üìã Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
            }
        }
        
        // Ïû¨Î¨¥ ÏöîÏïΩ Ï†ïÎ≥¥ ÌëúÏãú
        function displayFinancialSummary(data) {
            const summaryDiv = document.getElementById('financialSummary');
            const accounts = data.key_accounts;
            
            let html = '';
            
            if (accounts.assets) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏûêÏÇ∞Ï¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.assets)}</div>
                    </div>
                `;
            }
            
            if (accounts.liabilities) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.liabilities)}</div>
                    </div>
                `;
            }
            
            if (accounts.equity) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏûêÎ≥∏Ï¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.equity)}</div>
                    </div>
                `;
            }
            
            if (accounts.revenue) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">Îß§Ï∂úÏï°</div>
                        <div class="summary-value">${formatCurrency(accounts.revenue)}</div>
                    </div>
                `;
            }
            
            if (accounts.operating_profit) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏòÅÏóÖÏù¥Ïùµ</div>
                        <div class="summary-value">${formatCurrency(accounts.operating_profit)}</div>
                    </div>
                `;
            }
            
            if (accounts.net_income) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÎãπÍ∏∞ÏàúÏù¥Ïùµ</div>
                        <div class="summary-value">${formatCurrency(accounts.net_income)}</div>
                    </div>
                `;
            }
            
            if (!html) {
                html = '<div class="error">üìä ÌëúÏãúÌï† Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
            }
            
            summaryDiv.innerHTML = html;
        }
        
        // Ïû¨Î¨¥ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createFinancialChart(data) {
            const ctx = document.getElementById('financialChart').getContext('2d');
            const accounts = data.key_accounts;
            
            // Ïù¥Ï†Ñ Ï∞®Ìä∏ ÏÇ≠Ï†ú
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'Í∏àÏï° (Î∞±ÎßåÏõê)',
                    data: [],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 205, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 205, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            
            // Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
            if (accounts.assets) {
                chartData.labels.push('ÏûêÏÇ∞Ï¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.assets / 1000000)); // Î∞±ÎßåÏõê Îã®ÏúÑ
            }
            if (accounts.liabilities) {
                chartData.labels.push('Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.liabilities / 1000000));
            }
            if (accounts.equity) {
                chartData.labels.push('ÏûêÎ≥∏Ï¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.equity / 1000000));
            }
            if (accounts.revenue) {
                chartData.labels.push('Îß§Ï∂úÏï°');
                chartData.datasets[0].data.push(Math.round(accounts.revenue / 1000000));
            }
            if (accounts.operating_profit) {
                chartData.labels.push('ÏòÅÏóÖÏù¥Ïùµ');
                chartData.datasets[0].data.push(Math.round(accounts.operating_profit / 1000000));
            }
            if (accounts.net_income) {
                chartData.labels.push('ÎãπÍ∏∞ÏàúÏù¥Ïùµ');
                chartData.datasets[0].data.push(Math.round(accounts.net_income / 1000000));
            }
            
            // Ï∞®Ìä∏ ÏúÑÏóê Í∏àÏï° ÌëúÏãú
            const chartValuesContainer = document.getElementById('financialChartValues');
            let valuesHtml = '';
            chartData.labels.forEach((label, index) => {
                const value = chartData.datasets[0].data[index];
                valuesHtml += `
                    <div class="chart-value-item">
                        <div class="chart-value-label">${label}</div>
                        <div class="chart-value-amount">${value.toLocaleString()}Î∞±ÎßåÏõê</div>
                    </div>
                `;
            });
            chartValuesContainer.innerHTML = valuesHtml;
            
            // Ï∞®Ìä∏ ÏÉùÏÑ±
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentCompanyName || data.company_info?.stock_code || 'ÌöåÏÇ¨'} Ï£ºÏöî Ïû¨Î¨¥ ÏßÄÌëú (${data.company_info?.bsns_year || 'N/A'}ÎÖÑ)`
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: function(value) {
                                return value.toLocaleString() + 'Î∞±ÎßåÏõê';
                            }
                        }
                    }
                }
            });
        }
        
        // ÌÜµÌôî Ìè¨Îß∑ÌåÖ
        function formatCurrency(amount) {
            if (!amount) return 'N/A';
            
            if (Math.abs(amount) >= 1000000000000) {
                return (amount / 1000000000000).toFixed(1) + 'Ï°∞Ïõê';
            } else if (Math.abs(amount) >= 100000000) {
                return (amount / 100000000).toFixed(0) + 'ÏñµÏõê';
            } else if (Math.abs(amount) >= 10000) {
                return (amount / 10000).toFixed(0) + 'ÎßåÏõê';
            } else {
                return amount.toLocaleString() + 'Ïõê';
            }
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshFinancialData() {
            if (currentCorpCode) {
                // AI Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî (ÏÉàÎ°úÏö¥ ÎÖÑÎèÑ/Î≥¥Í≥†ÏÑúÎ°ú Î≥ÄÍ≤Ω Ïãú)
                currentAiData = null;
                loadFinancialData();
            }
        }
        
        // ÌÜµÌï©Îêú Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function completeReset() {
            // ÌôïÏù∏ ÎåÄÌôîÏ∞Ω ÌëúÏãú
            const confirmed = confirm('Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† ÏÉàÎ°úÏö¥ Í≤ÄÏÉâÏùÑ ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n- Í≤ÄÏÉâ Í≤∞Í≥º\n- Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞\n- Ï∞®Ìä∏ Î∞è Î∂ÑÏÑù\n- AI Î∂ÑÏÑù Í≤∞Í≥º');
            
            if (confirmed) {
                // 1. Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ï∞Ω Îã´Í∏∞ Î∞è Ï∞®Ìä∏ Ï†ïÎ¶¨
                closeFinancialData();
                
                // 2. Í≤ÄÏÉâ ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî Î∞è Ìè¨Ïª§Ïä§
                const searchInput = document.getElementById('searchInput');
                searchInput.value = '';
                searchInput.focus();
                
                // 3. Í≤ÄÏÉâ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                
                // 4. ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
                const statsContainer = document.getElementById('stats');
                statsContainer.innerHTML = '';
                
                // 5. Ï†ÑÏó≠ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
                currentCorpCode = null;
                currentCompanyName = null;
                currentFinancialData = null;
                currentAnalysisData = null;
                currentBalanceData = null;
                currentAiData = null;
                
                // 6. ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú
                showCompleteResetMessage();
                
                // 7. ÌéòÏù¥ÏßÄ ÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // ÌÜµÌï© Ï¥àÍ∏∞Ìôî ÏôÑÎ£å Î©îÏãúÏßÄ ÌëúÏãú
        function showCompleteResetMessage() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `
                <div class="reset-message">
                    <div class="reset-icon">üîÑ</div>
                    <div class="reset-text">
                        <h3>Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!</h3>
                        <p>Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. ÏúÑÏùò Í≤ÄÏÉâÏ∞ΩÏóê ÌöåÏÇ¨Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏó¨ ÏÉàÎ°úÏö¥ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÏÑ∏Ïöî.</p>
                    </div>
                </div>
            `;
            
            // 4Ï¥à ÌõÑ Î©îÏãúÏßÄ ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (resultsContainer.innerHTML.includes('reset-message')) {
                    resultsContainer.innerHTML = '';
                }
            }, 4000);
        }
        
        // ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú Ìï®Ïàò
        function showErrorPopup(title, message) {
            // Í∏∞Ï°¥ ÌåùÏóÖÏù¥ ÏûàÎã§Î©¥ Ï†úÍ±∞
            const existingPopup = document.querySelector('.error-popup-overlay');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'error-popup-overlay';
            
            const popup = document.createElement('div');
            popup.className = 'error-popup';
            popup.innerHTML = `
                <div class="error-popup-icon">‚ö†Ô∏è</div>
                <div class="error-popup-title">${title}</div>
                <div class="error-popup-message">${message}</div>
                <button class="error-popup-button" onclick="closeErrorPopup()">ÌôïÏù∏</button>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            
            // ESC ÌÇ§Î°ú ÌåùÏóÖ Îã´Í∏∞
            const handleEscKey = (event) => {
                if (event.key === 'Escape') {
                    closeErrorPopup();
                    document.removeEventListener('keydown', handleEscKey);
                }
            };
            document.addEventListener('keydown', handleEscKey);
            
            // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ÏúºÎ°ú ÌåùÏóÖ Îã´Í∏∞
            overlay.addEventListener('click', (event) => {
                if (event.target === overlay) {
                    closeErrorPopup();
                }
            });
        }
        
        // ÏóêÎü¨ ÌåùÏóÖ Îã´Í∏∞ Ìï®Ïàò
        function closeErrorPopup() {
            const overlay = document.querySelector('.error-popup-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Î≥¥Í≥†ÏÑú ÏΩîÎìúÎ•º Ïù¥Î¶ÑÏúºÎ°ú Î≥ÄÌôòÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
        function getReportName(reportCode) {
            const reportNames = {
                '11011': 'ÏÇ¨ÏóÖÎ≥¥Í≥†ÏÑú',
                '11012': 'Î∞òÍ∏∞Î≥¥Í≥†ÏÑú',
                '11013': '1Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú',
                '11014': '3Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú'
            };
            return reportNames[reportCode] || 'Î≥¥Í≥†ÏÑú';
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ï∞Ω Îã´Í∏∞
        function closeFinancialData() {
            document.getElementById('financialContainer').style.display = 'none';
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // Î™®Îì† Î∂ÑÏÑù Ï∞®Ìä∏ ÏÇ≠Ï†ú
            Object.keys(analysisCharts).forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            currentCorpCode = null;
            currentCompanyName = null;
            currentFinancialData = null;
            currentAnalysisData = null;
            currentBalanceData = null;
            currentAiData = null;
            
            // Ï≤´ Î≤àÏß∏ ÌÉ≠ÏúºÎ°ú Î¶¨ÏÖã
            switchTab('overview');
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.analysis-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Ï∞®Ìä∏ ÏÉùÏÑ± (ÌïÑÏöîÌïú Í≤ΩÏö∞)
            if (currentAnalysisData) {
                switch(tabName) {
                    case 'ai':
                        if (!currentAiData) {
                            loadAiAnalysis();
                        }
                        break;
                    case 'balance':
                        if (currentBalanceData) {
                            createBalanceStructureChart(currentBalanceData);
                        }
                        break;
                    case 'revenue':
                        createRevenueChart(currentAnalysisData);
                        break;
                    case 'profitability':
                        createProfitabilityCharts(currentAnalysisData);
                        break;
                    case 'ratios':
                        createRatiosChart(currentAnalysisData);
                        break;
                    case 'performance':
                        createPerformanceChart(currentAnalysisData);
                        break;
                }
            }
        }
        
        // AI Î∂ÑÏÑù Î°úÎìú
        async function loadAiAnalysis() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-loading">
                        <div class="spinner"></div>
                        <div>ü§ñ AIÍ∞Ä Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
                
                // AI ÏöîÏïΩÍ≥º ÏÉÅÏÑ∏ Î∂ÑÏÑùÏùÑ Î≥ëÎ†¨Î°ú Î°úÎìú
                const [summaryResponse, analysisResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/ai-summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/ai-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    displayAiSummary(summaryData);
                } else {
                    const errorData = await summaryResponse.json();
                    document.getElementById('aiSummary').innerHTML = `
                        <div class="ai-error">
                            AI ÏöîÏïΩ ÏÉùÏÑ± Ïã§Ìå®: ${errorData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}
                        </div>
                    `;
                }
                
                if (analysisResponse.ok) {
                    const analysisData = await analysisResponse.json();
                    displayAiAnalysis(analysisData);
                    currentAiData = analysisData;
                } else {
                    const errorData = await analysisResponse.json();
                    document.getElementById('aiAnalysis').innerHTML = `
                        <div class="ai-error">
                            AI Î∂ÑÏÑù ÏÉùÏÑ± Ïã§Ìå®: ${errorData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}
                            <br><br>
                            <small>üí° Gemini API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏùÑ Ïàò ÏûàÏäµÎãàÎã§. Í∞úÎ∞úÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.</small>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading AI analysis:', error);
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-error">
                        AI Î∂ÑÏÑù Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
            }
        }
        
        // AI ÏöîÏïΩ ÌëúÏãú
        function displayAiSummary(data) {
            const container = document.getElementById('aiSummary');
            
            const html = `
                <div class="ai-summary-title">
                    ${data.company_name} Ïû¨Î¨¥ ÏÉÅÌÉú AI ÏöîÏïΩ
                </div>
                <div class="ai-summary-text">
                    ${data.summary}
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // AI ÏÉÅÏÑ∏ Î∂ÑÏÑù ÌëúÏãú
        function displayAiAnalysis(data) {
            const container = document.getElementById('aiAnalysis');
            
            let html = `
                <div class="ai-analysis-header">
                    <h3>ü§ñ AI Ïû¨Î¨¥ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h3>
                </div>
                <div class="ai-analysis-text">${data.ai_analysis}</div>
                <div class="ai-disclaimer">
                    ‚ö†Ô∏è <strong>Ï£ºÏùòÏÇ¨Ìï≠:</strong> Ïù¥ Î∂ÑÏÑùÏùÄ AIÍ∞Ä ÏÉùÏÑ±Ìïú Í≤ÉÏúºÎ°ú Ï∞∏Í≥†Ïö©ÏúºÎ°úÎßå ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî. 
                    Ìà¨Ïûê Í≤∞Ï†ï ÏãúÏóêÎäî Î∞òÎìúÏãú Ï†ÑÎ¨∏Í∞ÄÏùò Ï°∞Ïñ∏ÏùÑ Íµ¨ÌïòÍ±∞ÎÇò Ï∂îÍ∞ÄÏ†ÅÏù∏ Î∂ÑÏÑùÏùÑ ÏßÑÌñâÌïòÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Ïû¨Î¨¥Íµ¨Ï°∞ Î∂ÑÏÑù ÌëúÏãú
        function displayBalanceStructure(data) {
            const equationContainer = document.getElementById('balanceEquation');
            const analysisContainer = document.getElementById('balanceStructureAnalysis');
            const balanceEq = data.balance_equation;
            
            // ÌöåÍ≥ÑÎì±Ïãù ÌëúÏãú
            let equationHtml = `
                <div class="balance-equation">ÏûêÏÇ∞ = Î∂ÄÏ±Ñ + ÏûêÎ≥∏</div>
                <div class="equation-values">
                    <div class="equation-item">
                        <h4>ÏûêÏÇ∞Ï¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_assets)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">=</div>
                    </div>
                    <div class="equation-item">
                        <h4>Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_liabilities)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">+</div>
                    </div>
                    <div class="equation-item">
                        <h4>ÏûêÎ≥∏Ï¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_equity)}</div>
                    </div>
                </div>
            `;
            
            // Îì±Ïãù Í∑†Ìòï ÏÉÅÌÉú ÌëúÏãú
            if (balanceEq.equation_balance !== undefined) {
                const balanceClass = balanceEq.equation_balance ? 'balanced' : 'unbalanced';
                const balanceText = balanceEq.equation_balance ? 
                    '‚úÖ ÌöåÍ≥ÑÎì±ÏãùÏù¥ Í∑†ÌòïÏùÑ Ïù¥Î£®Í≥† ÏûàÏäµÎãàÎã§' : 
                    `‚ö†Ô∏è ÌöåÍ≥ÑÎì±ÏãùÏóê Ïò§Ï∞®Í∞Ä ÏûàÏäµÎãàÎã§ (${balanceEq.balance_error_rate}%)`;
                
                equationHtml += `
                    <div class="equation-balance ${balanceClass}">
                        ${balanceText}
                    </div>
                `;
            }
            
            equationContainer.innerHTML = equationHtml;
            
            // Íµ¨ÏÑ±ÏöîÏÜå Î∂ÑÏÑù ÌëúÏãú - Ï¢åÏö∞ Î†àÏù¥ÏïÑÏõÉ
            let analysisHtml = '<div class="balance-structure-layout">';
            
            // Ï¢åÏ∏°: ÏûêÏÇ∞ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-left">';
            analysisHtml += '<div class="balance-section-title assets">üè¶ ÏûêÏÇ∞ (Assets)</div>';
            
            const assets = data.asset_composition;
            if (Object.keys(assets).length > 0) {
                if (assets.current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïú†ÎèôÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.non_current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÎπÑÏú†ÎèôÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.non_current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.inventory) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïû¨Í≥†ÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.inventory)}</span>
                        </div>
                    `;
                }
                if (assets.receivables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Îß§Ï∂úÏ±ÑÍ∂å</span>
                            <span class="component-value">${formatCurrency(assets.receivables)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            
            // Ïö∞Ï∏°: Î∂ÄÏ±ÑÏôÄ ÏûêÎ≥∏
            analysisHtml += '<div class="balance-right">';
            
            // Ïö∞Ï∏° ÏÉÅÎã®: Î∂ÄÏ±Ñ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-right-top">';
            analysisHtml += '<div class="balance-section-title liabilities">üìä Î∂ÄÏ±Ñ (Liabilities)</div>';
            
            const liabilities = data.liability_composition;
            if (Object.keys(liabilities).length > 0) {
                if (liabilities.current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïú†ÎèôÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.non_current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÎπÑÏú†ÎèôÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.non_current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.borrowings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ï∞®ÏûÖÍ∏à</span>
                            <span class="component-value">${formatCurrency(liabilities.borrowings)}</span>
                        </div>
                    `;
                }
                if (liabilities.payables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Îß§ÏûÖÏ±ÑÎ¨¥</span>
                            <span class="component-value">${formatCurrency(liabilities.payables)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            
            // Ïö∞Ï∏° ÌïòÎã®: ÏûêÎ≥∏ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-right-bottom">';
            analysisHtml += '<div class="balance-section-title equity">üíé ÏûêÎ≥∏ (Equity)</div>';
            
            const equity = data.equity_composition;
            if (Object.keys(equity).length > 0) {
                if (equity.capital_stock) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏûêÎ≥∏Í∏à</span>
                            <span class="component-value">${formatCurrency(equity.capital_stock)}</span>
                        </div>
                    `;
                }
                if (equity.retained_earnings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïù¥ÏùµÏûâÏó¨Í∏à</span>
                            <span class="component-value">${formatCurrency(equity.retained_earnings)}</span>
                        </div>
                    `;
                }
                if (equity.other_comprehensive_income) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Í∏∞ÌÉÄÌè¨Í¥ÑÏÜêÏùµÎàÑÍ≥ÑÏï°</span>
                            <span class="component-value">${formatCurrency(equity.other_comprehensive_income)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            analysisHtml += '</div>';
            
            analysisHtml += '</div>';
            analysisContainer.innerHTML = analysisHtml;
        }
        
        // Ïû¨Î¨¥Íµ¨Ï°∞ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createBalanceStructureChart(data) {
            if (analysisCharts.balanceStructure) {
                analysisCharts.balanceStructure.destroy();
            }
            
            const ctx = document.getElementById('balanceStructureChart').getContext('2d');
            const balanceEq = data.balance_equation;
            
            if (!balanceEq.total_assets || !balanceEq.total_liabilities || !balanceEq.total_equity) {
                return;
            }
            
            // ÏûêÏÇ∞ = Î∂ÄÏ±Ñ + ÏûêÎ≥∏ ÏãúÍ∞ÅÌôî (Ï†ÅÏ∏µ ÎßâÎåÄ Ï∞®Ìä∏)
            const chartData = {
                labels: ['Ïû¨Î¨¥Íµ¨Ï°∞'],
                datasets: [
                    {
                        label: 'Î∂ÄÏ±Ñ',
                        data: [Math.round(balanceEq.total_liabilities / 1000000)],
                        backgroundColor: 'rgba(220, 53, 69, 0.8)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'ÏûêÎ≥∏',
                        data: [Math.round(balanceEq.total_equity / 1000000)],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    }
                ]
            };
            
            analysisCharts.balanceStructure = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Ïû¨Î¨¥Íµ¨Ï°∞: ÏûêÏÇ∞ ${formatCurrency(balanceEq.total_assets)} = Î∂ÄÏ±Ñ + ÏûêÎ≥∏`
                        },
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const total = balanceEq.total_assets / 1000000;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.dataset.label}: ${value.toLocaleString()}Î∞±ÎßåÏõê (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value, context) {
                                const total = balanceEq.total_assets / 1000000;
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${value.toLocaleString()}\n(${percentage}%)`;
                            },
                            anchor: 'center',
                            align: 'center',
                            offset: 0
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'ÌöåÍ≥ÑÎì±Ïãù Íµ¨Ï°∞'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    }
                }
            });
        }
        
        // Îß§Ï∂ú Î∂ÑÏÑù ÌëúÏãú
        function displayRevenueAnalysis(data) {
            const container = document.getElementById('revenueAnalysis');
            const revenue = data.revenue_analysis;
            
            if (!revenue || !revenue.current_revenue) {
                container.innerHTML = '<div class="error">üìã Îß§Ï∂ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = '<div class="analysis-grid">';
            
            // Îß§Ï∂úÏï° Ï†ïÎ≥¥
            html += `
                <div class="analysis-card">
                    <h4>üí∞ Îß§Ï∂úÏï° ÌòÑÌô©</h4>
                    <div class="metric-row">
                        <span class="metric-label">ÎãπÍ∏∞ Îß§Ï∂úÏï°</span>
                        <span class="metric-value">${formatCurrency(revenue.current_revenue)}</span>
                    </div>
            `;
            
            if (revenue.previous_revenue) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Ï†ÑÍ∏∞ Îß§Ï∂úÏï°</span>
                        <span class="metric-value">${formatCurrency(revenue.previous_revenue)}</span>
                    </div>
                `;
            }
            
            if (revenue.previous_revenue) {
                const revenueChange = revenue.current_revenue - revenue.previous_revenue;
                const changeClass = revenueChange > 0 ? 'positive' : 
                                   revenueChange < 0 ? 'negative' : 'neutral';
                const changeText = revenueChange > 0 ? 
                    `+${formatCurrency(revenueChange)}` : 
                    formatCurrency(revenueChange);
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ï¶ùÍ∞êÏï°</span>
                        <span class="metric-value ${changeClass}">${changeText}</span>
                    </div>
                `;
            }
            
            if (revenue.revenue_growth_rate !== null) {
                const growthClass = revenue.revenue_growth_rate > 0 ? 'positive' : 
                                   revenue.revenue_growth_rate < 0 ? 'negative' : 'neutral';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${growthClass}">${revenue.revenue_growth_rate}%</span>
                    </div>
                `;
            }
            
            html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ìä∏Î†åÎìú</span>
                        <span class="metric-value">${revenue.revenue_trend}</span>
                    </div>
                </div>
            `;
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ÏàòÏùµÏÑ± Î∂ÑÏÑù ÌëúÏãú
        function displayProfitabilityAnalysis(data) {
            const container = document.getElementById('profitabilityAnalysis');
            const profitability = data.profitability_analysis;
            
            let html = '<div class="analysis-grid">';
            
            // ÏàòÏùµÏÑ± ÏßÄÌëú
            html += `
                <div class="analysis-card">
                    <h4>üìà ÏàòÏùµÏÑ± ÏßÄÌëú</h4>
            `;
            
            if (profitability.gross_profit_margin !== undefined) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂úÏ¥ùÏù¥ÏùµÎ•†</span>
                        <span class="metric-value">${profitability.gross_profit_margin}%</span>
                    </div>
                `;
            }
            
            if (profitability.operating_profit_margin !== undefined) {
                const marginClass = profitability.operating_profit_margin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏòÅÏóÖÏù¥ÏùµÎ•†</span>
                        <span class="metric-value ${marginClass}">${profitability.operating_profit_margin}%</span>
                    </div>
                `;
            }
            
            if (profitability.net_profit_margin !== undefined) {
                const marginClass = profitability.net_profit_margin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏàúÏù¥ÏùµÎ•†</span>
                        <span class="metric-value ${marginClass}">${profitability.net_profit_margin}%</span>
                    </div>
                `;
            }
            
            // EBITDA Ï∂îÍ∞Ä
            if (currentDetailedData && currentDetailedData.ebitda !== null) {
                const ebitdaAmount = Math.round(currentDetailedData.ebitda / 1000000);
                const ebitdaClass = currentDetailedData.ebitda > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">EBITDA</span>
                        <span class="metric-value ${ebitdaClass}">${ebitdaAmount.toLocaleString()}Î∞±ÎßåÏõê</span>
                    </div>
                `;
            }
            
            html += '</div>';
            
            // ROA, ROE
            html += `
                <div class="analysis-card">
                    <h4>üéØ Ìà¨ÏûêÏàòÏùµÎ•†</h4>
            `;
            
            if (profitability.roa !== undefined) {
                const roaClass = profitability.roa > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROA (Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†)</span>
                        <span class="metric-value ${roaClass}">${profitability.roa}%</span>
                    </div>
                `;
            }
            
            if (profitability.roe !== undefined) {
                const roeClass = profitability.roe > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROE (ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†)</span>
                        <span class="metric-value ${roeClass}">${profitability.roe}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // Ïû¨Î¨¥ÎπÑÏú® Î∂ÑÏÑù ÌëúÏãú
        function displayRatiosAnalysis(data) {
            const container = document.getElementById('ratiosAnalysis');
            const ratios = data.financial_ratios;
            
            let html = '<div class="analysis-grid">';
            
            // ÏïàÏ†ïÏÑ± ÎπÑÏú®
            html += `
                <div class="analysis-card">
                    <h4>‚öñÔ∏è Ïû¨Î¨¥ ÏïàÏ†ïÏÑ±</h4>
            `;
            
            if (ratios.debt_to_equity_ratio !== undefined) {
                const debtClass = ratios.debt_to_equity_ratio > 100 ? 'negative' : 
                                 ratios.debt_to_equity_ratio > 50 ? 'neutral' : 'positive';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÎ≥∏)</span>
                        <span class="metric-value ${debtClass}">${ratios.debt_to_equity_ratio}%</span>
                    </div>
                `;
            }
            
            if (ratios.equity_ratio !== undefined) {
                const equityClass = ratios.equity_ratio > 50 ? 'positive' : 
                                   ratios.equity_ratio > 30 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ÎπÑÏú®</span>
                        <span class="metric-value ${equityClass}">${ratios.equity_ratio}%</span>
                    </div>
                `;
            }
            
            if (ratios.debt_to_assets_ratio !== undefined) {
                const debtAssetsClass = ratios.debt_to_assets_ratio < 30 ? 'positive' : 
                                       ratios.debt_to_assets_ratio < 50 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÏÇ∞)</span>
                        <span class="metric-value ${debtAssetsClass}">${ratios.debt_to_assets_ratio}%</span>
                    </div>
                `;
            }
            
            // ÏÉÅÏÑ∏ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ï∂îÍ∞Ä ÎπÑÏú®Îì§ ÌëúÏãú
            if (currentDetailedData && currentDetailedData.ratios) {
                const detailedRatios = currentDetailedData.ratios;
                
                // Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®
                if (detailedRatios.interest_coverage_ratio !== undefined) {
                    const coverageClass = detailedRatios.interest_coverage_ratio > 3 ? 'positive' : 
                                         detailedRatios.interest_coverage_ratio > 1.5 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®</span>
                            <span class="metric-value ${coverageClass}">${detailedRatios.interest_coverage_ratio}Î∞∞</span>
                        </div>
                    `;
                }
                
                // ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ
                if (currentDetailedData.financial_metrics && currentDetailedData.financial_metrics.operating_cash_flow !== null) {
                    const cashFlowAmount = Math.round(currentDetailedData.financial_metrics.operating_cash_flow / 1000000);
                    const cashFlowClass = currentDetailedData.financial_metrics.operating_cash_flow > 0 ? 'positive' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ</span>
                            <span class="metric-value ${cashFlowClass}">${cashFlowAmount.toLocaleString()}Î∞±ÎßåÏõê</span>
                        </div>
                    `;
                }
                
                // Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•† (ROA)
                if (detailedRatios.roa !== undefined) {
                    const roaClass = detailedRatios.roa > 5 ? 'positive' : 
                                    detailedRatios.roa > 2 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•† (ROA)</span>
                            <span class="metric-value ${roaClass}">${detailedRatios.roa}%</span>
                        </div>
                    `;
                }
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // ÏÑ±Í≥ºÏßÄÌëú Î∂ÑÏÑù ÌëúÏãú
        function displayPerformanceAnalysis(data) {
            const container = document.getElementById('performanceAnalysis');
            const performance = data.performance_indicators;
            
            let html = '<div class="analysis-grid">';
            
            // ÏÑ±Ïû•ÏÑ± ÏßÄÌëú
            html += `
                <div class="analysis-card">
                    <h4>üéØ ÏÑ±Ïû•ÏÑ± ÏßÄÌëú</h4>
            `;
            
            if (performance.total_assets_growth !== undefined) {
                const assetGrowthClass = performance.total_assets_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Ï¥ùÏûêÏÇ∞ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${assetGrowthClass}">${performance.total_assets_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.equity_growth !== undefined) {
                const equityGrowthClass = performance.equity_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${equityGrowthClass}">${performance.equity_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.net_income_growth !== undefined) {
                const incomeGrowthClass = performance.net_income_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏàúÏù¥Ïùµ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${incomeGrowthClass}">${performance.net_income_growth}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // Îß§Ï∂ú Ï∞®Ìä∏ ÏÉùÏÑ±
        function createRevenueChart(data) {
            if (analysisCharts.revenue) {
                analysisCharts.revenue.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const revenue = data.revenue_analysis;
            
            if (!revenue.current_revenue) return;
            
            const previousRevenue = revenue.previous_revenue ? Math.round(revenue.previous_revenue / 1000000) : 0;
            const currentRevenue = Math.round(revenue.current_revenue / 1000000);
            const revenueChange = currentRevenue - previousRevenue;
            const revenueChangePercent = previousRevenue > 0 ? ((revenueChange / previousRevenue) * 100).toFixed(1) : 0;
            
            const chartData = {
                labels: ['Ï†ÑÍ∏∞', 'ÎãπÍ∏∞'],
                datasets: [{
                    label: 'Ï†ÑÍ∏∞ Îß§Ï∂úÏï°',
                    data: [previousRevenue, 0],
                    backgroundColor: 'rgba(118, 75, 162, 0.8)',
                    borderColor: 'rgba(118, 75, 162, 1)',
                    borderWidth: 2
                }, {
                    label: 'ÎãπÍ∏∞ Îß§Ï∂úÏï°',
                    data: [0, currentRevenue],
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 2
                }]
            };
            
            // Ï∞®Ìä∏ ÏúÑÏóê Í∏àÏï° ÌëúÏãú
            const chartValuesContainer = document.getElementById('revenueChartValues');
            chartValuesContainer.innerHTML = `
                <div class="chart-value-item">
                    <div class="chart-value-label">Ï†ÑÍ∏∞ Îß§Ï∂úÏï°</div>
                    <div class="chart-value-amount previous">${previousRevenue.toLocaleString()}Î∞±ÎßåÏõê</div>
                </div>
                <div class="chart-value-item">
                    <div class="chart-value-label">ÎãπÍ∏∞ Îß§Ï∂úÏï°</div>
                    <div class="chart-value-amount current">${currentRevenue.toLocaleString()}Î∞±ÎßåÏõê</div>
                </div>
            `;
            
            analysisCharts.revenue = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Îß§Ï∂úÏï° ÎπÑÍµê'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const label = context.label === 'Ï†ÑÍ∏∞' ? 'Ï†ÑÍ∏∞ Îß§Ï∂úÏï°' : 'ÎãπÍ∏∞ Îß§Ï∂úÏï°';
                                    return `${label}: ${value.toLocaleString()}Î∞±ÎßåÏõê`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value) {
                                return value > 0 ? value.toLocaleString() + 'Î∞±ÎßåÏõê' : '';
                            }
                        }
                    }
                }
            });
            
            // Ï¶ùÍ∞ê Ï†ïÎ≥¥ ÌëúÏãú
            if (previousRevenue > 0) {
                const changeInfoContainer = document.getElementById('revenueChangeInfo');
                const changeClass = revenueChange >= 0 ? 'positive' : 'negative';
                const changeText = revenueChange >= 0 ? 
                    `+${revenueChange.toLocaleString()}` : 
                    `${revenueChange.toLocaleString()}`;
                
                changeInfoContainer.innerHTML = `
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">Ï¶ùÍ∞êÏï°</div>
                        <div class="revenue-change-value ${changeClass}">${changeText}Î∞±ÎßåÏõê</div>
                    </div>
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">Ï¶ùÍ∞êÎ•†</div>
                        <div class="revenue-change-value ${changeClass}">${revenueChangePercent}%</div>
                    </div>
                `;
            } else {
                document.getElementById('revenueChangeInfo').innerHTML = '';
            }
        }
        
        // ÏàòÏùµÏÑ± Ï∞®Ìä∏Îì§ ÏÉùÏÑ± (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function createProfitabilityCharts(data) {
            const profitability = data.profitability_analysis;
            if (!profitability) return;
            
            // Í∏∞Ï°¥ Ï∞®Ìä∏Îì§ Ï†ïÎ¶¨
            ['margin', 'roe', 'roa', 'profitability'].forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            // 1. Ïù¥ÏùµÎ•† ÏßÄÌëú Ï∞®Ìä∏
            createMarginChart(profitability);
            
            // 2. ROE Ï∞®Ìä∏
            createROEChart(profitability);
            
            // 3. ROA Ï∞®Ìä∏
            createROAChart(profitability);
            
            // 4. ROE vs ROA ÎπÑÍµê Ï∞®Ìä∏
            createROEvsROAChart(profitability);
        }
        
        // Ïù¥ÏùµÎ•† ÏßÄÌëú Ï∞®Ìä∏
        function createMarginChart(profitability) {
            const ctx = document.getElementById('marginChart').getContext('2d');
            
            const labels = [];
            const values = [];
            const colors = ['rgba(54, 162, 235, 0.8)', 'rgba(255, 99, 132, 0.8)', 'rgba(75, 192, 192, 0.8)'];
            
            if (profitability.gross_profit_margin !== undefined) {
                labels.push('Îß§Ï∂úÏ¥ùÏù¥ÏùµÎ•†');
                values.push(profitability.gross_profit_margin);
            }
            if (profitability.operating_profit_margin !== undefined) {
                labels.push('ÏòÅÏóÖÏù¥ÏùµÎ•†');
                values.push(profitability.operating_profit_margin);
            }
            if (profitability.net_profit_margin !== undefined) {
                labels.push('ÏàúÏù¥ÏùµÎ•†');
                values.push(profitability.net_profit_margin);
            }
            
            if (labels.length === 0) return;
            
            analysisCharts.margin = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values.map(v => Math.abs(v)), // ÏùåÏàò Í∞íÎèÑ ÏãúÍ∞ÅÌôî Í∞ÄÎä•ÌïòÎèÑÎ°ù
                        backgroundColor: colors.slice(0, values.length),
                        borderColor: colors.slice(0, values.length).map(c => c.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const originalValue = values[context.dataIndex];
                                    return context.label + ': ' + originalValue.toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ROE Ï∞®Ìä∏ (Í≤åÏù¥ÏßÄ ÌòïÌÉú)
        function createROEChart(profitability) {
            const ctx = document.getElementById('roeChart').getContext('2d');
            
            if (profitability.roe === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roeValue = profitability.roe;
            const maxValue = Math.max(30, Math.abs(roeValue) * 1.5); // ÏµúÎåÄÍ∞í ÏÑ§Ï†ï
            
            analysisCharts.roe = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROE', 'ÎÇòÎ®∏ÏßÄ'],
                    datasets: [{
                        data: [Math.abs(roeValue), maxValue - Math.abs(roeValue)],
                        backgroundColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roeValue >= 0 ? '#28a745' : '#dc3545';
                        ctx.fillText(roeValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ROA Ï∞®Ìä∏ (Í≤åÏù¥ÏßÄ ÌòïÌÉú)
        function createROAChart(profitability) {
            const ctx = document.getElementById('roaChart').getContext('2d');
            
            if (profitability.roa === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roaValue = profitability.roa;
            const maxValue = Math.max(20, Math.abs(roaValue) * 1.5); // ÏµúÎåÄÍ∞í ÏÑ§Ï†ï
            
            analysisCharts.roa = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROA', 'ÎÇòÎ®∏ÏßÄ'],
                    datasets: [{
                        data: [Math.abs(roaValue), maxValue - Math.abs(roaValue)],
                        backgroundColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roaValue >= 0 ? '#ffc107' : '#dc3545';
                        ctx.fillText(roaValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ROE vs ROA ÎπÑÍµê Ï∞®Ìä∏
        function createROEvsROAChart(profitability) {
            const ctx = document.getElementById('profitabilityChart').getContext('2d');
            
            const roeValue = profitability.roe || 0;
            const roaValue = profitability.roa || 0;
            
            analysisCharts.profitability = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ROE', 'ROA'],
                    datasets: [{
                        label: 'ÏàòÏùµÏÑ± ÏßÄÌëú',
                        data: [Math.abs(roeValue), Math.abs(roaValue)],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: Math.max(20, Math.max(Math.abs(roeValue), Math.abs(roaValue)) * 1.2),
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Ïû¨Î¨¥ÎπÑÏú® Ï∞®Ìä∏ ÏÉùÏÑ±
        function createRatiosChart(data) {
            if (analysisCharts.ratios) {
                analysisCharts.ratios.destroy();
            }
            
            const ctx = document.getElementById('ratiosChart').getContext('2d');
            const ratios = data.financial_ratios;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'ÎπÑÏú® (%)',
                    data: [],
                    backgroundColor: [
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(153, 102, 255, 0.8)',
                        'rgba(255, 99, 132, 0.8)'
                    ],
                    borderWidth: 2
                }]
            };
            
            if (ratios.debt_to_equity_ratio !== undefined) {
                chartData.labels.push('Î∂ÄÏ±ÑÎπÑÏú®');
                chartData.datasets[0].data.push(ratios.debt_to_equity_ratio);
            }
            if (ratios.equity_ratio !== undefined) {
                chartData.labels.push('ÏûêÍ∏∞ÏûêÎ≥∏ÎπÑÏú®');
                chartData.datasets[0].data.push(ratios.equity_ratio);
            }
            if (ratios.debt_to_assets_ratio !== undefined) {
                chartData.labels.push('Î∂ÄÏ±Ñ/ÏûêÏÇ∞ÎπÑÏú®');
                chartData.datasets[0].data.push(ratios.debt_to_assets_ratio);
            }
            
            analysisCharts.ratios = new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ïû¨Î¨¥ ÏïàÏ†ïÏÑ± ÎπÑÏú®'
                        }
                    }
                }
            });
        }
        
        // ÏÑ±Í≥ºÏßÄÌëú Ï∞®Ìä∏ ÏÉùÏÑ±
        function createPerformanceChart(data) {
            if (analysisCharts.performance) {
                analysisCharts.performance.destroy();
            }
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const performance = data.performance_indicators;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'Ï¶ùÍ∞ÄÏú® (%)',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };
            
            if (performance.total_assets_growth !== undefined) {
                chartData.labels.push('Ï¥ùÏûêÏÇ∞ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.total_assets_growth);
            }
            if (performance.equity_growth !== undefined) {
                chartData.labels.push('ÏûêÍ∏∞ÏûêÎ≥∏ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.equity_growth);
            }
            if (performance.net_income_growth !== undefined) {
                chartData.labels.push('ÏàúÏù¥Ïùµ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.net_income_growth);
            }
            
            analysisCharts.performance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ÏÑ±Ïû•ÏÑ± ÏßÄÌëú'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ï¶ùÍ∞ÄÏú® (%)'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
