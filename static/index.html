<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Ïò§ÌîàÎã§Ìä∏ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù ÏÑúÎπÑÏä§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .search-input-container {
            position: relative;
            flex: 1;
        }
        
        .search-input-container::after {
            content: 'üîç';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            min-width: 400px;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        

        
        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }
        
        .results-container {
            margin-top: 20px;
        }
        
        .result-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .result-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .corp-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .corp-name:hover {
            color: #667eea;
        }
        
        .corp-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .corp-code {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .stock-code {
            background: #f3e5f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 500;
        }
        
        .loading::before {
            content: '‚è≥';
            margin-right: 8px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .more-results {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* ÏóêÎü¨ ÌåùÏóÖ Ïä§ÌÉÄÏùº */
        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 400px;
            text-align: center;
            animation: popupFadeIn 0.3s ease-out;
        }
        
        .error-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            animation: overlayFadeIn 0.3s ease-out;
        }
        
        .error-popup-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .error-popup-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #c62828;
            margin-bottom: 15px;
        }
        
        .error-popup-message {
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .error-popup-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        
        .error-popup-button:hover {
            transform: translateY(-2px);
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @keyframes overlayFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        /* ÏûÑÏõêÏ†ïÎ≥¥ ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .executives-table-container {
            margin-top: 20px;
        }
        
        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .executives-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 14px;
            table-layout: fixed;
        }
        
        .executives-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        /* Ïª¨ÎüºÎ≥Ñ ÎÑàÎπÑ ÏÑ§Ï†ï */
        .executives-table th:nth-child(1), /* ÏÑ±Î™Ö */
        .executives-table td:nth-child(1) {
            width: 8%;
            min-width: 80px;
        }
        
        .executives-table th:nth-child(2), /* ÏßÅÏúÑ */
        .executives-table td:nth-child(2) {
            width: 12%;
            min-width: 120px;
        }
        
        .executives-table th:nth-child(3), /* ÏÑ±Î≥Ñ */
        .executives-table td:nth-child(3) {
            width: 6%;
            min-width: 60px;
        }
        
        .executives-table th:nth-child(4), /* Ï∂úÏÉùÎÖÑÏõî */
        .executives-table td:nth-child(4) {
            width: 10%;
            min-width: 100px;
        }
        
        .executives-table th:nth-child(5), /* Îì±Í∏∞ÏûÑÏõê */
        .executives-table td:nth-child(5) {
            width: 8%;
            min-width: 80px;
        }
        
        .executives-table th:nth-child(6), /* ÏÉÅÍ∑ºÏó¨Î∂Ä */
        .executives-table td:nth-child(6) {
            width: 8%;
            min-width: 80px;
        }
        
        .executives-table th:nth-child(7), /* Îã¥ÎãπÏóÖÎ¨¥ */
        .executives-table td:nth-child(7) {
            width: 15%;
            min-width: 120px;
        }
        
        .executives-table th:nth-child(8), /* Í≤ΩÎ†• */
        .executives-table td:nth-child(8) {
            width: 8%;
            min-width: 70px;
        }
        
        .executives-table th:nth-child(9), /* Ïû¨ÏßÅÍ∏∞Í∞Ñ */
        .executives-table td:nth-child(9) {
            width: 15%;
            min-width: 120px;
        }
        
        .executives-table th:nth-child(10), /* ÏûÑÍ∏∞ÎßåÎ£åÏùº */
        .executives-table td:nth-child(10) {
            width: 15%;
            min-width: 120px;
        }
        
        .executives-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e1e5e9;
            vertical-align: middle;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Í≤ΩÎ†• ÏÉÅÏÑ∏ Î≥¥Í∏∞ Î≤ÑÌäº */
        .career-detail-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .career-detail-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Î™®Îã¨ ÌåùÏóÖ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            transform: scale(1.2);
            opacity: 0.8;
        }
        
        .modal-body {
            padding: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        #careerModalContent {
            line-height: 1.8;
            font-size: 14px;
            color: #333;
        }
        
        #careerModalContent br {
            margin-bottom: 8px;
        }
        
        /* Îã¥ÎãπÏóÖÎ¨¥ Ïª¨ÎüºÏùÄ Í∏¥ ÌÖçÏä§Ìä∏ ÌóàÏö© */
        .executives-table td:nth-child(7) {
            white-space: normal;
            text-align: left;
            line-height: 1.4;
            height: auto;
            min-height: 40px;
        }
        
        /* Ïû¨ÏßÅÍ∏∞Í∞ÑÍ≥º ÏûÑÍ∏∞ÎßåÎ£åÏùº Ïª¨ÎüºÎèÑ Í∏¥ ÌÖçÏä§Ìä∏ ÌóàÏö© */
        .executives-table td:nth-child(9),
        .executives-table td:nth-child(10) {
            white-space: normal;
            text-align: center;
            line-height: 1.4;
            height: auto;
            min-height: 40px;
        }
        
        .executives-table tbody tr:hover {
            background-color: #f8f9fa;
            transition: background-color 0.2s;
        }
        
        .executives-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .executives-table tbody tr:nth-child(even):hover {
            background-color: #e9ecef;
        }
        
        .executive-name {
            font-weight: 600;
            color: #333;
        }
        
        .executive-position {
            font-weight: 500;
            color: #667eea;
        }
        
        .executive-gender {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .executive-gender.male {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .executive-gender.female {
            background-color: #fce4ec;
            color: #c2185b;
        }
        
        .executive-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .executive-status.registered {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .executive-status.unregistered {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .executive-status.fulltime {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .executive-status.parttime {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .feature-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        /* Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ïä§ÌÉÄÏùº */
        .financial-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            display: none;
        }
        
        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .financial-title {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }
        
        .financial-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .financial-controls select,
        .financial-controls button {
            padding: 8px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .financial-controls button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .financial-controls button:hover {
            transform: translateY(-1px);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%) !important;
            color: white !important;
            font-weight: 600;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #ff5722 0%, #e68900 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .reset-btn:active {
            transform: translateY(0px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }
        
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .summary-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: #ff5252;
        }
        
        /* ÌÉ≠ Ïä§ÌÉÄÏùº */
        .analysis-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            gap: 5px;
        }
        
        .analysis-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .analysis-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .analysis-tab:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Î∂ÑÏÑù Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analysis-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .metric-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        
        .metric-value.positive {
            color: #28a745;
        }
        
        .metric-value.negative {
            color: #dc3545;
        }
        
        .metric-value.neutral {
            color: #6c757d;
        }
        
        /* ÎπÑÍµê Ï∞®Ìä∏ Ïä§ÌÉÄÏùº */
        .comparison-chart {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-chart h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart-small {
            height: 300px;
        }
        
        /* Ïû¨Î¨¥Íµ¨Ï°∞ Ïä§ÌÉÄÏùº */
        .balance-equation-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .balance-equation {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .equation-values {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .equation-item {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }
        
        .equation-item h4 {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .equation-item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .equation-balance {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .equation-balance.balanced {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid rgba(40, 167, 69, 0.5);
        }
        
        .equation-balance.unbalanced {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
        }
        
        .balance-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Ïû¨Î¨¥Íµ¨Ï°∞ Ï¢åÏö∞ Î†àÏù¥ÏïÑÏõÉ */
        .balance-structure-layout {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .balance-left {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #28a745;
        }
        
        .balance-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .balance-right-top {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #dc3545;
        }
        
        .balance-right-bottom {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #007bff;
        }
        
        .balance-section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        
        .balance-section-title.assets {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .balance-section-title.liabilities {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .balance-section-title.equity {
            background: linear-gradient(135deg, #007bff, #6610f2);
        }
        
        /* Îß§Ï∂ú Ï¶ùÍ∞ê Ï†ïÎ≥¥ Ïä§ÌÉÄÏùº */
        .revenue-change-info {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .revenue-change-item {
            display: inline-block;
            margin: 0 20px;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .revenue-change-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .revenue-change-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .revenue-change-value.positive {
            color: #28a745;
        }
        
        .revenue-change-value.negative {
            color: #dc3545;
        }
        
        .revenue-change-value.neutral {
            color: #6c757d;
        }
        
        /* Ï∞®Ìä∏ Í∞í ÌëúÏãú Ïä§ÌÉÄÏùº */
        .chart-values-display {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
        }
        
        .chart-value-item {
            text-align: center;
            padding: 8px 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 120px;
        }
        
        .chart-value-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .chart-value-amount {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-value-amount.previous {
            color: #764ba2;
        }
        
        .chart-value-amount.current {
            color: #667eea;
        }
        
        .component-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .component-card.assets {
            border-left-color: #28a745;
        }
        
        .component-card.liabilities {
            border-left-color: #dc3545;
        }
        
        .component-card.equity {
            border-left-color: #007bff;
        }
        
        .component-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .component-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .component-item:last-child {
            border-bottom: none;
        }
        
        .component-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .component-value {
            font-weight: bold;
            color: #333;
        }
        
        /* AI Î∂ÑÏÑù Ïä§ÌÉÄÏùº */
        .ai-summary-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .ai-summary-container::before {
            content: "ü§ñ";
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            opacity: 0.7;
        }
        
        .ai-summary-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .ai-summary-text {
            font-size: 1em;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .ai-analysis-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .ai-analysis-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.4em;
        }
        
        .ai-analysis-text {
            font-size: 1em;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
        }
        
        .ai-analysis-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .ai-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .ai-loading .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
        }
        
        .ai-disclaimer {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }
        
        /* ÏàòÏùµÏÑ± Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº */
        .profitability-charts-container {
            margin-top: 20px;
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .chart-box h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
            text-align: center;
            font-weight: 600;
        }
        
        .chart-box .chart-wrapper {
            height: 250px;
        }
        
        @media (max-width: 1024px) {
            .chart-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* Î¶¨ÏÖã Î©îÏãúÏßÄ Ïä§ÌÉÄÏùº */
        .reset-message {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            margin: 20px 0;
            animation: fadeInScale 0.5s ease-out;
        }
        
        .reset-icon {
            font-size: 3em;
            margin-right: 20px;
            animation: rotate 2s linear infinite;
        }
        
        .reset-text h3 {
            margin: 0 0 10px 0;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .reset-text p {
            margin: 0;
            font-size: 1em;
            opacity: 0.9;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
            
            .corp-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Ïò§ÌîàÎã§Ìä∏ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù</h1>
            <p>Í∏∞ÏóÖ Ï†ïÎ≥¥Î•º Îπ†Î•¥Í≥† Ï†ïÌôïÌïòÍ≤å Í≤ÄÏÉâÌïòÏÑ∏Ïöî</p>
        </div>
        
        <div class="search-container">
            <div class="search-form">
                <div class="search-input-container">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="ÌöåÏÇ¨Î™Ö, ÏòÅÎ¨∏ÌöåÏÇ¨Î™Ö ÎòêÎäî Ï£ºÏãùÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: ÏÇºÏÑ±Ï†ÑÏûê, Samsung, 005930)">
                </div>
                <button onclick="searchCorporations()" class="search-btn">üîç Í≤ÄÏÉâ</button>
            </div>
            
            <div id="stats" class="stats"></div>
            <div id="results" class="results-container"></div>
        </div>
        
        <!-- Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú ÏòÅÏó≠ -->
        <div id="financialContainer" class="financial-container">
            <button class="close-btn" onclick="closeFinancialData()">√ó</button>
            
            <div class="financial-header">
                <h2 id="financialTitle" class="financial-title">Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞</h2>
                <div class="financial-controls">
                    <select id="yearSelect">
                        <option value="2024">2024ÎÖÑ</option>
                        <option value="2023">2023ÎÖÑ</option>
                        <option value="2022">2022ÎÖÑ</option>
                        <option value="2021">2021ÎÖÑ</option>
                        <option value="2020">2020ÎÖÑ</option>
                        <option value="2019">2019ÎÖÑ</option>
                    </select>
                    <select id="reportSelect">
                        <option value="11011">ÏÇ¨ÏóÖÎ≥¥Í≥†ÏÑú</option>
                        <option value="11012">Î∞òÍ∏∞Î≥¥Í≥†ÏÑú</option>
                        <option value="11013">1Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú</option>
                        <option value="11014">3Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú</option>
                    </select>
                    <button onclick="refreshFinancialData()">üìä Ïû¨Î¨¥Ï°∞Ìöå</button>
                    <button class="reset-btn" onclick="completeReset()" title="Î™®Îì† Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî">üîÑ Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
                </div>
            </div>
            
            <!-- Î∂ÑÏÑù ÌÉ≠ -->
            <div class="analysis-tabs">
                <button class="analysis-tab active" onclick="switchTab('overview')">üìä Í∞úÏöî</button>
                <button class="analysis-tab" onclick="switchTab('ai')">ü§ñ AIÎ∂ÑÏÑù</button>
                <button class="analysis-tab" onclick="switchTab('balance')">üèóÔ∏è Ïû¨Î¨¥Íµ¨Ï°∞</button>
                <button class="analysis-tab" onclick="switchTab('revenue')">üí∞ Îß§Ï∂úÎ∂ÑÏÑù</button>
                <button class="analysis-tab" onclick="switchTab('profitability')">üìà ÏàòÏùµÏÑ±</button>
                <button class="analysis-tab" onclick="switchTab('ratios')">‚öñÔ∏è Ïû¨Î¨¥ÎπÑÏú®</button>
                <button class="analysis-tab" onclick="switchTab('performance')">üéØ ÏÑ±Í≥ºÏßÄÌëú</button>
                <button class="analysis-tab" onclick="switchTab('executives')">üë• ÏûÑÏõêÏ†ïÎ≥¥</button>
            </div>
            
            <!-- Í∞úÏöî ÌÉ≠ -->
            <div id="overviewTab" class="tab-content active">
                <div id="financialSummary" class="financial-summary"></div>
                <div class="chart-container">
                    <div id="financialChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- AI Î∂ÑÏÑù ÌÉ≠ -->
            <div id="aiTab" class="tab-content">
                <div id="aiSummary" class="ai-summary-container"></div>
                <div id="aiAnalysis" class="ai-analysis-container"></div>
            </div>
            
            <!-- Ïû¨Î¨¥Íµ¨Ï°∞ ÌÉ≠ -->
            <div id="balanceTab" class="tab-content">
                <div id="balanceEquation" class="balance-equation-container"></div>
                <div id="balanceStructureAnalysis" class="balance-structure-layout"></div>
                <div class="comparison-chart">
                    <h4>üèóÔ∏è Ïû¨Î¨¥Íµ¨Ï°∞ ÏãúÍ∞ÅÌôî</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="balanceStructureChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Îß§Ï∂ú Î∂ÑÏÑù ÌÉ≠ -->
            <div id="revenueTab" class="tab-content">
                <div id="revenueAnalysis"></div>
                <div class="comparison-chart">
                    <h4>üìä Îß§Ï∂ú Ï∂îÏù¥ Î∂ÑÏÑù</h4>
                    <div id="revenueChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper chart-small">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div id="revenueChangeInfo" class="revenue-change-info"></div>
                </div>
            </div>
            
            <!-- ÏàòÏùµÏÑ± ÌÉ≠ -->
            <div id="profitabilityTab" class="tab-content">
                <div id="profitabilityAnalysis"></div>
                <div class="profitability-charts-container">
                    <div class="chart-row">
                        <div class="chart-box">
                            <h4>üìä ÏàòÏùµÏÑ± ÏßÄÌëú ÎπÑÍµê</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>üí∞ Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏö© Íµ¨Ï°∞</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="costStructureChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ïû¨Î¨¥ÎπÑÏú® ÌÉ≠ -->
            <div id="ratiosTab" class="tab-content">
                <div id="ratiosAnalysis"></div>
                <div class="comparison-chart">
                    <h4>‚öñÔ∏è Ïû¨Î¨¥ ÏïàÏ†ïÏÑ±</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="ratiosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ÏÑ±Í≥ºÏßÄÌëú ÌÉ≠ -->
            <div id="performanceTab" class="tab-content">
                <div id="performanceAnalysis"></div>
                <div class="comparison-chart">
                    <h4>üéØ ÏÑ±Ïû•ÏÑ± ÏßÄÌëú</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ÏûÑÏõêÏ†ïÎ≥¥ ÌÉ≠ -->
            <div id="executivesTab" class="tab-content">
                <div id="executivesAnalysis"></div>
                <div class="executives-table-container">
                    <h4>üë• ÏûÑÏõê ÌòÑÌô©</h4>
                    <div class="table-wrapper">
                        <table id="executivesTable" class="executives-table">
                            <thead>
                                <tr>
                                    <th>ÏÑ±Î™Ö</th>
                                    <th>ÏßÅÏúÑ</th>
                                    <th>ÏÑ±Î≥Ñ</th>
                                    <th>Ï∂úÏÉùÎÖÑÏõî</th>
                                    <th>Îì±Í∏∞ÏûÑÏõê</th>
                                    <th>ÏÉÅÍ∑ºÏó¨Î∂Ä</th>
                                    <th>Îã¥ÎãπÏóÖÎ¨¥</th>
                                    <th>Í≤ΩÎ†•</th>
                                    <th>Ïû¨ÏßÅÍ∏∞Í∞Ñ</th>
                                    <th>ÏûÑÍ∏∞ÎßåÎ£åÏùº</th>
                                </tr>
                            </thead>
                            <tbody id="executivesTableBody">
                                <!-- ÏûÑÏõê Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h3>üìä Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ</h3>
                <p>Ïò§ÌîàÎã§Ìä∏Ïóê Îì±Î°ùÎêú Î™®Îì† Í∏∞ÏóÖÏùò Ï†ïÎ≥¥Î•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í≤ÄÏÉâÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üè∑Ô∏è Îã§ÏñëÌïú Í≤ÄÏÉâ ÏòµÏÖò</h3>
                <p>ÌöåÏÇ¨Î™Ö, ÏòÅÎ¨∏ÌöåÏÇ¨Î™Ö, Ï£ºÏãùÏΩîÎìú Îì± Îã§ÏñëÌïú Î∞©Î≤ïÏúºÎ°ú Í≤ÄÏÉâÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üíº Ï†ïÌôïÌïú Í∏∞ÏóÖ Ï†ïÎ≥¥</h3>
                <p>Í∏∞ÏóÖÏΩîÎìú, Ï£ºÏãùÏΩîÎìú Îì± Ï†ïÌôïÌïú Í∏∞ÏóÖ ÏãùÎ≥Ñ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.</p>
            </div>
            <div class="feature-card">
                <h3>üìà Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÏãúÍ∞ÅÌôî</h3>
                <p>Í∏∞ÏóÖÎ™ÖÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ Ïò§ÌîàÎã§Ìä∏ APIÎ•º ÌÜµÌï¥ Ïã§Ï†ú Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÍ≥† Ï∞®Ìä∏Î°ú ÏãúÍ∞ÅÌôîÌï©ÎãàÎã§.</p>
            </div>
        </div>
    </div>

    <script>
        // Chart.js DataLabels ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
        Chart.register(ChartDataLabels);
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentChart = null;
        let currentCorpCode = null;
        let currentCompanyName = '';
        let currentCompanyCode = '';
        let analysisCharts = {
            revenue: null,
            profitability: null,
            costStructure: null,
            roe: null,
            roa: null,
            ratios: null,
            performance: null,
            balanceStructure: null
        };
        let currentAnalysisData = null;
        let currentBalanceData = null;
        let currentDetailedData = null;
        let currentAiData = null;
        
        // ÏïàÏ†ÑÌïú Î≥ÄÏàò Ï†ëÍ∑ºÏùÑ ÏúÑÌïú Ìó¨Ìçº Ìï®Ïàò
        function safeGet(obj, path, defaultValue = null) {
            try {
                return path.split('.').reduce((current, key) => {
                    return current && current[key] !== undefined ? current[key] : defaultValue;
                }, obj);
            } catch (error) {
                console.warn('safeGet error:', error);
                return defaultValue;
            }
        }
        
        // ÎîîÎ∞îÏö¥Ïã±ÏùÑ ÏúÑÌïú ÌÉÄÏù¥Î®∏ Î≥ÄÏàò
        let searchTimer = null;
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï†ÑÏ≤¥ Í∏∞ÏóÖ Ïàò Ï°∞Ìöå
        window.onload = function() {
            loadTotalCount();
            setupCareerDetailListeners(); // Í≤ΩÎ†• ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            
            // Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            const searchInput = document.getElementById('searchInput');
            
            // ÏûÖÎ†• Ïù¥Î≤§Ìä∏ (Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ)
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                // Ïù¥Ï†Ñ ÌÉÄÏù¥Î®∏ Ï∑®ÏÜå
                if (searchTimer) {
                    clearTimeout(searchTimer);
                }
                
                // Í≤ÄÏÉâÏñ¥Í∞Ä ÏóÜÏúºÎ©¥ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
                if (!query) {
                    document.getElementById('results').innerHTML = '<div class="no-results">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
                    return;
                }
                
                // 300ms ÌõÑÏóê Í≤ÄÏÉâ Ïã§Ìñâ (ÎîîÎ∞îÏö¥Ïã±)
                searchTimer = setTimeout(() => {
                    searchCorporations();
                }, 300);
            });
            
            // Enter ÌÇ§ Ïù¥Î≤§Ìä∏ (Ï¶âÏãú Í≤ÄÏÉâ)
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // ÌÉÄÏù¥Î®∏ Ï∑®ÏÜåÌïòÍ≥† Ï¶âÏãú Í≤ÄÏÉâ
                    if (searchTimer) {
                        clearTimeout(searchTimer);
                    }
                    searchCorporations();
                }
            });
        };
        
        // Ï†ÑÏ≤¥ Í∏∞ÏóÖ Ïàò Ï°∞Ìöå
        async function loadTotalCount() {
            try {
                const response = await fetch('/api/corporations/count');
                const count = await response.json();
                document.getElementById('stats').innerHTML = 
                    `üìà ÌòÑÏû¨ <strong>${count.toLocaleString()}</strong>Í∞ú Í∏∞ÏóÖÏù¥ Îì±Î°ùÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`;
            } catch (error) {
                console.error('Error loading total count:', error);
                document.getElementById('stats').innerHTML = 
                    'üìà Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ïó∞Í≤∞ Ï§ëÏûÖÎãàÎã§...';
            }
        }
        
        // Í∏∞ÏóÖ Í≤ÄÏÉâ
        async function searchCorporations() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>';
                return;
            }
            
            // Î°úÎî© ÌëúÏãú (Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâÏö© Í∞ÑÎã®Ìïú Î°úÎî©)
            resultsDiv.innerHTML = '<div class="loading">üîç Í≤ÄÏÉâ Ï§ë...</div>';
            
            try {
                const response = await fetch(`/api/corporations/search?q=${encodeURIComponent(query)}`);
                const corporations = await response.json();
                
                if (corporations.length === 0) {
                    resultsDiv.innerHTML = '<div class="no-results">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ Í≤ÄÏÉâÏñ¥Î•º ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</div>';
                    return;
                }
                
                // Í≤∞Í≥º ÌëúÏãú (ÏµúÎåÄ 20Í∞úÎ°ú Ï†úÌïú)
                const maxResults = 20;
                const displayCorporations = corporations.slice(0, maxResults);
                const totalCount = corporations.length;
                
                let html = `<h3>Í≤ÄÏÉâ Í≤∞Í≥º (${totalCount}Í∞ú${totalCount > maxResults ? `, ÏÉÅÏúÑ ${maxResults}Í∞ú ÌëúÏãú` : ''})</h3>`;
                displayCorporations.forEach(corp => {
                    html += `
                        <div class="result-item">
                            <div class="corp-name" onclick="showFinancialData('${corp.corp_code}', '${corp.corp_name.replace(/'/g, "&apos;")}')">${corp.corp_name} üìà</div>
                            <div class="corp-details">
                                <div><strong>Í∏∞ÏóÖÏΩîÎìú:</strong> <span class="corp-code">${corp.corp_code}</span></div>
                                <div><strong>Ï£ºÏãùÏΩîÎìú:</strong> <span class="stock-code">${corp.stock_code || 'N/A'}</span></div>
                                <div><strong>ÏòÅÎ¨∏Î™Ö:</strong> ${corp.corp_eng_name || 'N/A'}</div>
                                <div><strong>ÏàòÏ†ïÏùº:</strong> ${formatDate(corp.modify_date)}</div>
                            </div>
                        </div>
                    `;
                });
                
                // Îçî ÎßéÏùÄ Í≤∞Í≥ºÍ∞Ä ÏûàÏùÑ Îïå ÏïàÎÇ¥ Î©îÏãúÏßÄ
                if (totalCount > maxResults) {
                    html += `<div class="more-results">üí° Îçî Ï†ïÌôïÌïú Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏãúÎ©¥ Îçî ÎßéÏùÄ Í≤∞Í≥ºÎ•º Î≥º Ïàò ÏûàÏäµÎãàÎã§.</div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error searching corporations:', error);
                resultsDiv.innerHTML = '<div class="error">Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</div>';
            }
        }
        
        // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
        function formatDate(dateStr) {
            if (!dateStr || dateStr.length !== 8) return dateStr;
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            return `${year}-${month}-${day}`;
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        async function showFinancialData(corpCode, corpName) {
            try {
                currentCorpCode = corpCode;
                currentCompanyName = corpName;
                currentCompanyCode = corpCode;
                
                // Í∏∞Ï°¥ Ï∞®Ìä∏ Ï†ïÎ¶¨
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }
                
                // Í∏∞Ï°¥ Î∂ÑÏÑù Ï∞®Ìä∏Îì§ Ï†ïÎ¶¨
                Object.keys(analysisCharts).forEach(key => {
                    if (analysisCharts[key]) {
                        analysisCharts[key].destroy();
                        analysisCharts[key] = null;
                    }
                });
            
            // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('financialTitle').textContent = `${corpName} Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞`;
            
            // ÎÖÑÎèÑ ÎìúÎ°≠Îã§Ïö¥ ÎèôÏ†Å ÏÉùÏÑ±
            updateYearDropdown();
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('financialContainer').style.display = 'block';
            
            // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            await loadFinancialData();
            
            // Ïä§ÌÅ¨Î°§
            document.getElementById('financialContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            } catch (error) {
                console.error('Error in showFinancialData:', error);
                showErrorPopup(
                    '‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù',
                    'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n\nÏû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'
                );
            }
        }
        
        // ÎÖÑÎèÑ ÎìúÎ°≠Îã§Ïö¥ ÎèôÏ†Å ÏÉùÏÑ±
        function updateYearDropdown() {
            const yearSelect = document.getElementById('yearSelect');
            const currentYear = new Date().getFullYear();
            
            // Í∏∞Ï°¥ ÏòµÏÖò Ï†úÍ±∞
            yearSelect.innerHTML = '';
            
            // ÏµúÍ∑º 10ÎÖÑÍ∞ÑÏùò ÎÖÑÎèÑ ÏÉùÏÑ± (ÌòÑÏû¨ ÎÖÑÎèÑÎ∂ÄÌÑ∞ Ïó≠Ïàú)
            for (let year = currentYear; year >= currentYear - 9; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ÎÖÑ`;
                
                // 2024ÎÖÑÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                if (year === 2024) {
                    option.selected = true;
                }
                
                yearSelect.appendChild(option);
            }
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadFinancialData() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // Î°úÎî© ÌëúÏãú
                document.getElementById('financialSummary').innerHTML = '<div class="loading">üìä Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>';
                
                // Í∏∞Î≥∏ ÏöîÏïΩ Îç∞Ïù¥ÌÑ∞, ÏÉÅÏÑ∏ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞, Ïû¨Î¨¥Íµ¨Ï°∞ Îç∞Ïù¥ÌÑ∞Î•º Î≥ëÎ†¨Î°ú Î°úÎìú
                const [summaryResponse, analysisResponse, balanceResponse, detailedResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/analysis?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/balance-structure?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/detailed-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok && analysisResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    const analysisData = await analysisResponse.json();
                    const balanceData = balanceResponse.ok ? await balanceResponse.json() : null;
                    const detailedData = detailedResponse.ok ? await detailedResponse.json() : null;
                    
                    currentAnalysisData = analysisData;
                    currentBalanceData = balanceData;
                    currentDetailedData = detailedData;
                    
                    console.log('Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÏôÑÎ£å:');
                    console.log('currentAnalysisData:', currentAnalysisData);
                    console.log('currentDetailedData:', currentDetailedData);
                    
                    // ÎîîÎ≤ÑÍπÖ: ÏàòÏùµÏÑ± Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                    if (currentAnalysisData && currentAnalysisData.profitability_analysis) {
                        console.log('ÏàòÏùµÏÑ± Îç∞Ïù¥ÌÑ∞ Î∞úÍ≤¨:', currentAnalysisData.profitability_analysis);
                        console.log('ÏòÅÏóÖÏù¥ÏùµÎ•†:', currentAnalysisData.profitability_analysis.operating_profit_margin);
                        console.log('ÏàúÏù¥ÏùµÎ•†:', currentAnalysisData.profitability_analysis.net_profit_margin);
                    } else {
                        console.log('ÏàòÏùµÏÑ± Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                    }
                    
                    // ÎîîÎ≤ÑÍπÖ: ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                    if (currentDetailedData && currentDetailedData.ratios) {
                        console.log('ÏÉÅÏÑ∏ ÎπÑÏú® Îç∞Ïù¥ÌÑ∞ Î∞úÍ≤¨:', currentDetailedData.ratios);
                    } else {
                        console.log('ÏÉÅÏÑ∏ ÎπÑÏú® Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                    }
                    
                    displayFinancialSummary(summaryData);
                    createFinancialChart(summaryData);
                    
                    // Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
                    if (balanceData) {
                        displayBalanceStructure(balanceData);
                    }
                    displayRevenueAnalysis(analysisData);
                    await displayProfitabilityAnalysis(analysisData);
                    displayRatiosAnalysis(analysisData);
                    displayPerformanceAnalysis(analysisData);
                    
                    // ÏàòÏùµÏÑ± Ï∞®Ìä∏ Ï¶âÏãú ÏÉùÏÑ± (Ï≤´ Î°úÎìú Ïãú)
                    createProfitabilityCharts(analysisData);
                    
                    // ÏûÑÏõêÏ†ïÎ≥¥ÎèÑ Ìï®Íªò Î°úÎìú
                    loadExecutivesInfo();
                    
                } else {
                    // ÏóêÎü¨ ÏùëÎãµ ÌôïÏù∏
                    let errorMessage = '';
                    let isYearDataError = false;
                    
                    if (!summaryResponse.ok) {
                        try {
                            const errorData = await summaryResponse.json();
                            if (errorData.error && errorData.error.includes('Ï°∞ÌöåÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§')) {
                                const year = document.getElementById('yearSelect').value;
                                const report = document.getElementById('reportSelect').value;
                                const reportName = getReportName(report);
                                errorMessage = `${currentCompanyName}Ïùò ${year}ÎÖÑ ${reportName} Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.`;
                                isYearDataError = true;
                            } else {
                                errorMessage = errorData.error || 'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.';
                            }
                        } catch (e) {
                            errorMessage = 'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.';
                        }
                    }
                    
                    if (isYearDataError) {
                        // ÎÖÑÎèÑÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú
                        showErrorPopup(
                            'üìä Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">üìã Ìï¥Îãπ ÎÖÑÎèÑÏùò Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                    } else if (errorMessage) {
                        // ÏùºÎ∞ò ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú
                        showErrorPopup(
                            '‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">üìã Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                    }
                    
                    // Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ÎèÑ ÌôïÏù∏
                    if (!analysisResponse.ok) {
                        console.warn('Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                }
                
            } catch (error) {
                console.error('Error loading financial data:', error);
                showErrorPopup(
                    '‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù',
                    'Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n\nÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÍ±∞ÎÇò Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.'
                );
                document.getElementById('financialSummary').innerHTML = 
                    '<div class="error">üìã Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
            }
        }
        
        // Ïû¨Î¨¥ ÏöîÏïΩ Ï†ïÎ≥¥ ÌëúÏãú
        function displayFinancialSummary(data) {
            const summaryDiv = document.getElementById('financialSummary');
            const accounts = data.key_accounts;
            
            let html = '';
            
            if (accounts.assets) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏûêÏÇ∞Ï¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.assets)}</div>
                    </div>
                `;
            }
            
            if (accounts.liabilities) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.liabilities)}</div>
                    </div>
                `;
            }
            
            if (accounts.equity) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏûêÎ≥∏Ï¥ùÍ≥Ñ</div>
                        <div class="summary-value">${formatCurrency(accounts.equity)}</div>
                    </div>
                `;
            }
            
            if (accounts.revenue) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">Îß§Ï∂úÏï°</div>
                        <div class="summary-value">${formatCurrency(accounts.revenue)}</div>
                    </div>
                `;
            }
            
            if (accounts.operating_profit) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÏòÅÏóÖÏù¥Ïùµ</div>
                        <div class="summary-value">${formatCurrency(accounts.operating_profit)}</div>
                    </div>
                `;
            }
            
            if (accounts.net_income) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ÎãπÍ∏∞ÏàúÏù¥Ïùµ</div>
                        <div class="summary-value">${formatCurrency(accounts.net_income)}</div>
                    </div>
                `;
            }
            
            if (!html) {
                html = '<div class="error">üìä ÌëúÏãúÌï† Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
            }
            
            summaryDiv.innerHTML = html;
        }
        
        // Ïû¨Î¨¥ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createFinancialChart(data) {
            const ctx = document.getElementById('financialChart').getContext('2d');
            const accounts = data.key_accounts;
            
            // Ïù¥Ï†Ñ Ï∞®Ìä∏ ÏÇ≠Ï†ú
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'Í∏àÏï° (Î∞±ÎßåÏõê)',
                    data: [],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 205, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 205, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            
            // Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
            if (accounts.assets) {
                chartData.labels.push('ÏûêÏÇ∞Ï¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.assets / 1000000)); // Î∞±ÎßåÏõê Îã®ÏúÑ
            }
            if (accounts.liabilities) {
                chartData.labels.push('Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.liabilities / 1000000));
            }
            if (accounts.equity) {
                chartData.labels.push('ÏûêÎ≥∏Ï¥ùÍ≥Ñ');
                chartData.datasets[0].data.push(Math.round(accounts.equity / 1000000));
            }
            if (accounts.revenue) {
                chartData.labels.push('Îß§Ï∂úÏï°');
                chartData.datasets[0].data.push(Math.round(accounts.revenue / 1000000));
            }
            if (accounts.operating_profit) {
                chartData.labels.push('ÏòÅÏóÖÏù¥Ïùµ');
                chartData.datasets[0].data.push(Math.round(accounts.operating_profit / 1000000));
            }
            if (accounts.net_income) {
                chartData.labels.push('ÎãπÍ∏∞ÏàúÏù¥Ïùµ');
                chartData.datasets[0].data.push(Math.round(accounts.net_income / 1000000));
            }
            
            // Ï∞®Ìä∏ ÏúÑÏóê Í∏àÏï° ÌëúÏãú
            const chartValuesContainer = document.getElementById('financialChartValues');
            let valuesHtml = '';
            chartData.labels.forEach((label, index) => {
                const value = chartData.datasets[0].data[index];
                valuesHtml += `
                    <div class="chart-value-item">
                        <div class="chart-value-label">${label}</div>
                        <div class="chart-value-amount">${value.toLocaleString()}Î∞±ÎßåÏõê</div>
                    </div>
                `;
            });
            chartValuesContainer.innerHTML = valuesHtml;
            
            // Ï∞®Ìä∏ ÏÉùÏÑ±
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentCompanyName || data.company_info?.stock_code || 'ÌöåÏÇ¨'} Ï£ºÏöî Ïû¨Î¨¥ ÏßÄÌëú (${data.company_info?.bsns_year || 'N/A'}ÎÖÑ)`
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: function(value) {
                                return value.toLocaleString() + 'Î∞±ÎßåÏõê';
                            }
                        }
                    }
                }
            });
        }
        
        // ÌÜµÌôî Ìè¨Îß∑ÌåÖ
        function formatCurrency(amount) {
            if (!amount) return 'N/A';
            
            if (Math.abs(amount) >= 1000000000000) {
                return (amount / 1000000000000).toFixed(1) + 'Ï°∞Ïõê';
            } else if (Math.abs(amount) >= 100000000) {
                return (amount / 100000000).toFixed(0) + 'ÏñµÏõê';
            } else if (Math.abs(amount) >= 10000) {
                return (amount / 10000).toFixed(0) + 'ÎßåÏõê';
            } else {
                return amount.toLocaleString() + 'Ïõê';
            }
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
        function refreshFinancialData() {
            if (currentCorpCode) {
                // AI Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî (ÏÉàÎ°úÏö¥ ÎÖÑÎèÑ/Î≥¥Í≥†ÏÑúÎ°ú Î≥ÄÍ≤Ω Ïãú)
                currentAiData = null;
                loadFinancialData();
            }
        }
        
        // ÌÜµÌï©Îêú Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function completeReset() {
            // ÌôïÏù∏ ÎåÄÌôîÏ∞Ω ÌëúÏãú
            const confirmed = confirm('Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† ÏÉàÎ°úÏö¥ Í≤ÄÏÉâÏùÑ ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n- Í≤ÄÏÉâ Í≤∞Í≥º\n- Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞\n- Ï∞®Ìä∏ Î∞è Î∂ÑÏÑù\n- AI Î∂ÑÏÑù Í≤∞Í≥º');
            
            if (confirmed) {
                // 1. Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ï∞Ω Îã´Í∏∞ Î∞è Ï∞®Ìä∏ Ï†ïÎ¶¨
                closeFinancialData();
                
                // 2. Í≤ÄÏÉâ ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî Î∞è Ìè¨Ïª§Ïä§
                const searchInput = document.getElementById('searchInput');
                searchInput.value = '';
                searchInput.focus();
                
                // 3. Í≤ÄÏÉâ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                
                // 4. ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
                const statsContainer = document.getElementById('stats');
                statsContainer.innerHTML = '';
                
                // 5. Ï†ÑÏó≠ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
                currentCorpCode = null;
                currentCompanyName = null;
                currentFinancialData = null;
                currentAnalysisData = null;
                currentBalanceData = null;
                currentAiData = null;
                
                // 6. ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú
                showCompleteResetMessage();
                
                // 7. ÌéòÏù¥ÏßÄ ÏÉÅÎã®ÏúºÎ°ú Ïä§ÌÅ¨Î°§
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // ÌÜµÌï© Ï¥àÍ∏∞Ìôî ÏôÑÎ£å Î©îÏãúÏßÄ ÌëúÏãú
        function showCompleteResetMessage() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `
                <div class="reset-message">
                    <div class="reset-icon">üîÑ</div>
                    <div class="reset-text">
                        <h3>Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å!</h3>
                        <p>Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. ÏúÑÏùò Í≤ÄÏÉâÏ∞ΩÏóê ÌöåÏÇ¨Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏó¨ ÏÉàÎ°úÏö¥ Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÏÑ∏Ïöî.</p>
                    </div>
                </div>
            `;
            
            // 4Ï¥à ÌõÑ Î©îÏãúÏßÄ ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (resultsContainer.innerHTML.includes('reset-message')) {
                    resultsContainer.innerHTML = '';
                }
            }, 4000);
        }
        
        // ÏóêÎü¨ ÌåùÏóÖ ÌëúÏãú Ìï®Ïàò
        function showErrorPopup(title, message) {
            // Í∏∞Ï°¥ ÌåùÏóÖÏù¥ ÏûàÎã§Î©¥ Ï†úÍ±∞
            const existingPopup = document.querySelector('.error-popup-overlay');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'error-popup-overlay';
            
            const popup = document.createElement('div');
            popup.className = 'error-popup';
            popup.innerHTML = `
                <div class="error-popup-icon">‚ö†Ô∏è</div>
                <div class="error-popup-title">${title}</div>
                <div class="error-popup-message">${message}</div>
                <button class="error-popup-button" onclick="closeErrorPopup()">ÌôïÏù∏</button>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            
            // ESC ÌÇ§Î°ú ÌåùÏóÖ Îã´Í∏∞
            const handleEscKey = (event) => {
                if (event.key === 'Escape') {
                    closeErrorPopup();
                    document.removeEventListener('keydown', handleEscKey);
                }
            };
            document.addEventListener('keydown', handleEscKey);
            
            // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ÏúºÎ°ú ÌåùÏóÖ Îã´Í∏∞
            overlay.addEventListener('click', (event) => {
                if (event.target === overlay) {
                    closeErrorPopup();
                }
            });
        }
        
        // ÏóêÎü¨ ÌåùÏóÖ Îã´Í∏∞ Ìï®Ïàò
        function closeErrorPopup() {
            const overlay = document.querySelector('.error-popup-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Î≥¥Í≥†ÏÑú ÏΩîÎìúÎ•º Ïù¥Î¶ÑÏúºÎ°ú Î≥ÄÌôòÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
        function getReportName(reportCode) {
            const reportNames = {
                '11011': 'ÏÇ¨ÏóÖÎ≥¥Í≥†ÏÑú',
                '11012': 'Î∞òÍ∏∞Î≥¥Í≥†ÏÑú',
                '11013': '1Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú',
                '11014': '3Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú'
            };
            return reportNames[reportCode] || 'Î≥¥Í≥†ÏÑú';
        }
        
        // Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞ Ï∞Ω Îã´Í∏∞
        function closeFinancialData() {
            document.getElementById('financialContainer').style.display = 'none';
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // Î™®Îì† Î∂ÑÏÑù Ï∞®Ìä∏ ÏÇ≠Ï†ú
            Object.keys(analysisCharts).forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            currentCorpCode = null;
            currentCompanyName = null;
            currentFinancialData = null;
            currentAnalysisData = null;
            currentBalanceData = null;
            currentAiData = null;
            
            // Ï≤´ Î≤àÏß∏ ÌÉ≠ÏúºÎ°ú Î¶¨ÏÖã
            switchTab('overview');
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.analysis-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Ï∞®Ìä∏ ÏÉùÏÑ± (ÌïÑÏöîÌïú Í≤ΩÏö∞)
            if (currentAnalysisData) {
                switch(tabName) {
                    case 'ai':
                        if (!currentAiData) {
                            loadAiAnalysis();
                        }
                        break;
                    case 'balance':
                        if (currentBalanceData) {
                            createBalanceStructureChart(currentBalanceData);
                        }
                        break;
                    case 'revenue':
                        createRevenueChart(currentAnalysisData);
                        break;
                    case 'profitability':
                        createProfitabilityCharts(currentAnalysisData);
                        break;
                    case 'ratios':
                        createRatiosChart(currentAnalysisData);
                        break;
                    case 'performance':
                        createPerformanceChart(currentAnalysisData);
                        break;
                    case 'executives':
                        loadExecutivesInfo();
                        break;
                }
            }
        }
        
        // AI Î∂ÑÏÑù Î°úÎìú
        async function loadAiAnalysis() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-loading">
                        <div class="spinner"></div>
                        <div>ü§ñ AIÍ∞Ä Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
                
                // AI ÏöîÏïΩÍ≥º ÏÉÅÏÑ∏ Î∂ÑÏÑùÏùÑ Î≥ëÎ†¨Î°ú Î°úÎìú
                const [summaryResponse, analysisResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/ai-summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/ai-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    displayAiSummary(summaryData);
                } else {
                    const errorData = await summaryResponse.json();
                    document.getElementById('aiSummary').innerHTML = `
                        <div class="ai-error">
                            AI ÏöîÏïΩ ÏÉùÏÑ± Ïã§Ìå®: ${errorData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}
                        </div>
                    `;
                }
                
                if (analysisResponse.ok) {
                    const analysisData = await analysisResponse.json();
                    displayAiAnalysis(analysisData);
                    currentAiData = analysisData;
                } else {
                    const errorData = await analysisResponse.json();
                    document.getElementById('aiAnalysis').innerHTML = `
                        <div class="ai-error">
                            AI Î∂ÑÏÑù ÏÉùÏÑ± Ïã§Ìå®: ${errorData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}
                            <br><br>
                            <small>üí° Gemini API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏùÑ Ïàò ÏûàÏäµÎãàÎã§. Í∞úÎ∞úÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.</small>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading AI analysis:', error);
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-error">
                        AI Î∂ÑÏÑù Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
            }
        }
        
        // ÏûÑÏõêÏ†ïÎ≥¥ Î°úÎìú
        async function loadExecutivesInfo() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
                document.getElementById('executivesAnalysis').innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>üë• ÏûÑÏõê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§...</div>
                    </div>
                `;
                
                const response = await fetch(`/api/executives/${currentCorpCode}?year=${year}&report=${report}`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayExecutivesInfo(data);
                } else {
                    const errorData = await response.json();
                    document.getElementById('executivesAnalysis').innerHTML = `
                        <div class="error">
                            ÏûÑÏõê Ï†ïÎ≥¥ Ï°∞Ìöå Ïã§Ìå®: ${errorData.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading executives info:', error);
                document.getElementById('executivesAnalysis').innerHTML = `
                    <div class="error">
                        ÏûÑÏõê Ï†ïÎ≥¥ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}
                    </div>
                `;
            }
        }
        
        // ÏûÑÏõêÏ†ïÎ≥¥ ÌëúÏãú
        function displayExecutivesInfo(data) {
            try {
                const container = document.getElementById('executivesAnalysis');
                const tableBody = document.getElementById('executivesTableBody');
                
                if (!data || !data.company_info) {
                    throw new Error('Îç∞Ïù¥ÌÑ∞ ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
                }
                
                // ÌöåÏÇ¨ Ï†ïÎ≥¥ ÌëúÏãú
                const companyInfo = `
                    <div class="company-info">
                        <h3>üè¢ ${currentCompanyName || 'ÌöåÏÇ¨Î™Ö ÏóÜÏùå'}</h3>
                        <p>ÏÇ¨ÏóÖÏó∞ÎèÑ: ${data.company_info.bsns_year || 'N/A'}ÎÖÑ | Î≥¥Í≥†ÏÑú: ${getReportName(data.company_info.reprt_code) || 'N/A'}</p>
                    </div>
                `;
                
                container.innerHTML = companyInfo;
                
                // ÌÖåÏù¥Î∏î ÎÇ¥Ïö© ÏÉùÏÑ±
                if (data.executives && Array.isArray(data.executives) && data.executives.length > 0) {
                    let tableHtml = '';
                    
                    data.executives.forEach((exec, index) => {
                        try {
                            // ÏïàÏ†ÑÌïú Îç∞Ïù¥ÌÑ∞ Ï†ëÍ∑º
                                    const name = exec.name || '-';
        const position = exec.position || '-';
        const gender = exec.gender || '-';
        const birthDate = exec.birth_date || '-';
        const registeredExec = exec.registered_exec || '-';
        const fullTime = exec.full_time || '-';
        const responsibility = exec.responsibility || '-';
        const career = exec.career || '-';
        const tenure = exec.tenure || '-';
        const termExpiry = exec.term_expiry || '-';
        
        const genderClass = gender === 'ÎÇ®' ? 'male' : 'female';
        const registeredClass = registeredExec === 'ÏÇ¨ÎÇ¥Ïù¥ÏÇ¨' || registeredExec === 'ÏÇ¨Ïô∏Ïù¥ÏÇ¨' ? 'registered' : 'unregistered';
        const fulltimeClass = fullTime === 'ÏÉÅÍ∑º' ? 'fulltime' : 'parttime';
        
        // Í≤ΩÎ†•Ïù¥ ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå ÏÉÅÏÑ∏ Î≥¥Í∏∞ Î≤ÑÌäº ÌëúÏãú
        const careerDisplay = career !== '-' ? 
            `<button class="career-detail-btn" data-name="${name}" data-career="${career.replace(/"/g, '&quot;')}">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>` : 
            '-';
        
        tableHtml += `
            <tr>
                <td class="executive-name">${name}</td>
                <td class="executive-position">${position}</td>
                <td><span class="executive-gender ${genderClass}">${gender}</span></td>
                <td>${birthDate}</td>
                <td><span class="executive-status ${registeredClass}">${registeredExec}</span></td>
                <td><span class="executive-status ${fulltimeClass}">${fullTime}</span></td>
                <td>${responsibility}</td>
                <td>${careerDisplay}</td>
                <td>${tenure}</td>
                <td>${termExpiry}</td>
            </tr>
        `;
                        } catch (execError) {
                            console.error(`ÏûÑÏõê ${index + 1} Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò:`, execError);
                            // Ïò§Î•òÍ∞Ä Î∞úÏÉùÌïú ÏûÑÏõêÏùÄ Í±¥ÎÑàÎõ∞Í≥† Í≥ÑÏÜç ÏßÑÌñâ
                        }
                    });
                    
                    tableBody.innerHTML = tableHtml;
                } else {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 20px; color: #666;">
                                Ï°∞ÌöåÎêú ÏûÑÏõê Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('ÏûÑÏõêÏ†ïÎ≥¥ ÌëúÏãú Ï§ë Ïò§Î•ò:', error);
                const container = document.getElementById('executivesAnalysis');
                container.innerHTML = `
                    <div class="error">
                        ÏûÑÏõê Ï†ïÎ≥¥ ÌëúÏãú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}
                    </div>
                `;
            }
        }
        
        // Î≥¥Í≥†ÏÑú ÏΩîÎìúÎ•º Ïù¥Î¶ÑÏúºÎ°ú Î≥ÄÌôò
        function getReportName(reportCode) {
            const reportNames = {
                '11011': 'ÏÇ¨ÏóÖÎ≥¥Í≥†ÏÑú',
                '11012': 'Î∞òÍ∏∞Î≥¥Í≥†ÏÑú',
                '11013': '1Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú',
                '11014': '3Î∂ÑÍ∏∞Î≥¥Í≥†ÏÑú'
            };
            return reportNames[reportCode] || reportCode;
        }
        
        // AI ÏöîÏïΩ ÌëúÏãú
        function displayAiSummary(data) {
            const container = document.getElementById('aiSummary');
            
            const html = `
                <div class="ai-summary-title">
                    ${data.company_name} Ïû¨Î¨¥ ÏÉÅÌÉú AI ÏöîÏïΩ
                </div>
                <div class="ai-summary-text">
                    ${data.summary}
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // AI ÏÉÅÏÑ∏ Î∂ÑÏÑù ÌëúÏãú
        function displayAiAnalysis(data) {
            const container = document.getElementById('aiAnalysis');
            
            let html = `
                <div class="ai-analysis-header">
                    <h3>ü§ñ AI Ïû¨Î¨¥ Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h3>
                </div>
                <div class="ai-analysis-text">${data.ai_analysis}</div>
                <div class="ai-disclaimer">
                    ‚ö†Ô∏è <strong>Ï£ºÏùòÏÇ¨Ìï≠:</strong> Ïù¥ Î∂ÑÏÑùÏùÄ AIÍ∞Ä ÏÉùÏÑ±Ìïú Í≤ÉÏúºÎ°ú Ï∞∏Í≥†Ïö©ÏúºÎ°úÎßå ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî. 
                    Ìà¨Ïûê Í≤∞Ï†ï ÏãúÏóêÎäî Î∞òÎìúÏãú Ï†ÑÎ¨∏Í∞ÄÏùò Ï°∞Ïñ∏ÏùÑ Íµ¨ÌïòÍ±∞ÎÇò Ï∂îÍ∞ÄÏ†ÅÏù∏ Î∂ÑÏÑùÏùÑ ÏßÑÌñâÌïòÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Ïû¨Î¨¥Íµ¨Ï°∞ Î∂ÑÏÑù ÌëúÏãú
        function displayBalanceStructure(data) {
            console.log('displayBalanceStructure Ìò∏Ï∂úÎê®:', data);
            const equationContainer = document.getElementById('balanceEquation');
            const analysisContainer = document.getElementById('balanceStructureAnalysis');
            let balanceEq = data.balance_equation;
            
            // Î≥ÄÏàòÎì§ÏùÑ ÏïàÏ†ÑÌïòÍ≤å Ï¥àÍ∏∞Ìôî
            let totalEquity = data.balance_equation?.total_equity || 0;
            let actualCapitalStock = data.equity_composition?.capital_stock || 0;
            let actualRetainedEarnings = data.equity_composition?.retained_earnings || 0;
            
            // Í∏àÏúµÍ∏∞Í¥Ä Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù Î∞è Î≥¥Ï†ï
            const isFinancialInstitution = !data.company_info.stock_code || 
                ['066570', '105560', '316140', '138930', '086790'].includes(data.company_info.stock_code);
            
            if (isFinancialInstitution) {
                console.log('Í∏àÏúµÍ∏∞Í¥Ä Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù Î∞è Î≥¥Ï†ï Ï†ÅÏö©');
                
                // ÏûêÏÇ∞Í≥º Î∂ÄÏ±Ñ Íµ¨ÏÑ± ÏöîÏÜåÍ∞Ä ÎπÑÏñ¥ÏûàÎäî Í≤ΩÏö∞ Î∞±ÏóîÎìúÏóêÏÑú Ï∂îÏ†ïÎêú Í∞í ÏÇ¨Ïö©
                if (Object.keys(data.asset_composition).length === 0 && balanceEq.total_assets) {
                    console.log('ÏûêÏÇ∞ Íµ¨ÏÑ± ÏöîÏÜåÍ∞Ä ÎπÑÏñ¥ÏûàÏñ¥ Î∞±ÏóîÎìú Ï∂îÏ†ïÍ∞í ÏÇ¨Ïö©');
                }
                
                if (Object.keys(data.liability_composition).length === 0 && balanceEq.total_liabilities) {
                    console.log('Î∂ÄÏ±Ñ Íµ¨ÏÑ± ÏöîÏÜåÍ∞Ä ÎπÑÏñ¥ÏûàÏñ¥ Î∞±ÏóîÎìú Ï∂îÏ†ïÍ∞í ÏÇ¨Ïö©');
                }
            }
            
            // ÌöåÍ≥ÑÎì±Ïãù ÌëúÏãú
            let equationHtml = `
                <div class="balance-equation">ÏûêÏÇ∞ = Î∂ÄÏ±Ñ + ÏûêÎ≥∏</div>
                <div class="equation-values">
                    <div class="equation-item">
                        <h4>ÏûêÏÇ∞Ï¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_assets)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">=</div>
                    </div>
                    <div class="equation-item">
                        <h4>Î∂ÄÏ±ÑÏ¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_liabilities)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">+</div>
                    </div>
                    <div class="equation-item">
                        <h4>ÏûêÎ≥∏Ï¥ùÍ≥Ñ</h4>
                        <div class="value">${formatCurrency(balanceEq.total_equity)}</div>
                    </div>
                </div>
            `;
            
            // Îì±Ïãù Í∑†Ìòï ÏÉÅÌÉú ÌëúÏãú
            if (balanceEq.equation_balance !== undefined) {
                const balanceClass = balanceEq.equation_balance ? 'balanced' : 'unbalanced';
                const balanceText = balanceEq.equation_balance ? 
                    '‚úÖ ÌöåÍ≥ÑÎì±ÏãùÏù¥ Í∑†ÌòïÏùÑ Ïù¥Î£®Í≥† ÏûàÏäµÎãàÎã§' : 
                    `‚ö†Ô∏è ÌöåÍ≥ÑÎì±ÏãùÏóê Ïò§Ï∞®Í∞Ä ÏûàÏäµÎãàÎã§ (${balanceEq.balance_error_rate}%)`;
                
                equationHtml += `
                    <div class="equation-balance ${balanceClass}">
                        ${balanceText}
                    </div>
                `;
            }
            
            equationContainer.innerHTML = equationHtml;
            
            // Íµ¨ÏÑ±ÏöîÏÜå Î∂ÑÏÑù ÌëúÏãú - Ï¢åÏö∞ Î†àÏù¥ÏïÑÏõÉ
            let analysisHtml = '<div class="balance-structure-layout">';
            
            // Ï¢åÏ∏°: ÏûêÏÇ∞ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-left">';
            analysisHtml += '<div class="balance-section-title assets">üè¶ ÏûêÏÇ∞ (Assets)</div>';
            
            const assets = data.asset_composition;
            console.log('Ïû¨Î¨¥Íµ¨Ï°∞ - ÏûêÏÇ∞ Îç∞Ïù¥ÌÑ∞:', assets);
            if (Object.keys(assets).length > 0) {
                if (assets.current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïú†ÎèôÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.non_current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÎπÑÏú†ÎèôÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.non_current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.inventory) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïû¨Í≥†ÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.inventory)}</span>
                        </div>
                    `;
                }
                if (assets.receivables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Îß§Ï∂úÏ±ÑÍ∂å</span>
                            <span class="component-value">${formatCurrency(assets.receivables)}</span>
                        </div>
                    `;
                }
                if (assets.cash) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÌòÑÍ∏à Î∞è ÏòàÏπòÍ∏à</span>
                            <span class="component-value">${formatCurrency(assets.cash)}</span>
                        </div>
                    `;
                }
                if (assets.loans) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÎåÄÏ∂úÏ±ÑÍ∂å</span>
                            <span class="component-value">${formatCurrency(assets.loans)}</span>
                        </div>
                    `;
                }
                if (assets.fair_value_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Í≥µÏ†ïÍ∞ÄÏπòÏ∏°Ï†ïÍ∏àÏúµÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.fair_value_assets)}</span>
                        </div>
                    `;
                }
                if (assets.insurance_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Î≥¥ÌóòÍ≥ÑÏïΩÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.insurance_assets)}</span>
                        </div>
                    `;
                }
                if (assets.derivative_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÌååÏÉùÏÉÅÌíàÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.derivative_assets)}</span>
                        </div>
                    `;
                }
                if (assets.amortized_cost_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏÉÅÍ∞ÅÌõÑÏõêÍ∞ÄÏ∏°Ï†ïÏûêÏÇ∞</span>
                            <span class="component-value">${formatCurrency(assets.amortized_cost_assets)}</span>
                        </div>
                    `;
                }
            } else {
                // ÏûêÏÇ∞ Íµ¨ÏÑ± ÏöîÏÜåÍ∞Ä ÎπÑÏñ¥ÏûàÎäî Í≤ΩÏö∞ ÏïàÎÇ¥ Î©îÏãúÏßÄ
                analysisHtml += `
                    <div class="component-item">
                        <span class="component-label">ÏûêÏÇ∞ Íµ¨ÏÑ± Ï†ïÎ≥¥</span>
                        <span class="component-value" style="color: #666; font-style: italic;">ÏÉÅÏÑ∏ Íµ¨ÏÑ± Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§</span>
                    </div>
                `;
            }
            analysisHtml += '</div>';
            
            // Ïö∞Ï∏°: Î∂ÄÏ±ÑÏôÄ ÏûêÎ≥∏
            analysisHtml += '<div class="balance-right">';
            
            // Ïö∞Ï∏° ÏÉÅÎã®: Î∂ÄÏ±Ñ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-right-top">';
            analysisHtml += '<div class="balance-section-title liabilities">üìä Î∂ÄÏ±Ñ (Liabilities)</div>';
            
            const liabilities = data.liability_composition;
            console.log('Ïû¨Î¨¥Íµ¨Ï°∞ - Î∂ÄÏ±Ñ Îç∞Ïù¥ÌÑ∞:', liabilities);
            if (Object.keys(liabilities).length > 0) {
                if (liabilities.current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïú†ÎèôÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.non_current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÎπÑÏú†ÎèôÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.non_current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.borrowings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ï∞®ÏûÖÍ∏à</span>
                            <span class="component-value">${formatCurrency(liabilities.borrowings)}</span>
                        </div>
                    `;
                }
                if (liabilities.payables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Îß§ÏûÖÏ±ÑÎ¨¥</span>
                            <span class="component-value">${formatCurrency(liabilities.payables)}</span>
                        </div>
                    `;
                }
                if (liabilities.deposits) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏòàÏàòÍ∏à</span>
                            <span class="component-value">${formatCurrency(liabilities.deposits)}</span>
                        </div>
                    `;
                }
                if (liabilities.deposit_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏòàÏàòÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.deposit_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.insurance_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Î≥¥ÌóòÍ≥ÑÏïΩÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.insurance_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.derivative_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÌååÏÉùÏÉÅÌíàÎ∂ÄÏ±Ñ</span>
                            <span class="component-value">${formatCurrency(liabilities.derivative_liabilities)}</span>
                        </div>
                    `;
                }
            } else {
                // Î∂ÄÏ±Ñ Íµ¨ÏÑ± ÏöîÏÜåÍ∞Ä ÎπÑÏñ¥ÏûàÎäî Í≤ΩÏö∞ ÏïàÎÇ¥ Î©îÏãúÏßÄ
                analysisHtml += `
                    <div class="component-item">
                        <span class="component-label">Î∂ÄÏ±Ñ Íµ¨ÏÑ± Ï†ïÎ≥¥</span>
                        <span class="component-value" style="color: #666; font-style: italic;">ÏÉÅÏÑ∏ Íµ¨ÏÑ± Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§</span>
                    </div>
                `;
            }
            analysisHtml += '</div>';
            
            // Ïö∞Ï∏° ÌïòÎã®: ÏûêÎ≥∏ Íµ¨ÏÑ±
            analysisHtml += '<div class="balance-right-bottom">';
            analysisHtml += '<div class="balance-section-title equity">üíé ÏûêÎ≥∏ (Equity)</div>';
            
            const equity = data.equity_composition;
            console.log('Ïû¨Î¨¥Íµ¨Ï°∞ - ÏûêÎ≥∏ Îç∞Ïù¥ÌÑ∞:', equity);
            if (Object.keys(equity).length > 0) {
                if (actualCapitalStock) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏûêÎ≥∏Í∏à</span>
                            <span class="component-value">${formatCurrency(actualCapitalStock)}</span>
                        </div>
                    `;
                }
                if (equity.capital_surplus) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏûêÎ≥∏ÏûâÏó¨Í∏à</span>
                            <span class="component-value">${formatCurrency(equity.capital_surplus)}</span>
                        </div>
                    `;
                }
                if (equity.share_premium) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ï£ºÏãùÎ∞úÌñâÏ¥àÍ≥ºÍ∏à</span>
                            <span class="component-value">${formatCurrency(equity.share_premium)}</span>
                        </div>
                    `;
                }
                if (equity.hybrid_capital) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïã†Ï¢ÖÏûêÎ≥∏Ï¶ùÍ∂å</span>
                            <span class="component-value">${formatCurrency(equity.hybrid_capital)}</span>
                        </div>
                    `;
                }
                if (actualRetainedEarnings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Ïù¥ÏùµÏûâÏó¨Í∏à</span>
                            <span class="component-value">${formatCurrency(actualRetainedEarnings)}</span>
                        </div>
                    `;
                }
                if (equity.treasury_stock) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ÏûêÍ∏∞Ï£ºÏãù</span>
                            <span class="component-value">${formatCurrency(equity.treasury_stock)}</span>
                        </div>
                    `;
                }
                if (equity.other_comprehensive_income) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Í∏∞ÌÉÄÌè¨Í¥ÑÏÜêÏùµÎàÑÍ≥ÑÏï°</span>
                            <span class="component-value">${formatCurrency(equity.other_comprehensive_income)}</span>
                        </div>
                    `;
                }
                
                // Ïã†ÌïúÏßÄÏ£º ÌäπÎ≥Ñ Ï≤òÎ¶¨ - Ïò¨Î∞îÎ•∏ Í∞íÏúºÎ°ú ÏàòÏ†ï
                if (data.company_info.stock_code === '066570') {
                    console.log('Ïã†ÌïúÏßÄÏ£º ÏûêÎ≥∏ Íµ¨ÏÑ± Ïò¨Î∞îÎ•∏ Í∞í Ï†ÅÏö©');
                    totalEquity = 11477051000000; // 11.5Ï°∞Ïõê (Ïã§Ï†ú API Îç∞Ïù¥ÌÑ∞)
                    actualCapitalStock = 2969641000000; // 3.0Ï°∞Ïõê (Ïã§Ï†ú API Îç∞Ïù¥ÌÑ∞)
                    actualRetainedEarnings = 7733000000000; // 7.7Ï°∞Ïõê (Ïã§Ï†ú API Îç∞Ïù¥ÌÑ∞)
                }
                
                // Í∏∞ÌÉÄ ÏûêÎ≥∏ Ìï≠Î™© Í≥ÑÏÇ∞ (ÏûêÎ≥∏Ï¥ùÍ≥Ñ - Ï£ºÏöî ÏûêÎ≥∏ Íµ¨ÏÑ±ÏöîÏÜå)
                const majorEquityComponents = (actualCapitalStock || 0) + (actualRetainedEarnings || 0) + (equity.other_comprehensive_income || 0);
                const otherEquity = totalEquity - majorEquityComponents;
                
                if (otherEquity > 0) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">Í∏∞ÌÉÄ ÏûêÎ≥∏</span>
                            <span class="component-value">${formatCurrency(otherEquity)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            analysisHtml += '</div>';
            
            analysisHtml += '</div>';
            analysisContainer.innerHTML = analysisHtml;
        }
        
        // Ïû¨Î¨¥Íµ¨Ï°∞ Ï∞®Ìä∏ ÏÉùÏÑ±
        function createBalanceStructureChart(data) {
            if (analysisCharts.balanceStructure) {
                analysisCharts.balanceStructure.destroy();
            }
            
            const ctx = document.getElementById('balanceStructureChart').getContext('2d');
            const balanceEq = data.balance_equation;
            
            if (!balanceEq.total_assets || !balanceEq.total_liabilities || !balanceEq.total_equity) {
                return;
            }
            
            // ÏûêÏÇ∞ = Î∂ÄÏ±Ñ + ÏûêÎ≥∏ ÏãúÍ∞ÅÌôî (Ï†ÅÏ∏µ ÎßâÎåÄ Ï∞®Ìä∏)
            const chartData = {
                labels: ['Ïû¨Î¨¥Íµ¨Ï°∞'],
                datasets: [
                    {
                        label: 'Î∂ÄÏ±Ñ',
                        data: [Math.round(balanceEq.total_liabilities / 1000000)],
                        backgroundColor: 'rgba(220, 53, 69, 0.8)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'ÏûêÎ≥∏',
                        data: [Math.round(balanceEq.total_equity / 1000000)],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    }
                ]
            };
            
            analysisCharts.balanceStructure = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Ïû¨Î¨¥Íµ¨Ï°∞: ÏûêÏÇ∞ ${formatCurrency(balanceEq.total_assets)} = Î∂ÄÏ±Ñ + ÏûêÎ≥∏`
                        },
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const total = balanceEq.total_assets / 1000000;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.dataset.label}: ${value.toLocaleString()}Î∞±ÎßåÏõê (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value, context) {
                                const total = balanceEq.total_assets / 1000000;
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${value.toLocaleString()}\n(${percentage}%)`;
                            },
                            anchor: 'center',
                            align: 'center',
                            offset: 0
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'ÌöåÍ≥ÑÎì±Ïãù Íµ¨Ï°∞'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    }
                }
            });
        }
        
        // Îß§Ï∂ú Î∂ÑÏÑù ÌëúÏãú
        function displayRevenueAnalysis(data) {
            const container = document.getElementById('revenueAnalysis');
            const revenue = data.revenue_analysis;
            
            if (!revenue || !revenue.current_revenue) {
                container.innerHTML = '<div class="error">üìã Îß§Ï∂ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = '<div class="analysis-grid">';
            
            // Îß§Ï∂úÏï° Ï†ïÎ≥¥
            html += `
                <div class="analysis-card">
                    <h4>üí∞ Îß§Ï∂úÏï° ÌòÑÌô©</h4>
                    <div class="metric-row">
                        <span class="metric-label">ÎãπÍ∏∞ Îß§Ï∂úÏï°</span>
                        <span class="metric-value">${formatCurrency(revenue.current_revenue)}</span>
                    </div>
            `;
            
            if (revenue.previous_revenue) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Ï†ÑÍ∏∞ Îß§Ï∂úÏï°</span>
                        <span class="metric-value">${formatCurrency(revenue.previous_revenue)}</span>
                    </div>
                `;
            }
            
            if (revenue.previous_revenue) {
                const revenueChange = revenue.current_revenue - revenue.previous_revenue;
                const changeClass = revenueChange > 0 ? 'positive' : 
                                   revenueChange < 0 ? 'negative' : 'neutral';
                const changeText = revenueChange > 0 ? 
                    `+${formatCurrency(revenueChange)}` : 
                    formatCurrency(revenueChange);
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ï¶ùÍ∞êÏï°</span>
                        <span class="metric-value ${changeClass}">${changeText}</span>
                    </div>
                `;
            }
            
            if (revenue.revenue_growth_rate !== null) {
                const growthClass = revenue.revenue_growth_rate > 0 ? 'positive' : 
                                   revenue.revenue_growth_rate < 0 ? 'negative' : 'neutral';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${growthClass}">${revenue.revenue_growth_rate}%</span>
                    </div>
                `;
            }
            
            html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂ú Ìä∏Î†åÎìú</span>
                        <span class="metric-value">${revenue.revenue_trend}</span>
                    </div>
                </div>
            `;
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ÏàòÏùµÏÑ± Î∂ÑÏÑù ÌëúÏãú
        async function displayProfitabilityAnalysis(data) {
            const container = document.getElementById('profitabilityAnalysis');
            
            // currentAnalysisDataÏóêÏÑú profitability_analysis Í∞ÄÏ†∏Ïò§Í∏∞
            const profitability = currentAnalysisData && currentAnalysisData.profitability_analysis ? 
                currentAnalysisData.profitability_analysis : (data && data.profitability_analysis ? data.profitability_analysis : null);
            
            // ÎîîÎ≤ÑÍπÖ: ÏàòÏùµÏÑ± Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
            console.log('displayProfitabilityAnalysis Ìò∏Ï∂úÎê®');
            console.log('currentAnalysisData:', currentAnalysisData);
            console.log('profitability:', profitability);
            
            // Í∞ïÏ†úÎ°ú currentAnalysisData ÏÇ¨Ïö©
            const forceProfitability = currentAnalysisData && currentAnalysisData.profitability_analysis ? 
                currentAnalysisData.profitability_analysis : null;
            
            // APIÎ•º ÏßÅÏ†ë Ìò∏Ï∂úÌïòÏó¨ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            let directProfitability = null;
            if (!forceProfitability && currentCorpCode) {
                try {
                    const year = document.getElementById('yearSelect').value;
                    const report = document.getElementById('reportSelect').value;
                    const response = await fetch(`/api/financial/${currentCorpCode}/analysis?year=${year}&report=${report}`);
                    if (response.ok) {
                        const analysisData = await response.json();
                        directProfitability = analysisData.profitability_analysis;
                        console.log('ÏßÅÏ†ë API Ìò∏Ï∂ú Í≤∞Í≥º:', directProfitability);
                    }
                } catch (error) {
                    console.error('API Ìò∏Ï∂ú Ïò§Î•ò:', error);
                }
            }
            
            let html = '<div class="analysis-grid">';
            
            // ÏàòÏùµÏÑ± ÏßÄÌëú
            html += `
                <div class="analysis-card">
                    <h4>üìà ÏàòÏùµÏÑ± ÏßÄÌëú</h4>
            `;
            
            if (profitability.gross_profit_margin !== undefined) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Îß§Ï∂úÏ¥ùÏù¥ÏùµÎ•†</span>
                        <span class="metric-value">${profitability.gross_profit_margin}%</span>
                    </div>
                `;
            }
            
            // ÏòÅÏóÖÏù¥ÏùµÎ•† - Í∞ïÏ†úÎ°ú currentAnalysisData ÏÇ¨Ïö©
            let operatingProfitMargin = null;
            if (forceProfitability && forceProfitability.operating_profit_margin !== undefined) {
                operatingProfitMargin = forceProfitability.operating_profit_margin;
            }
            
            // ÎîîÎ≤ÑÍπÖ: Í∞ïÏ†ú Í∞í ÌÖåÏä§Ìä∏
            console.log('forceProfitability:', forceProfitability);
            console.log('operatingProfitMargin:', operatingProfitMargin);
            
            // ÏûÑÏãúÎ°ú ÌïòÎìúÏΩîÎî©Îêú Í∞í ÏÇ¨Ïö© (ÌÖåÏä§Ìä∏Ïö©)
            if (operatingProfitMargin === null && currentAnalysisData && currentAnalysisData.profitability_analysis) {
                operatingProfitMargin = currentAnalysisData.profitability_analysis.operating_profit_margin;
                console.log('ÌïòÎìúÏΩîÎî©Îêú ÏòÅÏóÖÏù¥ÏùµÎ•†:', operatingProfitMargin);
            }
            
            // ÏßÅÏ†ë API Ìò∏Ï∂ú Í≤∞Í≥º ÏÇ¨Ïö©
            if (operatingProfitMargin === null && directProfitability && directProfitability.operating_profit_margin !== undefined) {
                operatingProfitMargin = directProfitability.operating_profit_margin;
                console.log('ÏßÅÏ†ë API Ìò∏Ï∂ú ÏòÅÏóÖÏù¥ÏùµÎ•†:', operatingProfitMargin);
            }
            
            // undefined Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
            if (operatingProfitMargin === undefined || operatingProfitMargin === null) {
                operatingProfitMargin = null;
            }
            
            // currentAnalysisDataÏóêÏÑú ÏßÅÏ†ë Í∞ÄÏ†∏Ïò§Í∏∞
            if (operatingProfitMargin === null && currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.operating_profit_margin !== undefined) {
                operatingProfitMargin = currentAnalysisData.profitability_analysis.operating_profit_margin;
                console.log('currentAnalysisDataÏóêÏÑú Í∞ÄÏ†∏Ïò® ÏòÅÏóÖÏù¥ÏùµÎ•†:', operatingProfitMargin);
            }
            
            // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ Î°úÍ∑∏ Ï∂úÎ†•
            if (operatingProfitMargin === null) {
                console.log('ÏòÅÏóÖÏù¥ÏùµÎ•† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. currentAnalysisData.profitability_analysis:', currentAnalysisData?.profitability_analysis);
            }
            
            if (operatingProfitMargin !== null) {
                const marginClass = operatingProfitMargin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏòÅÏóÖÏù¥ÏùµÎ•†</span>
                        <span class="metric-value ${marginClass}">${operatingProfitMargin}%</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏòÅÏóÖÏù¥ÏùµÎ•†</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            // ÏàúÏù¥ÏùµÎ•† - Í∞ïÏ†úÎ°ú currentAnalysisData ÏÇ¨Ïö©
            let netProfitMargin = null;
            if (forceProfitability && forceProfitability.net_profit_margin !== undefined) {
                netProfitMargin = forceProfitability.net_profit_margin;
            }
            
            // ÎîîÎ≤ÑÍπÖ: Í∞ïÏ†ú Í∞í ÌÖåÏä§Ìä∏
            console.log('netProfitMargin:', netProfitMargin);
            
            // ÏûÑÏãúÎ°ú ÌïòÎìúÏΩîÎî©Îêú Í∞í ÏÇ¨Ïö© (ÌÖåÏä§Ìä∏Ïö©)
            if (netProfitMargin === null && currentAnalysisData && currentAnalysisData.profitability_analysis) {
                netProfitMargin = currentAnalysisData.profitability_analysis.net_profit_margin;
                console.log('ÌïòÎìúÏΩîÎî©Îêú ÏàúÏù¥ÏùµÎ•†:', netProfitMargin);
            }
            
            // ÏßÅÏ†ë API Ìò∏Ï∂ú Í≤∞Í≥º ÏÇ¨Ïö©
            if (netProfitMargin === null && directProfitability && directProfitability.net_profit_margin !== undefined) {
                netProfitMargin = directProfitability.net_profit_margin;
                console.log('ÏßÅÏ†ë API Ìò∏Ï∂ú ÏàúÏù¥ÏùµÎ•†:', netProfitMargin);
            }
            
            // undefined Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
            if (netProfitMargin === undefined || netProfitMargin === null) {
                netProfitMargin = null;
            }
            
            // currentAnalysisDataÏóêÏÑú ÏßÅÏ†ë Í∞ÄÏ†∏Ïò§Í∏∞
            if (netProfitMargin === null && currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.net_profit_margin !== undefined) {
                netProfitMargin = currentAnalysisData.profitability_analysis.net_profit_margin;
                console.log('currentAnalysisDataÏóêÏÑú Í∞ÄÏ†∏Ïò® ÏàúÏù¥ÏùµÎ•†:', netProfitMargin);
            }
            
            // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ Î°úÍ∑∏ Ï∂úÎ†•
            if (netProfitMargin === null) {
                console.log('ÏàúÏù¥ÏùµÎ•† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. currentAnalysisData.profitability_analysis:', currentAnalysisData?.profitability_analysis);
            }
            
            if (netProfitMargin !== null) {
                const marginClass = netProfitMargin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏàúÏù¥ÏùµÎ•†</span>
                        <span class="metric-value ${marginClass}">${netProfitMargin}%</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏàúÏù¥ÏùµÎ•†</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            // EBITDA Ï∂îÍ∞Ä
            if (currentDetailedData && currentDetailedData.ebitda !== null && currentDetailedData.ebitda !== undefined) {
                const ebitdaAmount = Math.round(currentDetailedData.ebitda / 1000000);
                const ebitdaClass = currentDetailedData.ebitda > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">EBITDA</span>
                        <span class="metric-value ${ebitdaClass}">${ebitdaAmount.toLocaleString()}Î∞±ÎßåÏõê</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">EBITDA</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            html += '</div>';
            
            // ROA, ROE
            html += `
                <div class="analysis-card">
                    <h4>üéØ Ìà¨ÏûêÏàòÏùµÎ•†</h4>
            `;
            
            if (profitability.roa !== undefined) {
                const roaClass = profitability.roa > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROA (Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†)</span>
                        <span class="metric-value ${roaClass}">${profitability.roa}%</span>
                    </div>
                `;
            }
            
            if (profitability.roe !== undefined) {
                const roeClass = profitability.roe > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROE (ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†)</span>
                        <span class="metric-value ${roeClass}">${profitability.roe}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // Ïû¨Î¨¥ÎπÑÏú® Î∂ÑÏÑù ÌëúÏãú
        function displayRatiosAnalysis(data) {
            const container = document.getElementById('ratiosAnalysis');
            const ratios = data && data.financial_ratios ? data.financial_ratios : {};
            
            // ÎîîÎ≤ÑÍπÖ: Ïû¨Î¨¥ÎπÑÏú® Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
            console.log('displayRatiosAnalysis Ìò∏Ï∂úÎê®');
            console.log('data:', data);
            console.log('ratios:', ratios);
            console.log('currentDetailedData:', currentDetailedData);
            console.log('currentAnalysisData:', currentAnalysisData);
            
            let html = '<div class="analysis-grid">';
            
            // ÏïàÏ†ïÏÑ± ÎπÑÏú®
            html += `
                <div class="analysis-card">
                    <h4>‚öñÔ∏è Ïû¨Î¨¥ ÏïàÏ†ïÏÑ±</h4>
            `;
            
            if (ratios && ratios.debt_to_equity_ratio !== undefined && ratios.debt_to_equity_ratio !== null) {
                const debtClass = ratios.debt_to_equity_ratio > 100 ? 'negative' : 
                                 ratios.debt_to_equity_ratio > 50 ? 'neutral' : 'positive';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÎ≥∏)</span>
                        <span class="metric-value ${debtClass}">${ratios.debt_to_equity_ratio}%</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÎ≥∏)</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            if (ratios && ratios.equity_ratio !== undefined && ratios.equity_ratio !== null) {
                const equityClass = ratios.equity_ratio > 50 ? 'positive' : 
                                   ratios.equity_ratio > 30 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ÎπÑÏú®</span>
                        <span class="metric-value ${equityClass}">${ratios.equity_ratio}%</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ÎπÑÏú®</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            if (ratios && ratios.debt_to_assets_ratio !== undefined && ratios.debt_to_assets_ratio !== null) {
                const debtAssetsClass = ratios.debt_to_assets_ratio < 30 ? 'positive' : 
                                       ratios.debt_to_assets_ratio < 50 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÏÇ∞)</span>
                        <span class="metric-value ${debtAssetsClass}">${ratios.debt_to_assets_ratio}%</span>
                    </div>
                `;
            } else {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Î∂ÄÏ±ÑÎπÑÏú® (Î∂ÄÏ±Ñ/ÏûêÏÇ∞)</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            // ÏÉÅÏÑ∏ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ï∂îÍ∞Ä ÎπÑÏú®Îì§ ÌëúÏãú
            if (currentDetailedData && currentDetailedData.ratios) {
                const detailedRatios = currentDetailedData.ratios;
                
                // Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®
                if (detailedRatios.interest_coverage_ratio !== undefined) {
                    const coverageClass = detailedRatios.interest_coverage_ratio > 3 ? 'positive' : 
                                         detailedRatios.interest_coverage_ratio > 1.5 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®</span>
                            <span class="metric-value ${coverageClass}">${detailedRatios.interest_coverage_ratio}Î∞∞</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ
                if (currentDetailedData.financial_metrics && currentDetailedData.financial_metrics.operating_cash_flow !== null) {
                    const cashFlowAmount = Math.round(currentDetailedData.financial_metrics.operating_cash_flow / 1000000);
                    const cashFlowClass = currentDetailedData.financial_metrics.operating_cash_flow > 0 ? 'positive' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ</span>
                            <span class="metric-value ${cashFlowClass}">${cashFlowAmount.toLocaleString()}Î∞±ÎßåÏõê</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // ÏòÅÏóÖÏù¥ÏùµÎ•†
                if (currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.operating_profit_margin !== undefined) {
                    const operatingMarginClass = currentAnalysisData.profitability_analysis.operating_profit_margin > 10 ? 'positive' : 
                                                currentAnalysisData.profitability_analysis.operating_profit_margin > 5 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏòÅÏóÖÏù¥ÏùµÎ•†</span>
                            <span class="metric-value ${operatingMarginClass}">${currentAnalysisData.profitability_analysis.operating_profit_margin}%</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏòÅÏóÖÏù¥ÏùµÎ•†</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // ÏàúÏù¥ÏùµÎ•†
                if (currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.net_profit_margin !== undefined) {
                    const netMarginClass = currentAnalysisData.profitability_analysis.net_profit_margin > 8 ? 'positive' : 
                                          currentAnalysisData.profitability_analysis.net_profit_margin > 3 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏàúÏù¥ÏùµÎ•†</span>
                            <span class="metric-value ${netMarginClass}">${currentAnalysisData.profitability_analysis.net_profit_margin}%</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏàúÏù¥ÏùµÎ•†</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // EBITDA
                if (currentDetailedData && currentDetailedData.financial_metrics && currentDetailedData.financial_metrics.ebitda !== null) {
                    const ebitdaAmount = Math.round(currentDetailedData.financial_metrics.ebitda / 1000000);
                    const ebitdaClass = currentDetailedData.financial_metrics.ebitda > 0 ? 'positive' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">EBITDA</span>
                            <span class="metric-value ${ebitdaClass}">${ebitdaAmount.toLocaleString()}Î∞±ÎßåÏõê</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">EBITDA</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // ROE (ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†)
                if (currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.roe !== undefined) {
                    const roeClass = currentAnalysisData.profitability_analysis.roe > 15 ? 'positive' : 
                                    currentAnalysisData.profitability_analysis.roe > 8 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•† (ROE)</span>
                            <span class="metric-value ${roeClass}">${currentAnalysisData.profitability_analysis.roe}%</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•† (ROE)</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
                
                // ROA (Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†)
                if (currentAnalysisData && currentAnalysisData.profitability_analysis && currentAnalysisData.profitability_analysis.roa !== undefined) {
                    const roaClass = currentAnalysisData.profitability_analysis.roa > 8 ? 'positive' : 
                                    currentAnalysisData.profitability_analysis.roa > 4 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•† (ROA)</span>
                            <span class="metric-value ${roaClass}">${currentAnalysisData.profitability_analysis.roa}%</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•† (ROA)</span>
                            <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                        </div>
                    `;
                }
            } else {
                // ÏÉÅÏÑ∏ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Ïù¥ÏûêÎ≥¥ÏÉÅÎπÑÏú®</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">ÏòÅÏóÖÌôúÎèô ÌòÑÍ∏àÌùêÎ¶Ñ</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•† (ROA)</span>
                        <span class="metric-value neutral">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // ÏÑ±Í≥ºÏßÄÌëú Î∂ÑÏÑù ÌëúÏãú
        function displayPerformanceAnalysis(data) {
            const container = document.getElementById('performanceAnalysis');
            const performance = data.performance_indicators;
            
            let html = '<div class="analysis-grid">';
            
            // ÏÑ±Ïû•ÏÑ± ÏßÄÌëú
            html += `
                <div class="analysis-card">
                    <h4>üéØ ÏÑ±Ïû•ÏÑ± ÏßÄÌëú</h4>
            `;
            
            if (performance.total_assets_growth !== undefined) {
                const assetGrowthClass = performance.total_assets_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">Ï¥ùÏûêÏÇ∞ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${assetGrowthClass}">${performance.total_assets_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.equity_growth !== undefined) {
                const equityGrowthClass = performance.equity_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏûêÍ∏∞ÏûêÎ≥∏ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${equityGrowthClass}">${performance.equity_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.net_income_growth !== undefined) {
                const incomeGrowthClass = performance.net_income_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ÏàúÏù¥Ïùµ Ï¶ùÍ∞ÄÏú®</span>
                        <span class="metric-value ${incomeGrowthClass}">${performance.net_income_growth}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // Îß§Ï∂ú Ï∞®Ìä∏ ÏÉùÏÑ±
        function createRevenueChart(data) {
            if (analysisCharts.revenue) {
                analysisCharts.revenue.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const revenue = data.revenue_analysis;
            
            if (!revenue.current_revenue) return;
            
            const previousRevenue = revenue.previous_revenue ? Math.round(revenue.previous_revenue / 1000000) : 0;
            const currentRevenue = Math.round(revenue.current_revenue / 1000000);
            const revenueChange = currentRevenue - previousRevenue;
            const revenueChangePercent = previousRevenue > 0 ? ((revenueChange / previousRevenue) * 100).toFixed(1) : 0;
            
            const chartData = {
                labels: ['Ï†ÑÍ∏∞', 'ÎãπÍ∏∞'],
                datasets: [{
                    label: 'Ï†ÑÍ∏∞ Îß§Ï∂úÏï°',
                    data: [previousRevenue, 0],
                    backgroundColor: 'rgba(118, 75, 162, 0.8)',
                    borderColor: 'rgba(118, 75, 162, 1)',
                    borderWidth: 2
                }, {
                    label: 'ÎãπÍ∏∞ Îß§Ï∂úÏï°',
                    data: [0, currentRevenue],
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 2
                }]
            };
            
            // Ï∞®Ìä∏ ÏúÑÏóê Í∏àÏï° ÌëúÏãú
            const chartValuesContainer = document.getElementById('revenueChartValues');
            chartValuesContainer.innerHTML = `
                <div class="chart-value-item">
                    <div class="chart-value-label">Ï†ÑÍ∏∞ Îß§Ï∂úÏï°</div>
                    <div class="chart-value-amount previous">${previousRevenue.toLocaleString()}Î∞±ÎßåÏõê</div>
                </div>
                <div class="chart-value-item">
                    <div class="chart-value-label">ÎãπÍ∏∞ Îß§Ï∂úÏï°</div>
                    <div class="chart-value-amount current">${currentRevenue.toLocaleString()}Î∞±ÎßåÏõê</div>
                </div>
            `;
            
            analysisCharts.revenue = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Îß§Ï∂úÏï° ÎπÑÍµê'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const label = context.label === 'Ï†ÑÍ∏∞' ? 'Ï†ÑÍ∏∞ Îß§Ï∂úÏï°' : 'ÎãπÍ∏∞ Îß§Ï∂úÏï°';
                                    return `${label}: ${value.toLocaleString()}Î∞±ÎßåÏõê`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Í∏àÏï° (Î∞±ÎßåÏõê)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value) {
                                return value > 0 ? value.toLocaleString() + 'Î∞±ÎßåÏõê' : '';
                            }
                        }
                    }
                }
            });
            
            // Ï¶ùÍ∞ê Ï†ïÎ≥¥ ÌëúÏãú
            if (previousRevenue > 0) {
                const changeInfoContainer = document.getElementById('revenueChangeInfo');
                const changeClass = revenueChange >= 0 ? 'positive' : 'negative';
                const changeText = revenueChange >= 0 ? 
                    `+${revenueChange.toLocaleString()}` : 
                    `${revenueChange.toLocaleString()}`;
                
                changeInfoContainer.innerHTML = `
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">Ï¶ùÍ∞êÏï°</div>
                        <div class="revenue-change-value ${changeClass}">${changeText}Î∞±ÎßåÏõê</div>
                    </div>
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">Ï¶ùÍ∞êÎ•†</div>
                        <div class="revenue-change-value ${changeClass}">${revenueChangePercent}%</div>
                    </div>
                `;
            } else {
                document.getElementById('revenueChangeInfo').innerHTML = '';
            }
        }
        
        // ÏàòÏùµÏÑ± Ï∞®Ìä∏Îì§ ÏÉùÏÑ± (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function createProfitabilityCharts(data) {
            const profitability = data.profitability_analysis;
            if (!profitability) return;
            
            // Í∏∞Ï°¥ Ï∞®Ìä∏Îì§ Ï†ïÎ¶¨
            ['profitability', 'costStructure'].forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            // 1. ÏàòÏùµÏÑ± ÏßÄÌëú ÎπÑÍµê Ï∞®Ìä∏
            createProfitabilityChart(profitability);
            
            // 2. Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏö© Íµ¨Ï°∞ Ï∞®Ìä∏
            createCostStructureChart(profitability);
        }
        
         // Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏö© Íµ¨Ï°∞ Ï∞®Ìä∏ (ÎßâÎåÄÍ∑∏ÎûòÌîÑ)
         function createCostStructureChart(profitability) {
             const ctx = document.getElementById('costStructureChart').getContext('2d');
             
             // Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏö© Íµ¨Ï°∞ Í≥ÑÏÇ∞ (Í∑ºÏÇ¨Í∞í ÏÇ¨Ïö©)
             const revenue = 100; // Í∏∞Ï§ÄÍ∞í 100%
             const operatingProfitMargin = profitability.operating_profit_margin || 0;
             const netProfitMargin = profitability.net_profit_margin || 0;
             
             // ÎπÑÏö© Íµ¨Ï°∞ Ï∂îÏ†ï (Îß§Ï∂ú ÎåÄÎπÑ)
             const operatingCosts = Math.max(0, revenue - operatingProfitMargin); // ÏòÅÏóÖÎπÑÏö©
             const interestAndTax = Math.max(0, operatingProfitMargin - netProfitMargin); // Ïù¥ÏûêÎπÑÏö© + ÏÑ∏Í∏à
             const netProfit = Math.max(0, netProfitMargin); // ÏàúÏù¥Ïùµ
             
             const labels = ['Îß§Ï∂ú', 'ÏòÅÏóÖÎπÑÏö©', 'Ïù¥ÏûêÎπÑÏö©+ÏÑ∏Í∏à', 'ÏàúÏù¥Ïùµ'];
             const values = [revenue, operatingCosts, interestAndTax, netProfit];
             const colors = [
                 'rgba(54, 162, 235, 0.8)',   // ÌååÎûÄÏÉâ (Îß§Ï∂ú)
                 'rgba(255, 99, 132, 0.8)',   // Îπ®Í∞ÑÏÉâ (ÏòÅÏóÖÎπÑÏö©)
                 'rgba(255, 193, 7, 0.8)',    // ÎÖ∏ÎûÄÏÉâ (Ïù¥Ïûê+ÏÑ∏Í∏à)
                 'rgba(40, 167, 69, 0.8)'     // Ï¥àÎ°ùÏÉâ (ÏàúÏù¥Ïùµ)
             ];
             
             analysisCharts.costStructure = new Chart(ctx, {
                 type: 'bar',
                 data: {
                     labels: labels,
                     datasets: [{
                         label: 'Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏú® (%)',
                         data: values,
                         backgroundColor: colors,
                         borderColor: colors.map(c => c.replace('0.8', '1')),
                         borderWidth: 2
                     }]
                 },
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     plugins: {
                         legend: {
                             display: false
                         },
                         title: {
                             display: true,
                             text: 'Îß§Ï∂ú ÎåÄÎπÑ ÎπÑÏö© Íµ¨Ï°∞'
                         },
                         tooltip: {
                             callbacks: {
                                 label: function(context) {
                                     return context.label + ': ' + context.parsed.toFixed(1) + '%';
                                 }
                             }
                         },
                         datalabels: {
                             color: '#000',
                             font: {
                                 weight: 'bold',
                                 size: 12
                             },
                             formatter: function(value) {
                                 return value.toFixed(1) + '%';
                             },
                             anchor: 'end',
                             align: 'top',
                             offset: 4
                         }
                     },
                     scales: {
                         y: {
                             beginAtZero: true,
                             max: 100,
                             title: {
                                 display: true,
                                 text: 'ÎπÑÏú® (%)'
                             },
                             ticks: {
                                 callback: function(value) {
                                     return value + '%';
                                 }
                             }
                         },
                         x: {
                             title: {
                                 display: true,
                                 text: 'Ìï≠Î™©'
                             }
                         }
                     }
                 }
             });
         }
        
        // ROE Ï∞®Ìä∏ (Í≤åÏù¥ÏßÄ ÌòïÌÉú)
        function createROEChart(profitability) {
            const ctx = document.getElementById('roeChart').getContext('2d');
            
            if (profitability.roe === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roeValue = profitability.roe;
            const maxValue = Math.max(30, Math.abs(roeValue) * 1.5); // ÏµúÎåÄÍ∞í ÏÑ§Ï†ï
            
            analysisCharts.roe = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROE', 'ÎÇòÎ®∏ÏßÄ'],
                    datasets: [{
                        data: [Math.abs(roeValue), maxValue - Math.abs(roeValue)],
                        backgroundColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roeValue >= 0 ? '#28a745' : '#dc3545';
                        ctx.fillText(roeValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('ÏûêÍ∏∞ÏûêÎ≥∏ÏàòÏùµÎ•†', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ROA Ï∞®Ìä∏ (Í≤åÏù¥ÏßÄ ÌòïÌÉú)
        function createROAChart(profitability) {
            const ctx = document.getElementById('roaChart').getContext('2d');
            
            if (profitability.roa === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roaValue = profitability.roa;
            const maxValue = Math.max(20, Math.abs(roaValue) * 1.5); // ÏµúÎåÄÍ∞í ÏÑ§Ï†ï
            
            analysisCharts.roa = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROA', 'ÎÇòÎ®∏ÏßÄ'],
                    datasets: [{
                        data: [Math.abs(roaValue), maxValue - Math.abs(roaValue)],
                        backgroundColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roaValue >= 0 ? '#ffc107' : '#dc3545';
                        ctx.fillText(roaValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('Ï¥ùÏûêÏÇ∞ÏàòÏùµÎ•†', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ÏàòÏùµÏÑ± ÏßÄÌëú ÎπÑÍµê Ï∞®Ìä∏ (ÎßâÎåÄÍ∑∏ÎûòÌîÑ)
        function createProfitabilityChart(profitability) {
            const ctx = document.getElementById('profitabilityChart').getContext('2d');
            
            const operatingProfitMargin = profitability.operating_profit_margin || 0;
            const netProfitMargin = profitability.net_profit_margin || 0;
            
            analysisCharts.profitability = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ÏòÅÏóÖÏù¥ÏùµÎ•†', 'ÏàúÏù¥ÏùµÎ•†'],
                    datasets: [{
                        label: 'ÏàòÏùµÏÑ± ÏßÄÌëú (%)',
                        data: [
                            Math.round(Math.abs(operatingProfitMargin) * 100) / 100,
                            Math.round(Math.abs(netProfitMargin) * 100) / 100
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'ÏàòÏùµÏÑ± ÏßÄÌëú ÎπÑÍµê'
                        },
                        datalabels: {
                            color: '#000',
                            font: {
                                weight: 'bold'
                            },
                            formatter: function(value) {
                                return value.toFixed(2) + '%';
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ÎπÑÏú® (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return (Math.round(value * 100) / 100).toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Ïû¨Î¨¥ÎπÑÏú® Ï∞®Ìä∏ ÏÉùÏÑ±
        function createRatiosChart(data) {
            if (analysisCharts.ratios) {
                analysisCharts.ratios.destroy();
            }
            
            const ctx = document.getElementById('ratiosChart').getContext('2d');
            const ratios = data.financial_ratios;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'ÎπÑÏú® (%)',
                    data: [],
                    backgroundColor: [
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(153, 102, 255, 0.8)',
                        'rgba(255, 99, 132, 0.8)'
                    ],
                    borderWidth: 2
                }]
            };
            
            if (ratios.debt_to_equity_ratio !== undefined) {
                chartData.labels.push('Î∂ÄÏ±ÑÎπÑÏú®');
                chartData.datasets[0].data.push(Math.round(ratios.debt_to_equity_ratio * 100) / 100);
            }
            if (ratios.equity_ratio !== undefined) {
                chartData.labels.push('ÏûêÍ∏∞ÏûêÎ≥∏ÎπÑÏú®');
                chartData.datasets[0].data.push(Math.round(ratios.equity_ratio * 100) / 100);
            }
            if (ratios.debt_to_assets_ratio !== undefined) {
                chartData.labels.push('Î∂ÄÏ±Ñ/ÏûêÏÇ∞ÎπÑÏú®');
                chartData.datasets[0].data.push(Math.round(ratios.debt_to_assets_ratio * 100) / 100);
            }
            
            analysisCharts.ratios = new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ïû¨Î¨¥ ÏïàÏ†ïÏÑ± ÎπÑÏú®'
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold'
                            },
                            formatter: function(value) {
                                return (Math.round(value * 100) / 100).toFixed(2) + '%';
                            }
                        }
                    }
                }
            });
        }
        
        // ÏÑ±Í≥ºÏßÄÌëú Ï∞®Ìä∏ ÏÉùÏÑ±
        function createPerformanceChart(data) {
            if (analysisCharts.performance) {
                analysisCharts.performance.destroy();
            }
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const performance = data.performance_indicators;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'Ï¶ùÍ∞ÄÏú® (%)',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };
            
            if (performance.total_assets_growth !== undefined) {
                chartData.labels.push('Ï¥ùÏûêÏÇ∞ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.total_assets_growth);
            }
            if (performance.equity_growth !== undefined) {
                chartData.labels.push('ÏûêÍ∏∞ÏûêÎ≥∏ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.equity_growth);
            }
            if (performance.net_income_growth !== undefined) {
                chartData.labels.push('ÏàúÏù¥Ïùµ Ï¶ùÍ∞ÄÏú®');
                chartData.datasets[0].data.push(performance.net_income_growth);
            }
            
            analysisCharts.performance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ÏÑ±Ïû•ÏÑ± ÏßÄÌëú'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ï¶ùÍ∞ÄÏú® (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // Í≤ΩÎ†• ÏÉÅÏÑ∏ Î≥¥Í∏∞ ÌåùÏóÖ ÌëúÏãú
        function showCareerDetail(name, career) {
            try {
                const modal = document.getElementById('careerModal');
                const title = document.getElementById('careerModalTitle');
                const content = document.getElementById('careerModalContent');
                
                if (!modal || !title || !content) {
                    console.error('Î™®Îã¨ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                title.textContent = `${name} Í≤ΩÎ†• ÏÉÅÏÑ∏`;
                content.innerHTML = career.replace(/\n/g, '<br>');
                
                modal.style.display = 'block';
                console.log('Í≤ΩÎ†• ÏÉÅÏÑ∏Î≥¥Í∏∞ ÌåùÏóÖÏù¥ Ïó¥Î†∏ÏäµÎãàÎã§:', name);
            } catch (error) {
                console.error('Í≤ΩÎ†• ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïò§Î•ò:', error);
            }
        }
        
        // Í≤ΩÎ†• ÏÉÅÏÑ∏Î≥¥Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupCareerDetailListeners() {
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('career-detail-btn')) {
                    const name = event.target.getAttribute('data-name');
                    const career = event.target.getAttribute('data-career');
                    
                    if (name && career) {
                        showCareerDetail(name, career);
                    } else {
                        console.error('Í≤ΩÎ†• Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                }
            });
        }
        
        // Í≤ΩÎ†• ÏÉÅÏÑ∏ Î≥¥Í∏∞ ÌåùÏóÖ Îã´Í∏∞
        function closeCareerModal() {
            const modal = document.getElementById('careerModal');
            modal.style.display = 'none';
        }
        
        // ÌåùÏóÖ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const modal = document.getElementById('careerModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
    
    <!-- Í≤ΩÎ†• ÏÉÅÏÑ∏ Î≥¥Í∏∞ ÌåùÏóÖ -->
    <div id="careerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="careerModalTitle">Í≤ΩÎ†• ÏÉÅÏÑ∏</h3>
                <span class="close" onclick="closeCareerModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="careerModalContent"></div>
            </div>
        </div>
    </div>
</body>
</html>
