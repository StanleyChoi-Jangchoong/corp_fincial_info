<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤í”ˆë‹¤íŠ¸ ì¬ë¬´ ë°ì´í„° ë¶„ì„ ì„œë¹„ìŠ¤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .search-input-container {
            position: relative;
            flex: 1;
        }
        
        .search-input-container::after {
            content: 'ğŸ”';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }
        
        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        

        
        .stats {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
        }
        
        .results-container {
            margin-top: 20px;
        }
        
        .result-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .result-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .corp-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .corp-name:hover {
            color: #667eea;
        }
        
        .corp-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .corp-code {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .stock-code {
            background: #f3e5f5;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 500;
        }
        
        .loading::before {
            content: 'â³';
            margin-right: 8px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .more-results {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* ì—ëŸ¬ íŒì—… ìŠ¤íƒ€ì¼ */
        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 400px;
            text-align: center;
            animation: popupFadeIn 0.3s ease-out;
        }
        
        .error-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            animation: overlayFadeIn 0.3s ease-out;
        }
        
        .error-popup-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .error-popup-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #c62828;
            margin-bottom: 15px;
        }
        
        .error-popup-message {
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .error-popup-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        
        .error-popup-button:hover {
            transform: translateY(-2px);
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @keyframes overlayFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .feature-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        /* ì¬ë¬´ ë°ì´í„° ìŠ¤íƒ€ì¼ */
        .financial-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            display: none;
        }
        
        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .financial-title {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }
        
        .financial-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .financial-controls select,
        .financial-controls button {
            padding: 8px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .financial-controls button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .financial-controls button:hover {
            transform: translateY(-1px);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%) !important;
            color: white !important;
            font-weight: 600;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #ff5722 0%, #e68900 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .reset-btn:active {
            transform: translateY(0px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }
        
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .summary-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: #ff5252;
        }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .analysis-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            gap: 5px;
        }
        
        .analysis-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .analysis-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .analysis-tab:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ë¶„ì„ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analysis-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .metric-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        
        .metric-value.positive {
            color: #28a745;
        }
        
        .metric-value.negative {
            color: #dc3545;
        }
        
        .metric-value.neutral {
            color: #6c757d;
        }
        
        /* ë¹„êµ ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .comparison-chart {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-chart h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart-small {
            height: 300px;
        }
        
        /* ì¬ë¬´êµ¬ì¡° ìŠ¤íƒ€ì¼ */
        .balance-equation-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .balance-equation {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .equation-values {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .equation-item {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }
        
        .equation-item h4 {
            font-size: 1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .equation-item .value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .equation-balance {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .equation-balance.balanced {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid rgba(40, 167, 69, 0.5);
        }
        
        .equation-balance.unbalanced {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
        }
        
        .balance-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* ì¬ë¬´êµ¬ì¡° ì¢Œìš° ë ˆì´ì•„ì›ƒ */
        .balance-structure-layout {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .balance-left {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #28a745;
        }
        
        .balance-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .balance-right-top {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #dc3545;
        }
        
        .balance-right-bottom {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #007bff;
        }
        
        .balance-section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            color: white;
        }
        
        .balance-section-title.assets {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .balance-section-title.liabilities {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .balance-section-title.equity {
            background: linear-gradient(135deg, #007bff, #6610f2);
        }
        
        /* ë§¤ì¶œ ì¦ê° ì •ë³´ ìŠ¤íƒ€ì¼ */
        .revenue-change-info {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .revenue-change-item {
            display: inline-block;
            margin: 0 20px;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .revenue-change-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .revenue-change-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .revenue-change-value.positive {
            color: #28a745;
        }
        
        .revenue-change-value.negative {
            color: #dc3545;
        }
        
        .revenue-change-value.neutral {
            color: #6c757d;
        }
        
        /* ì°¨íŠ¸ ê°’ í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .chart-values-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
        }
        
        .chart-value-item {
            text-align: center;
            padding: 8px 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 120px;
        }
        
        .chart-value-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .chart-value-amount {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .chart-value-amount.previous {
            color: #764ba2;
        }
        
        .chart-value-amount.current {
            color: #667eea;
        }
        
        .component-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .component-card.assets {
            border-left-color: #28a745;
        }
        
        .component-card.liabilities {
            border-left-color: #dc3545;
        }
        
        .component-card.equity {
            border-left-color: #007bff;
        }
        
        .component-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .component-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .component-item:last-child {
            border-bottom: none;
        }
        
        .component-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .component-value {
            font-weight: bold;
            color: #333;
        }
        
        /* AI ë¶„ì„ ìŠ¤íƒ€ì¼ */
        .ai-summary-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .ai-summary-container::before {
            content: "ğŸ¤–";
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            opacity: 0.7;
        }
        
        .ai-summary-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .ai-summary-text {
            font-size: 1em;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        .ai-analysis-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .ai-analysis-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.4em;
        }
        
        .ai-analysis-text {
            font-size: 1em;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
        }
        
        .ai-analysis-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .ai-loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .ai-loading .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
        }
        
        .ai-disclaimer {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }
        
        /* ìˆ˜ìµì„± ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .profitability-charts-container {
            margin-top: 20px;
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .chart-box h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
            text-align: center;
            font-weight: 600;
        }
        
        .chart-box .chart-wrapper {
            height: 250px;
        }
        
        @media (max-width: 1024px) {
            .chart-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* ë¦¬ì…‹ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .reset-message {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            margin: 20px 0;
            animation: fadeInScale 0.5s ease-out;
        }
        
        .reset-icon {
            font-size: 3em;
            margin-right: 20px;
            animation: rotate 2s linear infinite;
        }
        
        .reset-text h3 {
            margin: 0 0 10px 0;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .reset-text p {
            margin: 0;
            font-size: 1em;
            opacity: 0.9;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
            
            .corp-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ ì˜¤í”ˆë‹¤íŠ¸ ì¬ë¬´ ë°ì´í„° ë¶„ì„</h1>
            <p>ê¸°ì—… ì •ë³´ë¥¼ ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ê²€ìƒ‰í•˜ì„¸ìš”</p>
        </div>
        
        <div class="search-container">
            <div class="search-form">
                <div class="search-input-container">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="íšŒì‚¬ëª…, ì˜ë¬¸íšŒì‚¬ëª… ë˜ëŠ” ì£¼ì‹ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì‚¼ì„±ì „ì, Samsung, 005930)">
                </div>
                <button onclick="searchCorporations()" class="search-btn">ğŸ” ê²€ìƒ‰</button>
            </div>
            
            <div id="stats" class="stats"></div>
            <div id="results" class="results-container"></div>
        </div>
        
        <!-- ì¬ë¬´ ë°ì´í„° í‘œì‹œ ì˜ì—­ -->
        <div id="financialContainer" class="financial-container">
            <button class="close-btn" onclick="closeFinancialData()">Ã—</button>
            
            <div class="financial-header">
                <h2 id="financialTitle" class="financial-title">ì¬ë¬´ ë°ì´í„°</h2>
                <div class="financial-controls">
                    <select id="yearSelect">
                        <option value="2024">2024ë…„</option>
                        <option value="2023">2023ë…„</option>
                        <option value="2022">2022ë…„</option>
                        <option value="2021">2021ë…„</option>
                        <option value="2020">2020ë…„</option>
                        <option value="2019">2019ë…„</option>
                    </select>
                    <select id="reportSelect">
                        <option value="11011">ì‚¬ì—…ë³´ê³ ì„œ</option>
                        <option value="11012">ë°˜ê¸°ë³´ê³ ì„œ</option>
                        <option value="11013">1ë¶„ê¸°ë³´ê³ ì„œ</option>
                        <option value="11014">3ë¶„ê¸°ë³´ê³ ì„œ</option>
                    </select>
                    <button onclick="refreshFinancialData()">ğŸ“Š ì¬ë¬´ì¡°íšŒ</button>
                    <button class="reset-btn" onclick="completeReset()" title="ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
            </div>
            
            <!-- ë¶„ì„ íƒ­ -->
            <div class="analysis-tabs">
                <button class="analysis-tab active" onclick="switchTab('overview')">ğŸ“Š ê°œìš”</button>
                <button class="analysis-tab" onclick="switchTab('ai')">ğŸ¤– AIë¶„ì„</button>
                <button class="analysis-tab" onclick="switchTab('balance')">ğŸ—ï¸ ì¬ë¬´êµ¬ì¡°</button>
                <button class="analysis-tab" onclick="switchTab('revenue')">ğŸ’° ë§¤ì¶œë¶„ì„</button>
                <button class="analysis-tab" onclick="switchTab('profitability')">ğŸ“ˆ ìˆ˜ìµì„±</button>
                <button class="analysis-tab" onclick="switchTab('ratios')">âš–ï¸ ì¬ë¬´ë¹„ìœ¨</button>
                <button class="analysis-tab" onclick="switchTab('performance')">ğŸ¯ ì„±ê³¼ì§€í‘œ</button>
            </div>
            
            <!-- ê°œìš” íƒ­ -->
            <div id="overviewTab" class="tab-content active">
                <div id="financialSummary" class="financial-summary"></div>
                <div class="chart-container">
                    <div id="financialChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- AI ë¶„ì„ íƒ­ -->
            <div id="aiTab" class="tab-content">
                <div id="aiSummary" class="ai-summary-container"></div>
                <div id="aiAnalysis" class="ai-analysis-container"></div>
            </div>
            
            <!-- ì¬ë¬´êµ¬ì¡° íƒ­ -->
            <div id="balanceTab" class="tab-content">
                <div id="balanceEquation" class="balance-equation-container"></div>
                <div id="balanceStructureAnalysis" class="balance-structure-layout"></div>
                <div class="comparison-chart">
                    <h4>ğŸ—ï¸ ì¬ë¬´êµ¬ì¡° ì‹œê°í™”</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="balanceStructureChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ë§¤ì¶œ ë¶„ì„ íƒ­ -->
            <div id="revenueTab" class="tab-content">
                <div id="revenueAnalysis"></div>
                <div class="comparison-chart">
                    <h4>ğŸ“Š ë§¤ì¶œ ì¶”ì´ ë¶„ì„</h4>
                    <div id="revenueChartValues" class="chart-values-display"></div>
                    <div class="chart-wrapper chart-small">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div id="revenueChangeInfo" class="revenue-change-info"></div>
                </div>
            </div>
            
            <!-- ìˆ˜ìµì„± íƒ­ -->
            <div id="profitabilityTab" class="tab-content">
                <div id="profitabilityAnalysis"></div>
                <div class="profitability-charts-container">
                    <div class="chart-row">
                        <div class="chart-box">
                            <h4>ğŸ’° ì´ìµë¥  ì§€í‘œ</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="marginChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>â­ ROE (ìê¸°ìë³¸ìˆ˜ìµë¥ )</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="roeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="chart-box">
                            <h4>ğŸ¯ ROA (ì´ìì‚°ìˆ˜ìµë¥ )</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="roaChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>ğŸ“Š ROE vs ROA ë¹„êµ</h4>
                            <div class="chart-wrapper chart-small">
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì¬ë¬´ë¹„ìœ¨ íƒ­ -->
            <div id="ratiosTab" class="tab-content">
                <div id="ratiosAnalysis"></div>
                <div class="comparison-chart">
                    <h4>âš–ï¸ ì¬ë¬´ ì•ˆì •ì„±</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="ratiosChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- ì„±ê³¼ì§€í‘œ íƒ­ -->
            <div id="performanceTab" class="tab-content">
                <div id="performanceAnalysis"></div>
                <div class="comparison-chart">
                    <h4>ğŸ¯ ì„±ì¥ì„± ì§€í‘œ</h4>
                    <div class="chart-wrapper chart-small">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="feature-grid">
            <div class="feature-card">
                <h3>ğŸ“Š ì‹¤ì‹œê°„ ê²€ìƒ‰</h3>
                <p>ì˜¤í”ˆë‹¤íŠ¸ì— ë“±ë¡ëœ ëª¨ë“  ê¸°ì—…ì˜ ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="feature-card">
                <h3>ğŸ·ï¸ ë‹¤ì–‘í•œ ê²€ìƒ‰ ì˜µì…˜</h3>
                <p>íšŒì‚¬ëª…, ì˜ë¬¸íšŒì‚¬ëª…, ì£¼ì‹ì½”ë“œ ë“± ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="feature-card">
                <h3>ğŸ’¼ ì •í™•í•œ ê¸°ì—… ì •ë³´</h3>
                <p>ê¸°ì—…ì½”ë“œ, ì£¼ì‹ì½”ë“œ ë“± ì •í™•í•œ ê¸°ì—… ì‹ë³„ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
            </div>
            <div class="feature-card">
                <h3>ğŸ“ˆ ì¬ë¬´ ë°ì´í„° ì‹œê°í™”</h3>
                <p>ê¸°ì—…ëª…ì„ í´ë¦­í•˜ë©´ ì˜¤í”ˆë‹¤íŠ¸ APIë¥¼ í†µí•´ ì‹¤ì œ ì¬ë¬´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ì°¨íŠ¸ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        // Chart.js DataLabels í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
        Chart.register(ChartDataLabels);
        
        // ì „ì—­ ë³€ìˆ˜
        let currentChart = null;
        let currentCorpCode = null;
        let currentCompanyName = null;
        let analysisCharts = {
            revenue: null,
            profitability: null,
            margin: null,
            roe: null,
            roa: null,
            ratios: null,
            performance: null,
            balanceStructure: null
        };
        let currentAnalysisData = null;
        let currentBalanceData = null;
        let currentDetailedData = null;
        let currentAiData = null;
        
        // ë””ë°”ìš´ì‹±ì„ ìœ„í•œ íƒ€ì´ë¨¸ ë³€ìˆ˜
        let searchTimer = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì „ì²´ ê¸°ì—… ìˆ˜ ì¡°íšŒ
        window.onload = function() {
            loadTotalCount();
            
            // ì‹¤ì‹œê°„ ê²€ìƒ‰ ì´ë²¤íŠ¸ ì¶”ê°€
            const searchInput = document.getElementById('searchInput');
            
            // ì…ë ¥ ì´ë²¤íŠ¸ (ì‹¤ì‹œê°„ ê²€ìƒ‰)
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                // ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ
                if (searchTimer) {
                    clearTimeout(searchTimer);
                }
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ê²°ê³¼ ì´ˆê¸°í™”
                if (!query) {
                    document.getElementById('results').innerHTML = '<div class="no-results">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                    return;
                }
                
                // 300ms í›„ì— ê²€ìƒ‰ ì‹¤í–‰ (ë””ë°”ìš´ì‹±)
                searchTimer = setTimeout(() => {
                    searchCorporations();
                }, 300);
            });
            
            // Enter í‚¤ ì´ë²¤íŠ¸ (ì¦‰ì‹œ ê²€ìƒ‰)
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // íƒ€ì´ë¨¸ ì·¨ì†Œí•˜ê³  ì¦‰ì‹œ ê²€ìƒ‰
                    if (searchTimer) {
                        clearTimeout(searchTimer);
                    }
                    searchCorporations();
                }
            });
        };
        
        // ì „ì²´ ê¸°ì—… ìˆ˜ ì¡°íšŒ
        async function loadTotalCount() {
            try {
                const response = await fetch('/api/corporations/count');
                const count = await response.json();
                document.getElementById('stats').innerHTML = 
                    `ğŸ“ˆ í˜„ì¬ <strong>${count.toLocaleString()}</strong>ê°œ ê¸°ì—…ì´ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
            } catch (error) {
                console.error('Error loading total count:', error);
                document.getElementById('stats').innerHTML = 
                    'ğŸ“ˆ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²° ì¤‘ì…ë‹ˆë‹¤...';
            }
        }
        
        // ê¸°ì—… ê²€ìƒ‰
        async function searchCorporations() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            // ë¡œë”© í‘œì‹œ (ì‹¤ì‹œê°„ ê²€ìƒ‰ìš© ê°„ë‹¨í•œ ë¡œë”©)
            resultsDiv.innerHTML = '<div class="loading">ğŸ” ê²€ìƒ‰ ì¤‘...</div>';
            
            try {
                const response = await fetch(`/api/corporations/search?q=${encodeURIComponent(query)}`);
                const corporations = await response.json();
                
                if (corporations.length === 0) {
                    resultsDiv.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</div>';
                    return;
                }
                
                // ê²°ê³¼ í‘œì‹œ (ìµœëŒ€ 20ê°œë¡œ ì œí•œ)
                const maxResults = 20;
                const displayCorporations = corporations.slice(0, maxResults);
                const totalCount = corporations.length;
                
                let html = `<h3>ê²€ìƒ‰ ê²°ê³¼ (${totalCount}ê°œ${totalCount > maxResults ? `, ìƒìœ„ ${maxResults}ê°œ í‘œì‹œ` : ''})</h3>`;
                displayCorporations.forEach(corp => {
                    html += `
                        <div class="result-item">
                            <div class="corp-name" onclick="showFinancialData('${corp.corp_code}', '${corp.corp_name.replace(/'/g, "&apos;")}')">${corp.corp_name} ğŸ“ˆ</div>
                            <div class="corp-details">
                                <div><strong>ê¸°ì—…ì½”ë“œ:</strong> <span class="corp-code">${corp.corp_code}</span></div>
                                <div><strong>ì£¼ì‹ì½”ë“œ:</strong> <span class="stock-code">${corp.stock_code || 'N/A'}</span></div>
                                <div><strong>ì˜ë¬¸ëª…:</strong> ${corp.corp_eng_name || 'N/A'}</div>
                                <div><strong>ìˆ˜ì •ì¼:</strong> ${formatDate(corp.modify_date)}</div>
                            </div>
                        </div>
                    `;
                });
                
                // ë” ë§ì€ ê²°ê³¼ê°€ ìˆì„ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€
                if (totalCount > maxResults) {
                    html += `<div class="more-results">ğŸ’¡ ë” ì •í™•í•œ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì‹œë©´ ë” ë§ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error searching corporations:', error);
                resultsDiv.innerHTML = '<div class="error">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
            }
        }
        
        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateStr) {
            if (!dateStr || dateStr.length !== 8) return dateStr;
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            return `${year}-${month}-${day}`;
        }
        
        // ì¬ë¬´ ë°ì´í„° í‘œì‹œ
        async function showFinancialData(corpCode, corpName) {
            currentCorpCode = corpCode;
            currentCompanyName = corpName;
            
            // ì œëª© ì—…ë°ì´íŠ¸
            document.getElementById('financialTitle').textContent = `${corpName} ì¬ë¬´ ë°ì´í„°`;
            
            // ë…„ë„ ë“œë¡­ë‹¤ìš´ ë™ì  ìƒì„±
            updateYearDropdown();
            
            // ì»¨í…Œì´ë„ˆ í‘œì‹œ
            document.getElementById('financialContainer').style.display = 'block';
            
            // ì¬ë¬´ ë°ì´í„° ë¡œë“œ
            await loadFinancialData();
            
            // ìŠ¤í¬ë¡¤
            document.getElementById('financialContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        // ë…„ë„ ë“œë¡­ë‹¤ìš´ ë™ì  ìƒì„±
        function updateYearDropdown() {
            const yearSelect = document.getElementById('yearSelect');
            const currentYear = new Date().getFullYear();
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            yearSelect.innerHTML = '';
            
            // ìµœê·¼ 10ë…„ê°„ì˜ ë…„ë„ ìƒì„± (í˜„ì¬ ë…„ë„ë¶€í„° ì—­ìˆœ)
            for (let year = currentYear; year >= currentYear - 9; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ë…„`;
                
                // 2024ë…„ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                if (year === 2024) {
                    option.selected = true;
                }
                
                yearSelect.appendChild(option);
            }
        }
        
        // ì¬ë¬´ ë°ì´í„° ë¡œë“œ
        async function loadFinancialData() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // ë¡œë”© í‘œì‹œ
                document.getElementById('financialSummary').innerHTML = '<div class="loading">ğŸ“Š ì¬ë¬´ ë°ì´í„° ë¡œë”© ì¤‘...</div>';
                
                // ê¸°ë³¸ ìš”ì•½ ë°ì´í„°, ìƒì„¸ ë¶„ì„ ë°ì´í„°, ì¬ë¬´êµ¬ì¡° ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ë¡œë“œ
                const [summaryResponse, analysisResponse, balanceResponse, detailedResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/analysis?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/balance-structure?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/detailed-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok && analysisResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    const analysisData = await analysisResponse.json();
                    const balanceData = balanceResponse.ok ? await balanceResponse.json() : null;
                    const detailedData = detailedResponse.ok ? await detailedResponse.json() : null;
                    
                    currentAnalysisData = analysisData;
                    currentBalanceData = balanceData;
                    currentDetailedData = detailedData;
                    
                    displayFinancialSummary(summaryData);
                    createFinancialChart(summaryData);
                    
                    // ë¶„ì„ ë°ì´í„° í‘œì‹œ
                    if (balanceData) {
                        displayBalanceStructure(balanceData);
                    }
                    displayRevenueAnalysis(analysisData);
                    displayProfitabilityAnalysis(analysisData);
                    displayRatiosAnalysis(analysisData);
                    displayPerformanceAnalysis(analysisData);
                    
                    // ìˆ˜ìµì„± ì°¨íŠ¸ ì¦‰ì‹œ ìƒì„± (ì²« ë¡œë“œ ì‹œ)
                    createProfitabilityCharts(analysisData);
                    
                } else {
                    // ì—ëŸ¬ ì‘ë‹µ í™•ì¸
                    let errorMessage = '';
                    let isYearDataError = false;
                    
                    if (!summaryResponse.ok) {
                        try {
                            const errorData = await summaryResponse.json();
                            if (errorData.error && errorData.error.includes('ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤')) {
                                const year = document.getElementById('yearSelect').value;
                                const report = document.getElementById('reportSelect').value;
                                const reportName = getReportName(report);
                                errorMessage = `${currentCompanyName}ì˜ ${year}ë…„ ${reportName} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
                                isYearDataError = true;
                            } else {
                                errorMessage = errorData.error || 'ì¬ë¬´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                            }
                        } catch (e) {
                            errorMessage = 'ì¬ë¬´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                        }
                    }
                    
                    if (isYearDataError) {
                        // ë…„ë„ë³„ ë°ì´í„° ì—†ìŒ ì—ëŸ¬ íŒì—… í‘œì‹œ
                        showErrorPopup(
                            'ğŸ“Š ë°ì´í„° ì—†ìŒ',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">ğŸ“‹ í•´ë‹¹ ë…„ë„ì˜ ì¬ë¬´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    } else if (errorMessage) {
                        // ì¼ë°˜ ì—ëŸ¬ íŒì—… í‘œì‹œ
                        showErrorPopup(
                            'âš ï¸ ì˜¤ë¥˜ ë°œìƒ',
                            errorMessage
                        );
                        document.getElementById('financialSummary').innerHTML = 
                            '<div class="error">ğŸ“‹ ì¬ë¬´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                    
                    // ë¶„ì„ ë°ì´í„°ë„ í™•ì¸
                    if (!analysisResponse.ok) {
                        console.warn('ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                }
                
            } catch (error) {
                console.error('Error loading financial data:', error);
                showErrorPopup(
                    'âš ï¸ ì˜¤ë¥˜ ë°œìƒ',
                    'ì¬ë¬´ ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\në„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
                );
                document.getElementById('financialSummary').innerHTML = 
                    '<div class="error">ğŸ“‹ ì¬ë¬´ ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }
        
        // ì¬ë¬´ ìš”ì•½ ì •ë³´ í‘œì‹œ
        function displayFinancialSummary(data) {
            const summaryDiv = document.getElementById('financialSummary');
            const accounts = data.key_accounts;
            
            let html = '';
            
            if (accounts.assets) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ìì‚°ì´ê³„</div>
                        <div class="summary-value">${formatCurrency(accounts.assets)}</div>
                    </div>
                `;
            }
            
            if (accounts.liabilities) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ë¶€ì±„ì´ê³„</div>
                        <div class="summary-value">${formatCurrency(accounts.liabilities)}</div>
                    </div>
                `;
            }
            
            if (accounts.equity) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ìë³¸ì´ê³„</div>
                        <div class="summary-value">${formatCurrency(accounts.equity)}</div>
                    </div>
                `;
            }
            
            if (accounts.revenue) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ë§¤ì¶œì•¡</div>
                        <div class="summary-value">${formatCurrency(accounts.revenue)}</div>
                    </div>
                `;
            }
            
            if (accounts.operating_profit) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ì˜ì—…ì´ìµ</div>
                        <div class="summary-value">${formatCurrency(accounts.operating_profit)}</div>
                    </div>
                `;
            }
            
            if (accounts.net_income) {
                html += `
                    <div class="summary-item">
                        <div class="summary-label">ë‹¹ê¸°ìˆœì´ìµ</div>
                        <div class="summary-value">${formatCurrency(accounts.net_income)}</div>
                    </div>
                `;
            }
            
            if (!html) {
                html = '<div class="error">ğŸ“Š í‘œì‹œí•  ì¬ë¬´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
            
            summaryDiv.innerHTML = html;
        }
        
        // ì¬ë¬´ ì°¨íŠ¸ ìƒì„±
        function createFinancialChart(data) {
            const ctx = document.getElementById('financialChart').getContext('2d');
            const accounts = data.key_accounts;
            
            // ì´ì „ ì°¨íŠ¸ ì‚­ì œ
            if (currentChart) {
                currentChart.destroy();
            }
            
            // ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'ê¸ˆì•¡ (ë°±ë§Œì›)',
                    data: [],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(118, 75, 162, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 205, 86, 0.8)',
                        'rgba(75, 192, 192, 0.8)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)',
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 205, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 2
                }]
            };
            
            // ë°ì´í„° ì¶”ê°€
            if (accounts.assets) {
                chartData.labels.push('ìì‚°ì´ê³„');
                chartData.datasets[0].data.push(Math.round(accounts.assets / 1000000)); // ë°±ë§Œì› ë‹¨ìœ„
            }
            if (accounts.liabilities) {
                chartData.labels.push('ë¶€ì±„ì´ê³„');
                chartData.datasets[0].data.push(Math.round(accounts.liabilities / 1000000));
            }
            if (accounts.equity) {
                chartData.labels.push('ìë³¸ì´ê³„');
                chartData.datasets[0].data.push(Math.round(accounts.equity / 1000000));
            }
            if (accounts.revenue) {
                chartData.labels.push('ë§¤ì¶œì•¡');
                chartData.datasets[0].data.push(Math.round(accounts.revenue / 1000000));
            }
            if (accounts.operating_profit) {
                chartData.labels.push('ì˜ì—…ì´ìµ');
                chartData.datasets[0].data.push(Math.round(accounts.operating_profit / 1000000));
            }
            if (accounts.net_income) {
                chartData.labels.push('ë‹¹ê¸°ìˆœì´ìµ');
                chartData.datasets[0].data.push(Math.round(accounts.net_income / 1000000));
            }
            
            // ì°¨íŠ¸ ìœ„ì— ê¸ˆì•¡ í‘œì‹œ
            const chartValuesContainer = document.getElementById('financialChartValues');
            let valuesHtml = '';
            chartData.labels.forEach((label, index) => {
                const value = chartData.datasets[0].data[index];
                valuesHtml += `
                    <div class="chart-value-item">
                        <div class="chart-value-label">${label}</div>
                        <div class="chart-value-amount">${value.toLocaleString()}ë°±ë§Œì›</div>
                    </div>
                `;
            });
            chartValuesContainer.innerHTML = valuesHtml;
            
            // ì°¨íŠ¸ ìƒì„±
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentCompanyName || data.company_info?.stock_code || 'íšŒì‚¬'} ì£¼ìš” ì¬ë¬´ ì§€í‘œ (${data.company_info?.bsns_year || 'N/A'}ë…„)`
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ë°±ë§Œì›)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: function(value) {
                                return value.toLocaleString() + 'ë°±ë§Œì›';
                            }
                        }
                    }
                }
            });
        }
        
        // í†µí™” í¬ë§·íŒ…
        function formatCurrency(amount) {
            if (!amount) return 'N/A';
            
            if (Math.abs(amount) >= 1000000000000) {
                return (amount / 1000000000000).toFixed(1) + 'ì¡°ì›';
            } else if (Math.abs(amount) >= 100000000) {
                return (amount / 100000000).toFixed(0) + 'ì–µì›';
            } else if (Math.abs(amount) >= 10000) {
                return (amount / 10000).toFixed(0) + 'ë§Œì›';
            } else {
                return amount.toLocaleString() + 'ì›';
            }
        }
        
        // ì¬ë¬´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshFinancialData() {
            if (currentCorpCode) {
                // AI ë°ì´í„° ì´ˆê¸°í™” (ìƒˆë¡œìš´ ë…„ë„/ë³´ê³ ì„œë¡œ ë³€ê²½ ì‹œ)
                currentAiData = null;
                loadFinancialData();
            }
        }
        
        // í†µí•©ëœ ì „ì²´ ì´ˆê¸°í™” í•¨ìˆ˜
        function completeReset() {
            // í™•ì¸ ëŒ€í™”ì°½ í‘œì‹œ
            const confirmed = confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³  ìƒˆë¡œìš´ ê²€ìƒ‰ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n- ê²€ìƒ‰ ê²°ê³¼\n- ì¬ë¬´ ë°ì´í„°\n- ì°¨íŠ¸ ë° ë¶„ì„\n- AI ë¶„ì„ ê²°ê³¼');
            
            if (confirmed) {
                // 1. ì¬ë¬´ ë°ì´í„° ì°½ ë‹«ê¸° ë° ì°¨íŠ¸ ì •ë¦¬
                closeFinancialData();
                
                // 2. ê²€ìƒ‰ ì…ë ¥ì°½ ì´ˆê¸°í™” ë° í¬ì»¤ìŠ¤
                const searchInput = document.getElementById('searchInput');
                searchInput.value = '';
                searchInput.focus();
                
                // 3. ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = '';
                
                // 4. í†µê³„ ì •ë³´ ì´ˆê¸°í™”
                const statsContainer = document.getElementById('stats');
                statsContainer.innerHTML = '';
                
                // 5. ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
                currentCorpCode = null;
                currentCompanyName = null;
                currentFinancialData = null;
                currentAnalysisData = null;
                currentBalanceData = null;
                currentAiData = null;
                
                // 6. ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
                showCompleteResetMessage();
                
                // 7. í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // í†µí•© ì´ˆê¸°í™” ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
        function showCompleteResetMessage() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = `
                <div class="reset-message">
                    <div class="reset-icon">ğŸ”„</div>
                    <div class="reset-text">
                        <h3>ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ!</h3>
                        <p>ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ê²€ìƒ‰ì°½ì— íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì—¬ ìƒˆë¡œìš´ ì¬ë¬´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì„¸ìš”.</p>
                    </div>
                </div>
            `;
            
            // 4ì´ˆ í›„ ë©”ì‹œì§€ ìë™ ì œê±°
            setTimeout(() => {
                if (resultsContainer.innerHTML.includes('reset-message')) {
                    resultsContainer.innerHTML = '';
                }
            }, 4000);
        }
        
        // ì—ëŸ¬ íŒì—… í‘œì‹œ í•¨ìˆ˜
        function showErrorPopup(title, message) {
            // ê¸°ì¡´ íŒì—…ì´ ìˆë‹¤ë©´ ì œê±°
            const existingPopup = document.querySelector('.error-popup-overlay');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'error-popup-overlay';
            
            const popup = document.createElement('div');
            popup.className = 'error-popup';
            popup.innerHTML = `
                <div class="error-popup-icon">âš ï¸</div>
                <div class="error-popup-title">${title}</div>
                <div class="error-popup-message">${message}</div>
                <button class="error-popup-button" onclick="closeErrorPopup()">í™•ì¸</button>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            
            // ESC í‚¤ë¡œ íŒì—… ë‹«ê¸°
            const handleEscKey = (event) => {
                if (event.key === 'Escape') {
                    closeErrorPopup();
                    document.removeEventListener('keydown', handleEscKey);
                }
            };
            document.addEventListener('keydown', handleEscKey);
            
            // ì˜¤ë²„ë ˆì´ í´ë¦­ìœ¼ë¡œ íŒì—… ë‹«ê¸°
            overlay.addEventListener('click', (event) => {
                if (event.target === overlay) {
                    closeErrorPopup();
                }
            });
        }
        
        // ì—ëŸ¬ íŒì—… ë‹«ê¸° í•¨ìˆ˜
        function closeErrorPopup() {
            const overlay = document.querySelector('.error-popup-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // ë³´ê³ ì„œ ì½”ë“œë¥¼ ì´ë¦„ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function getReportName(reportCode) {
            const reportNames = {
                '11011': 'ì‚¬ì—…ë³´ê³ ì„œ',
                '11012': 'ë°˜ê¸°ë³´ê³ ì„œ',
                '11013': '1ë¶„ê¸°ë³´ê³ ì„œ',
                '11014': '3ë¶„ê¸°ë³´ê³ ì„œ'
            };
            return reportNames[reportCode] || 'ë³´ê³ ì„œ';
        }
        
        // ì¬ë¬´ ë°ì´í„° ì°½ ë‹«ê¸°
        function closeFinancialData() {
            document.getElementById('financialContainer').style.display = 'none';
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            
            // ëª¨ë“  ë¶„ì„ ì°¨íŠ¸ ì‚­ì œ
            Object.keys(analysisCharts).forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            currentCorpCode = null;
            currentCompanyName = null;
            currentFinancialData = null;
            currentAnalysisData = null;
            currentBalanceData = null;
            currentAiData = null;
            
            // ì²« ë²ˆì§¸ íƒ­ìœ¼ë¡œ ë¦¬ì…‹
            switchTab('overview');
        }
        
        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.analysis-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // ì°¨íŠ¸ ìƒì„± (í•„ìš”í•œ ê²½ìš°)
            if (currentAnalysisData) {
                switch(tabName) {
                    case 'ai':
                        if (!currentAiData) {
                            loadAiAnalysis();
                        }
                        break;
                    case 'balance':
                        if (currentBalanceData) {
                            createBalanceStructureChart(currentBalanceData);
                        }
                        break;
                    case 'revenue':
                        createRevenueChart(currentAnalysisData);
                        break;
                    case 'profitability':
                        createProfitabilityCharts(currentAnalysisData);
                        break;
                    case 'ratios':
                        createRatiosChart(currentAnalysisData);
                        break;
                    case 'performance':
                        createPerformanceChart(currentAnalysisData);
                        break;
                }
            }
        }
        
        // AI ë¶„ì„ ë¡œë“œ
        async function loadAiAnalysis() {
            if (!currentCorpCode) return;
            
            const year = document.getElementById('yearSelect').value;
            const report = document.getElementById('reportSelect').value;
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-loading">
                        <div class="spinner"></div>
                        <div>ğŸ¤– AIê°€ ì¬ë¬´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
                
                // AI ìš”ì•½ê³¼ ìƒì„¸ ë¶„ì„ì„ ë³‘ë ¬ë¡œ ë¡œë“œ
                const [summaryResponse, analysisResponse] = await Promise.all([
                    fetch(`/api/financial/${currentCorpCode}/ai-summary?year=${year}&report=${report}`),
                    fetch(`/api/financial/${currentCorpCode}/ai-analysis?year=${year}&report=${report}`)
                ]);
                
                if (summaryResponse.ok) {
                    const summaryData = await summaryResponse.json();
                    displayAiSummary(summaryData);
                } else {
                    const errorData = await summaryResponse.json();
                    document.getElementById('aiSummary').innerHTML = `
                        <div class="ai-error">
                            AI ìš”ì•½ ìƒì„± ì‹¤íŒ¨: ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                        </div>
                    `;
                }
                
                if (analysisResponse.ok) {
                    const analysisData = await analysisResponse.json();
                    displayAiAnalysis(analysisData);
                    currentAiData = analysisData;
                } else {
                    const errorData = await analysisResponse.json();
                    document.getElementById('aiAnalysis').innerHTML = `
                        <div class="ai-error">
                            AI ë¶„ì„ ìƒì„± ì‹¤íŒ¨: ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                            <br><br>
                            <small>ğŸ’¡ Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.</small>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading AI analysis:', error);
                document.getElementById('aiSummary').innerHTML = `
                    <div class="ai-error">
                        AI ë¶„ì„ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
                    </div>
                `;
                document.getElementById('aiAnalysis').innerHTML = '';
            }
        }
        
        // AI ìš”ì•½ í‘œì‹œ
        function displayAiSummary(data) {
            const container = document.getElementById('aiSummary');
            
            const html = `
                <div class="ai-summary-title">
                    ${data.company_name} ì¬ë¬´ ìƒíƒœ AI ìš”ì•½
                </div>
                <div class="ai-summary-text">
                    ${data.summary}
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // AI ìƒì„¸ ë¶„ì„ í‘œì‹œ
        function displayAiAnalysis(data) {
            const container = document.getElementById('aiAnalysis');
            
            let html = `
                <div class="ai-analysis-header">
                    <h3>ğŸ¤– AI ì¬ë¬´ ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                </div>
                <div class="ai-analysis-text">${data.ai_analysis}</div>
                <div class="ai-disclaimer">
                    âš ï¸ <strong>ì£¼ì˜ì‚¬í•­:</strong> ì´ ë¶„ì„ì€ AIê°€ ìƒì„±í•œ ê²ƒìœ¼ë¡œ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”. 
                    íˆ¬ì ê²°ì • ì‹œì—ëŠ” ë°˜ë“œì‹œ ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì„ êµ¬í•˜ê±°ë‚˜ ì¶”ê°€ì ì¸ ë¶„ì„ì„ ì§„í–‰í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // ì¬ë¬´êµ¬ì¡° ë¶„ì„ í‘œì‹œ
        function displayBalanceStructure(data) {
            const equationContainer = document.getElementById('balanceEquation');
            const analysisContainer = document.getElementById('balanceStructureAnalysis');
            const balanceEq = data.balance_equation;
            
            // íšŒê³„ë“±ì‹ í‘œì‹œ
            let equationHtml = `
                <div class="balance-equation">ìì‚° = ë¶€ì±„ + ìë³¸</div>
                <div class="equation-values">
                    <div class="equation-item">
                        <h4>ìì‚°ì´ê³„</h4>
                        <div class="value">${formatCurrency(balanceEq.total_assets)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">=</div>
                    </div>
                    <div class="equation-item">
                        <h4>ë¶€ì±„ì´ê³„</h4>
                        <div class="value">${formatCurrency(balanceEq.total_liabilities)}</div>
                    </div>
                    <div class="equation-item">
                        <div style="font-size: 2em; font-weight: bold;">+</div>
                    </div>
                    <div class="equation-item">
                        <h4>ìë³¸ì´ê³„</h4>
                        <div class="value">${formatCurrency(balanceEq.total_equity)}</div>
                    </div>
                </div>
            `;
            
            // ë“±ì‹ ê· í˜• ìƒíƒœ í‘œì‹œ
            if (balanceEq.equation_balance !== undefined) {
                const balanceClass = balanceEq.equation_balance ? 'balanced' : 'unbalanced';
                const balanceText = balanceEq.equation_balance ? 
                    'âœ… íšŒê³„ë“±ì‹ì´ ê· í˜•ì„ ì´ë£¨ê³  ìˆìŠµë‹ˆë‹¤' : 
                    `âš ï¸ íšŒê³„ë“±ì‹ì— ì˜¤ì°¨ê°€ ìˆìŠµë‹ˆë‹¤ (${balanceEq.balance_error_rate}%)`;
                
                equationHtml += `
                    <div class="equation-balance ${balanceClass}">
                        ${balanceText}
                    </div>
                `;
            }
            
            equationContainer.innerHTML = equationHtml;
            
            // êµ¬ì„±ìš”ì†Œ ë¶„ì„ í‘œì‹œ - ì¢Œìš° ë ˆì´ì•„ì›ƒ
            let analysisHtml = '<div class="balance-structure-layout">';
            
            // ì¢Œì¸¡: ìì‚° êµ¬ì„±
            analysisHtml += '<div class="balance-left">';
            analysisHtml += '<div class="balance-section-title assets">ğŸ¦ ìì‚° (Assets)</div>';
            
            const assets = data.asset_composition;
            if (Object.keys(assets).length > 0) {
                if (assets.current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ìœ ë™ìì‚°</span>
                            <span class="component-value">${formatCurrency(assets.current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.non_current_assets) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ë¹„ìœ ë™ìì‚°</span>
                            <span class="component-value">${formatCurrency(assets.non_current_assets)}</span>
                        </div>
                    `;
                }
                if (assets.inventory) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ì¬ê³ ìì‚°</span>
                            <span class="component-value">${formatCurrency(assets.inventory)}</span>
                        </div>
                    `;
                }
                if (assets.receivables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ë§¤ì¶œì±„ê¶Œ</span>
                            <span class="component-value">${formatCurrency(assets.receivables)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            
            // ìš°ì¸¡: ë¶€ì±„ì™€ ìë³¸
            analysisHtml += '<div class="balance-right">';
            
            // ìš°ì¸¡ ìƒë‹¨: ë¶€ì±„ êµ¬ì„±
            analysisHtml += '<div class="balance-right-top">';
            analysisHtml += '<div class="balance-section-title liabilities">ğŸ“Š ë¶€ì±„ (Liabilities)</div>';
            
            const liabilities = data.liability_composition;
            if (Object.keys(liabilities).length > 0) {
                if (liabilities.current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ìœ ë™ë¶€ì±„</span>
                            <span class="component-value">${formatCurrency(liabilities.current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.non_current_liabilities) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ë¹„ìœ ë™ë¶€ì±„</span>
                            <span class="component-value">${formatCurrency(liabilities.non_current_liabilities)}</span>
                        </div>
                    `;
                }
                if (liabilities.borrowings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ì°¨ì…ê¸ˆ</span>
                            <span class="component-value">${formatCurrency(liabilities.borrowings)}</span>
                        </div>
                    `;
                }
                if (liabilities.payables) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ë§¤ì…ì±„ë¬´</span>
                            <span class="component-value">${formatCurrency(liabilities.payables)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            
            // ìš°ì¸¡ í•˜ë‹¨: ìë³¸ êµ¬ì„±
            analysisHtml += '<div class="balance-right-bottom">';
            analysisHtml += '<div class="balance-section-title equity">ğŸ’ ìë³¸ (Equity)</div>';
            
            const equity = data.equity_composition;
            if (Object.keys(equity).length > 0) {
                if (equity.capital_stock) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ìë³¸ê¸ˆ</span>
                            <span class="component-value">${formatCurrency(equity.capital_stock)}</span>
                        </div>
                    `;
                }
                if (equity.retained_earnings) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ì´ìµì‰ì—¬ê¸ˆ</span>
                            <span class="component-value">${formatCurrency(equity.retained_earnings)}</span>
                        </div>
                    `;
                }
                if (equity.other_comprehensive_income) {
                    analysisHtml += `
                        <div class="component-item">
                            <span class="component-label">ê¸°íƒ€í¬ê´„ì†ìµëˆ„ê³„ì•¡</span>
                            <span class="component-value">${formatCurrency(equity.other_comprehensive_income)}</span>
                        </div>
                    `;
                }
            }
            analysisHtml += '</div>';
            analysisHtml += '</div>';
            
            analysisHtml += '</div>';
            analysisContainer.innerHTML = analysisHtml;
        }
        
        // ì¬ë¬´êµ¬ì¡° ì°¨íŠ¸ ìƒì„±
        function createBalanceStructureChart(data) {
            if (analysisCharts.balanceStructure) {
                analysisCharts.balanceStructure.destroy();
            }
            
            const ctx = document.getElementById('balanceStructureChart').getContext('2d');
            const balanceEq = data.balance_equation;
            
            if (!balanceEq.total_assets || !balanceEq.total_liabilities || !balanceEq.total_equity) {
                return;
            }
            
            // ìì‚° = ë¶€ì±„ + ìë³¸ ì‹œê°í™” (ì ì¸µ ë§‰ëŒ€ ì°¨íŠ¸)
            const chartData = {
                labels: ['ì¬ë¬´êµ¬ì¡°'],
                datasets: [
                    {
                        label: 'ë¶€ì±„',
                        data: [Math.round(balanceEq.total_liabilities / 1000000)],
                        backgroundColor: 'rgba(220, 53, 69, 0.8)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'ìë³¸',
                        data: [Math.round(balanceEq.total_equity / 1000000)],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2
                    }
                ]
            };
            
            analysisCharts.balanceStructure = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `ì¬ë¬´êµ¬ì¡°: ìì‚° ${formatCurrency(balanceEq.total_assets)} = ë¶€ì±„ + ìë³¸`
                        },
                        legend: {
                            display: true
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const total = balanceEq.total_assets / 1000000;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.dataset.label}: ${value.toLocaleString()}ë°±ë§Œì› (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value, context) {
                                const total = balanceEq.total_assets / 1000000;
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${value.toLocaleString()}\n(${percentage}%)`;
                            },
                            anchor: 'center',
                            align: 'center',
                            offset: 0
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'íšŒê³„ë“±ì‹ êµ¬ì¡°'
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ë°±ë§Œì›)'
                            }
                        }
                    }
                }
            });
        }
        
        // ë§¤ì¶œ ë¶„ì„ í‘œì‹œ
        function displayRevenueAnalysis(data) {
            const container = document.getElementById('revenueAnalysis');
            const revenue = data.revenue_analysis;
            
            if (!revenue || !revenue.current_revenue) {
                container.innerHTML = '<div class="error">ğŸ“‹ ë§¤ì¶œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = '<div class="analysis-grid">';
            
            // ë§¤ì¶œì•¡ ì •ë³´
            html += `
                <div class="analysis-card">
                    <h4>ğŸ’° ë§¤ì¶œì•¡ í˜„í™©</h4>
                    <div class="metric-row">
                        <span class="metric-label">ë‹¹ê¸° ë§¤ì¶œì•¡</span>
                        <span class="metric-value">${formatCurrency(revenue.current_revenue)}</span>
                    </div>
            `;
            
            if (revenue.previous_revenue) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ì „ê¸° ë§¤ì¶œì•¡</span>
                        <span class="metric-value">${formatCurrency(revenue.previous_revenue)}</span>
                    </div>
                `;
            }
            
            if (revenue.previous_revenue) {
                const revenueChange = revenue.current_revenue - revenue.previous_revenue;
                const changeClass = revenueChange > 0 ? 'positive' : 
                                   revenueChange < 0 ? 'negative' : 'neutral';
                const changeText = revenueChange > 0 ? 
                    `+${formatCurrency(revenueChange)}` : 
                    formatCurrency(revenueChange);
                
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ë§¤ì¶œ ì¦ê°ì•¡</span>
                        <span class="metric-value ${changeClass}">${changeText}</span>
                    </div>
                `;
            }
            
            if (revenue.revenue_growth_rate !== null) {
                const growthClass = revenue.revenue_growth_rate > 0 ? 'positive' : 
                                   revenue.revenue_growth_rate < 0 ? 'negative' : 'neutral';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ë§¤ì¶œ ì¦ê°€ìœ¨</span>
                        <span class="metric-value ${growthClass}">${revenue.revenue_growth_rate}%</span>
                    </div>
                `;
            }
            
            html += `
                    <div class="metric-row">
                        <span class="metric-label">ë§¤ì¶œ íŠ¸ë Œë“œ</span>
                        <span class="metric-value">${revenue.revenue_trend}</span>
                    </div>
                </div>
            `;
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ìˆ˜ìµì„± ë¶„ì„ í‘œì‹œ
        function displayProfitabilityAnalysis(data) {
            const container = document.getElementById('profitabilityAnalysis');
            const profitability = data.profitability_analysis;
            
            let html = '<div class="analysis-grid">';
            
            // ìˆ˜ìµì„± ì§€í‘œ
            html += `
                <div class="analysis-card">
                    <h4>ğŸ“ˆ ìˆ˜ìµì„± ì§€í‘œ</h4>
            `;
            
            if (profitability.gross_profit_margin !== undefined) {
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ë§¤ì¶œì´ì´ìµë¥ </span>
                        <span class="metric-value">${profitability.gross_profit_margin}%</span>
                    </div>
                `;
            }
            
            if (profitability.operating_profit_margin !== undefined) {
                const marginClass = profitability.operating_profit_margin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ì˜ì—…ì´ìµë¥ </span>
                        <span class="metric-value ${marginClass}">${profitability.operating_profit_margin}%</span>
                    </div>
                `;
            }
            
            if (profitability.net_profit_margin !== undefined) {
                const marginClass = profitability.net_profit_margin > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ìˆœì´ìµë¥ </span>
                        <span class="metric-value ${marginClass}">${profitability.net_profit_margin}%</span>
                    </div>
                `;
            }
            
            // EBITDA ì¶”ê°€
            if (currentDetailedData && currentDetailedData.ebitda !== null) {
                const ebitdaAmount = Math.round(currentDetailedData.ebitda / 1000000);
                const ebitdaClass = currentDetailedData.ebitda > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">EBITDA</span>
                        <span class="metric-value ${ebitdaClass}">${ebitdaAmount.toLocaleString()}ë°±ë§Œì›</span>
                    </div>
                `;
            }
            
            html += '</div>';
            
            // ROA, ROE
            html += `
                <div class="analysis-card">
                    <h4>ğŸ¯ íˆ¬ììˆ˜ìµë¥ </h4>
            `;
            
            if (profitability.roa !== undefined) {
                const roaClass = profitability.roa > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROA (ì´ìì‚°ìˆ˜ìµë¥ )</span>
                        <span class="metric-value ${roaClass}">${profitability.roa}%</span>
                    </div>
                `;
            }
            
            if (profitability.roe !== undefined) {
                const roeClass = profitability.roe > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ROE (ìê¸°ìë³¸ìˆ˜ìµë¥ )</span>
                        <span class="metric-value ${roeClass}">${profitability.roe}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // ì¬ë¬´ë¹„ìœ¨ ë¶„ì„ í‘œì‹œ
        function displayRatiosAnalysis(data) {
            const container = document.getElementById('ratiosAnalysis');
            const ratios = data.financial_ratios;
            
            let html = '<div class="analysis-grid">';
            
            // ì•ˆì •ì„± ë¹„ìœ¨
            html += `
                <div class="analysis-card">
                    <h4>âš–ï¸ ì¬ë¬´ ì•ˆì •ì„±</h4>
            `;
            
            if (ratios.debt_to_equity_ratio !== undefined) {
                const debtClass = ratios.debt_to_equity_ratio > 100 ? 'negative' : 
                                 ratios.debt_to_equity_ratio > 50 ? 'neutral' : 'positive';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ë¶€ì±„ë¹„ìœ¨ (ë¶€ì±„/ìë³¸)</span>
                        <span class="metric-value ${debtClass}">${ratios.debt_to_equity_ratio}%</span>
                    </div>
                `;
            }
            
            if (ratios.equity_ratio !== undefined) {
                const equityClass = ratios.equity_ratio > 50 ? 'positive' : 
                                   ratios.equity_ratio > 30 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ìê¸°ìë³¸ë¹„ìœ¨</span>
                        <span class="metric-value ${equityClass}">${ratios.equity_ratio}%</span>
                    </div>
                `;
            }
            
            if (ratios.debt_to_assets_ratio !== undefined) {
                const debtAssetsClass = ratios.debt_to_assets_ratio < 30 ? 'positive' : 
                                       ratios.debt_to_assets_ratio < 50 ? 'neutral' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ë¶€ì±„ë¹„ìœ¨ (ë¶€ì±„/ìì‚°)</span>
                        <span class="metric-value ${debtAssetsClass}">${ratios.debt_to_assets_ratio}%</span>
                    </div>
                `;
            }
            
            // ìƒì„¸ ë¶„ì„ ë°ì´í„°ì—ì„œ ì¶”ê°€ ë¹„ìœ¨ë“¤ í‘œì‹œ
            if (currentDetailedData && currentDetailedData.ratios) {
                const detailedRatios = currentDetailedData.ratios;
                
                // ì´ìë³´ìƒë¹„ìœ¨
                if (detailedRatios.interest_coverage_ratio !== undefined) {
                    const coverageClass = detailedRatios.interest_coverage_ratio > 3 ? 'positive' : 
                                         detailedRatios.interest_coverage_ratio > 1.5 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ì´ìë³´ìƒë¹„ìœ¨</span>
                            <span class="metric-value ${coverageClass}">${detailedRatios.interest_coverage_ratio}ë°°</span>
                        </div>
                    `;
                }
                
                // ì˜ì—…í™œë™ í˜„ê¸ˆíë¦„
                if (currentDetailedData.financial_metrics && currentDetailedData.financial_metrics.operating_cash_flow !== null) {
                    const cashFlowAmount = Math.round(currentDetailedData.financial_metrics.operating_cash_flow / 1000000);
                    const cashFlowClass = currentDetailedData.financial_metrics.operating_cash_flow > 0 ? 'positive' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ì˜ì—…í™œë™ í˜„ê¸ˆíë¦„</span>
                            <span class="metric-value ${cashFlowClass}">${cashFlowAmount.toLocaleString()}ë°±ë§Œì›</span>
                        </div>
                    `;
                }
                
                // ì´ìì‚°ìˆ˜ìµë¥  (ROA)
                if (detailedRatios.roa !== undefined) {
                    const roaClass = detailedRatios.roa > 5 ? 'positive' : 
                                    detailedRatios.roa > 2 ? 'neutral' : 'negative';
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">ì´ìì‚°ìˆ˜ìµë¥  (ROA)</span>
                            <span class="metric-value ${roaClass}">${detailedRatios.roa}%</span>
                        </div>
                    `;
                }
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // ì„±ê³¼ì§€í‘œ ë¶„ì„ í‘œì‹œ
        function displayPerformanceAnalysis(data) {
            const container = document.getElementById('performanceAnalysis');
            const performance = data.performance_indicators;
            
            let html = '<div class="analysis-grid">';
            
            // ì„±ì¥ì„± ì§€í‘œ
            html += `
                <div class="analysis-card">
                    <h4>ğŸ¯ ì„±ì¥ì„± ì§€í‘œ</h4>
            `;
            
            if (performance.total_assets_growth !== undefined) {
                const assetGrowthClass = performance.total_assets_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ì´ìì‚° ì¦ê°€ìœ¨</span>
                        <span class="metric-value ${assetGrowthClass}">${performance.total_assets_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.equity_growth !== undefined) {
                const equityGrowthClass = performance.equity_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ìê¸°ìë³¸ ì¦ê°€ìœ¨</span>
                        <span class="metric-value ${equityGrowthClass}">${performance.equity_growth}%</span>
                    </div>
                `;
            }
            
            if (performance.net_income_growth !== undefined) {
                const incomeGrowthClass = performance.net_income_growth > 0 ? 'positive' : 'negative';
                html += `
                    <div class="metric-row">
                        <span class="metric-label">ìˆœì´ìµ ì¦ê°€ìœ¨</span>
                        <span class="metric-value ${incomeGrowthClass}">${performance.net_income_growth}%</span>
                    </div>
                `;
            }
            
            html += '</div></div>';
            container.innerHTML = html;
        }
        
        // ë§¤ì¶œ ì°¨íŠ¸ ìƒì„±
        function createRevenueChart(data) {
            if (analysisCharts.revenue) {
                analysisCharts.revenue.destroy();
            }
            
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const revenue = data.revenue_analysis;
            
            if (!revenue.current_revenue) return;
            
            const previousRevenue = revenue.previous_revenue ? Math.round(revenue.previous_revenue / 1000000) : 0;
            const currentRevenue = Math.round(revenue.current_revenue / 1000000);
            const revenueChange = currentRevenue - previousRevenue;
            const revenueChangePercent = previousRevenue > 0 ? ((revenueChange / previousRevenue) * 100).toFixed(1) : 0;
            
            const chartData = {
                labels: ['ì „ê¸°', 'ë‹¹ê¸°'],
                datasets: [{
                    label: 'ì „ê¸° ë§¤ì¶œì•¡',
                    data: [previousRevenue, 0],
                    backgroundColor: 'rgba(118, 75, 162, 0.8)',
                    borderColor: 'rgba(118, 75, 162, 1)',
                    borderWidth: 2
                }, {
                    label: 'ë‹¹ê¸° ë§¤ì¶œì•¡',
                    data: [0, currentRevenue],
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 2
                }]
            };
            
            // ì°¨íŠ¸ ìœ„ì— ê¸ˆì•¡ í‘œì‹œ
            const chartValuesContainer = document.getElementById('revenueChartValues');
            chartValuesContainer.innerHTML = `
                <div class="chart-value-item">
                    <div class="chart-value-label">ì „ê¸° ë§¤ì¶œì•¡</div>
                    <div class="chart-value-amount previous">${previousRevenue.toLocaleString()}ë°±ë§Œì›</div>
                </div>
                <div class="chart-value-item">
                    <div class="chart-value-label">ë‹¹ê¸° ë§¤ì¶œì•¡</div>
                    <div class="chart-value-amount current">${currentRevenue.toLocaleString()}ë°±ë§Œì›</div>
                </div>
            `;
            
            analysisCharts.revenue = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ë§¤ì¶œì•¡ ë¹„êµ'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const label = context.label === 'ì „ê¸°' ? 'ì „ê¸° ë§¤ì¶œì•¡' : 'ë‹¹ê¸° ë§¤ì¶œì•¡';
                                    return `${label}: ${value.toLocaleString()}ë°±ë§Œì›`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ë°±ë§Œì›)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            display: true,
                            color: '#000',
                            anchor: 'end',
                            align: 'top',
                            offset: 4,
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value) {
                                return value > 0 ? value.toLocaleString() + 'ë°±ë§Œì›' : '';
                            }
                        }
                    }
                }
            });
            
            // ì¦ê° ì •ë³´ í‘œì‹œ
            if (previousRevenue > 0) {
                const changeInfoContainer = document.getElementById('revenueChangeInfo');
                const changeClass = revenueChange >= 0 ? 'positive' : 'negative';
                const changeText = revenueChange >= 0 ? 
                    `+${revenueChange.toLocaleString()}` : 
                    `${revenueChange.toLocaleString()}`;
                
                changeInfoContainer.innerHTML = `
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">ì¦ê°ì•¡</div>
                        <div class="revenue-change-value ${changeClass}">${changeText}ë°±ë§Œì›</div>
                    </div>
                    <div class="revenue-change-item">
                        <div class="revenue-change-label">ì¦ê°ë¥ </div>
                        <div class="revenue-change-value ${changeClass}">${revenueChangePercent}%</div>
                    </div>
                `;
            } else {
                document.getElementById('revenueChangeInfo').innerHTML = '';
            }
        }
        
        // ìˆ˜ìµì„± ì°¨íŠ¸ë“¤ ìƒì„± (ê°œì„ ëœ ë²„ì „)
        function createProfitabilityCharts(data) {
            const profitability = data.profitability_analysis;
            if (!profitability) return;
            
            // ê¸°ì¡´ ì°¨íŠ¸ë“¤ ì •ë¦¬
            ['margin', 'roe', 'roa', 'profitability'].forEach(key => {
                if (analysisCharts[key]) {
                    analysisCharts[key].destroy();
                    analysisCharts[key] = null;
                }
            });
            
            // 1. ì´ìµë¥  ì§€í‘œ ì°¨íŠ¸
            createMarginChart(profitability);
            
            // 2. ROE ì°¨íŠ¸
            createROEChart(profitability);
            
            // 3. ROA ì°¨íŠ¸
            createROAChart(profitability);
            
            // 4. ROE vs ROA ë¹„êµ ì°¨íŠ¸
            createROEvsROAChart(profitability);
        }
        
        // ì´ìµë¥  ì§€í‘œ ì°¨íŠ¸
        function createMarginChart(profitability) {
            const ctx = document.getElementById('marginChart').getContext('2d');
            
            const labels = [];
            const values = [];
            const colors = ['rgba(54, 162, 235, 0.8)', 'rgba(255, 99, 132, 0.8)', 'rgba(75, 192, 192, 0.8)'];
            
            if (profitability.gross_profit_margin !== undefined) {
                labels.push('ë§¤ì¶œì´ì´ìµë¥ ');
                values.push(profitability.gross_profit_margin);
            }
            if (profitability.operating_profit_margin !== undefined) {
                labels.push('ì˜ì—…ì´ìµë¥ ');
                values.push(profitability.operating_profit_margin);
            }
            if (profitability.net_profit_margin !== undefined) {
                labels.push('ìˆœì´ìµë¥ ');
                values.push(profitability.net_profit_margin);
            }
            
            if (labels.length === 0) return;
            
            analysisCharts.margin = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values.map(v => Math.abs(v)), // ìŒìˆ˜ ê°’ë„ ì‹œê°í™” ê°€ëŠ¥í•˜ë„ë¡
                        backgroundColor: colors.slice(0, values.length),
                        borderColor: colors.slice(0, values.length).map(c => c.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const originalValue = values[context.dataIndex];
                                    return context.label + ': ' + originalValue.toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ROE ì°¨íŠ¸ (ê²Œì´ì§€ í˜•íƒœ)
        function createROEChart(profitability) {
            const ctx = document.getElementById('roeChart').getContext('2d');
            
            if (profitability.roe === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„° ì—†ìŒ', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roeValue = profitability.roe;
            const maxValue = Math.max(30, Math.abs(roeValue) * 1.5); // ìµœëŒ€ê°’ ì„¤ì •
            
            analysisCharts.roe = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROE', 'ë‚˜ë¨¸ì§€'],
                    datasets: [{
                        data: [Math.abs(roeValue), maxValue - Math.abs(roeValue)],
                        backgroundColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roeValue >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roeValue >= 0 ? '#28a745' : '#dc3545';
                        ctx.fillText(roeValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('ìê¸°ìë³¸ìˆ˜ìµë¥ ', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ROA ì°¨íŠ¸ (ê²Œì´ì§€ í˜•íƒœ)
        function createROAChart(profitability) {
            const ctx = document.getElementById('roaChart').getContext('2d');
            
            if (profitability.roa === undefined) {
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„° ì—†ìŒ', ctx.canvas.width/2, ctx.canvas.height/2);
                return;
            }
            
            const roaValue = profitability.roa;
            const maxValue = Math.max(20, Math.abs(roaValue) * 1.5); // ìµœëŒ€ê°’ ì„¤ì •
            
            analysisCharts.roa = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ROA', 'ë‚˜ë¨¸ì§€'],
                    datasets: [{
                        data: [Math.abs(roaValue), maxValue - Math.abs(roaValue)],
                        backgroundColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 0.8)' : 'rgba(220, 53, 69, 0.8)',
                            'rgba(230, 230, 230, 0.3)'
                        ],
                        borderColor: [
                            roaValue >= 0 ? 'rgba(255, 193, 7, 1)' : 'rgba(220, 53, 69, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    cutout: '70%'
                },
                plugins: [{
                    beforeDraw: function(chart) {
                        const ctx = chart.ctx;
                        const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                        const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;
                        
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = roaValue >= 0 ? '#ffc107' : '#dc3545';
                        ctx.fillText(roaValue.toFixed(2) + '%', centerX, centerY);
                        
                        ctx.font = '12px Arial';
                        ctx.fillStyle = '#666';
                        ctx.fillText('ì´ìì‚°ìˆ˜ìµë¥ ', centerX, centerY + 25);
                    }
                }]
            });
        }
        
        // ROE vs ROA ë¹„êµ ì°¨íŠ¸
        function createROEvsROAChart(profitability) {
            const ctx = document.getElementById('profitabilityChart').getContext('2d');
            
            const roeValue = profitability.roe || 0;
            const roaValue = profitability.roa || 0;
            
            analysisCharts.profitability = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ROE', 'ROA'],
                    datasets: [{
                        label: 'ìˆ˜ìµì„± ì§€í‘œ',
                        data: [Math.abs(roeValue), Math.abs(roaValue)],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: Math.max(20, Math.max(Math.abs(roeValue), Math.abs(roaValue)) * 1.2),
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ì¬ë¬´ë¹„ìœ¨ ì°¨íŠ¸ ìƒì„±
        function createRatiosChart(data) {
            if (analysisCharts.ratios) {
                analysisCharts.ratios.destroy();
            }
            
            const ctx = document.getElementById('ratiosChart').getContext('2d');
            const ratios = data.financial_ratios;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'ë¹„ìœ¨ (%)',
                    data: [],
                    backgroundColor: [
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(153, 102, 255, 0.8)',
                        'rgba(255, 99, 132, 0.8)'
                    ],
                    borderWidth: 2
                }]
            };
            
            if (ratios.debt_to_equity_ratio !== undefined) {
                chartData.labels.push('ë¶€ì±„ë¹„ìœ¨');
                chartData.datasets[0].data.push(ratios.debt_to_equity_ratio);
            }
            if (ratios.equity_ratio !== undefined) {
                chartData.labels.push('ìê¸°ìë³¸ë¹„ìœ¨');
                chartData.datasets[0].data.push(ratios.equity_ratio);
            }
            if (ratios.debt_to_assets_ratio !== undefined) {
                chartData.labels.push('ë¶€ì±„/ìì‚°ë¹„ìœ¨');
                chartData.datasets[0].data.push(ratios.debt_to_assets_ratio);
            }
            
            analysisCharts.ratios = new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì¬ë¬´ ì•ˆì •ì„± ë¹„ìœ¨'
                        }
                    }
                }
            });
        }
        
        // ì„±ê³¼ì§€í‘œ ì°¨íŠ¸ ìƒì„±
        function createPerformanceChart(data) {
            if (analysisCharts.performance) {
                analysisCharts.performance.destroy();
            }
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const performance = data.performance_indicators;
            
            const chartData = {
                labels: [],
                datasets: [{
                    label: 'ì¦ê°€ìœ¨ (%)',
                    data: [],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };
            
            if (performance.total_assets_growth !== undefined) {
                chartData.labels.push('ì´ìì‚° ì¦ê°€ìœ¨');
                chartData.datasets[0].data.push(performance.total_assets_growth);
            }
            if (performance.equity_growth !== undefined) {
                chartData.labels.push('ìê¸°ìë³¸ ì¦ê°€ìœ¨');
                chartData.datasets[0].data.push(performance.equity_growth);
            }
            if (performance.net_income_growth !== undefined) {
                chartData.labels.push('ìˆœì´ìµ ì¦ê°€ìœ¨');
                chartData.datasets[0].data.push(performance.net_income_growth);
            }
            
            analysisCharts.performance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì„±ì¥ì„± ì§€í‘œ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ì¦ê°€ìœ¨ (%)'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
